{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/mata/app-cloudweb/node_modules/next/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"/Users/mata/app-cloudweb/node_modules/next/node_modules/@babel/runtime/helpers/interopRequireWildcard\");\n\nvar global = _interopRequireWildcard(require(\"@webcms-globals\"));\n\nvar _Snippets = _interopRequireDefault(require(\"./Snippets\"));\n\nvar _useFunction = require(\"lib/helpers/useFunction\");\n\nvar TagManager = {\n  dataScript: function dataScript(dataLayer) {\n    var script = document.createElement('script');\n    script.innerHTML = dataLayer;\n    return script;\n  },\n  gtm: function gtm(args) {\n    var snippets = _Snippets[\"default\"].tags(args);\n\n    var noScript = function noScript() {\n      var noscript = document.createElement('noscript');\n      noscript.innerHTML = snippets.iframe;\n      return noscript;\n    };\n\n    var script = function script() {\n      var script = document.createElement('script');\n      script.innerHTML = snippets.script;\n      return script;\n    };\n\n    var dataScript = this.dataScript(snippets.dataLayerVar);\n    return {\n      noScript: noScript,\n      script: script,\n      dataScript: dataScript\n    };\n  },\n  initialize: function initialize(_ref) {\n    var gtmId = _ref.gtmId,\n        _ref$events = _ref.events,\n        events = _ref$events === void 0 ? {} : _ref$events,\n        dataLayer = _ref.dataLayer,\n        _ref$dataLayerName = _ref.dataLayerName,\n        dataLayerName = _ref$dataLayerName === void 0 ? 'dataLayer' : _ref$dataLayerName,\n        _ref$auth = _ref.auth,\n        auth = _ref$auth === void 0 ? '' : _ref$auth,\n        _ref$preview = _ref.preview,\n        preview = _ref$preview === void 0 ? '' : _ref$preview;\n    var gtm = this.gtm({\n      id: gtmId,\n      events: events,\n      dataLayer: dataLayer || undefined,\n      dataLayerName: dataLayerName,\n      auth: auth,\n      preview: preview\n    });\n    if (dataLayer) document.head.appendChild(gtm.dataScript);\n    document.head.insertBefore(gtm.script(), document.head.childNodes[0]);\n    document.body.insertBefore(gtm.noScript(), document.body.childNodes[0]);\n  },\n  dataLayer: function dataLayer(_ref2) {\n    var _dataLayer = _ref2.dataLayer,\n        _ref2$dataLayerName = _ref2.dataLayerName,\n        dataLayerName = _ref2$dataLayerName === void 0 ? 'dataLayer' : _ref2$dataLayerName;\n    if (window[dataLayerName]) return window[dataLayerName].push(_dataLayer);\n\n    var snippets = _Snippets[\"default\"].dataLayer(_dataLayer, dataLayerName);\n\n    var dataScript = this.dataScript(snippets);\n    document.head.insertBefore(dataScript, document.head.childNodes[0]);\n  },\n  getActionFieldForPageView: function getActionFieldForPageView(pageStep) {\n    switch (pageStep) {\n      case 'Preview':\n        return {\n          'eventCategory': 'Enhanced Ecommerce',\n          'ecommerce': {\n            'actionField': {\n              'step': 3,\n              'option': 'Preview'\n            }\n          }\n        };\n\n      default:\n        return {};\n    }\n  },\n  resetPrevious: function resetPrevious() {\n    TagManager.dataLayer({\n      dataLayer: {\n        'eventCategory': null,\n        'ecommerce': null\n      }\n    });\n  },\n  page: {\n    setChange: function setChange(_ref3) {\n      var hotelName = _ref3.hotelName,\n          hotelId = _ref3.hotelId,\n          _ref3$pageTitle = _ref3.pageTitle,\n          pageTitle = _ref3$pageTitle === void 0 ? '' : _ref3$pageTitle,\n          _ref3$pagePath = _ref3.pagePath,\n          pagePath = _ref3$pagePath === void 0 ? '' : _ref3$pagePath,\n          _ref3$pageStep = _ref3.pageStep,\n          pageStep = _ref3$pageStep === void 0 ? '' : _ref3$pageStep,\n          _ref3$isGuest = _ref3.isGuest,\n          isGuest = _ref3$isGuest === void 0 ? false : _ref3$isGuest;\n      TagManager.resetPrevious();\n      TagManager.dataLayer({\n        dataLayer: Object.assign({\n          'eventLabel': 'Page View',\n          'event': 'Pageview',\n          'eventAction': 'Page View',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'pagePath': pagePath,\n          'pageTitle': pageTitle,\n          'pageStep': pageStep,\n          'visitorType': isGuest ? 'guest' : 'visitor'\n        }, TagManager.getActionFieldForPageView(pageStep))\n      });\n    }\n  },\n  booking: {\n    setRoomList: function setRoomList(_ref4) {\n      var _s = $RefreshSig$();\n\n      var _ref4$eventLabel = _ref4.eventLabel,\n          eventLabel = _ref4$eventLabel === void 0 ? '' : _ref4$eventLabel,\n          hotelName = _ref4.hotelName,\n          hotelId = _ref4.hotelId,\n          ciDate = _ref4.ciDate,\n          coDate = _ref4.coDate,\n          adult = _ref4.adult,\n          child = _ref4.child,\n          _ref4$currencyCode = _ref4.currencyCode,\n          currencyCode = _ref4$currencyCode === void 0 ? '' : _ref4$currencyCode,\n          _ref4$impressionsData = _ref4.impressionsData,\n          impressionsData = _ref4$impressionsData === void 0 ? [] : _ref4$impressionsData;\n      TagManager.resetPrevious();\n      TagManager.dataLayer({\n        dataLayer: {\n          'eventLabel': eventLabel,\n          'eventCategory': 'Enhanced Ecommerce',\n          'eventAction': 'Product Impression',\n          'event': 'productImpression',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'ecommerce': {\n            'ciDate': ciDate,\n            'coDate': coDate,\n            'adult': adult,\n            'child': child,\n            'currencyCode': (0, _useFunction.getCurrencyCodeToIso)(currencyCode),\n            'actionField': {\n              'step': 1,\n              'option': 'Product Impression'\n            },\n            'impressions': impressionsData.map(_s(function (impression, position) {\n              _s();\n\n              var totalPrice = (0, _useFunction.useTotalPrice)(impression.priceList, adult).discTotalPrice || (0, _useFunction.useTotalPrice)(impression.priceList, adult).totalPrice || 0;\n              return {\n                'name': impression.description,\n                'id': impression.id,\n                'price': global.helper.formatPrice(totalPrice),\n                'quantity': impression.totalroom,\n                'category': 'Room',\n                'list': 'Search Results',\n                'position': impression.orderno || position\n              };\n            }, \"Z73+4R/hpw2E6zb+aSjadZkDxQg=\", false, function () {\n              return [_useFunction.useTotalPrice, _useFunction.useTotalPrice];\n            }))\n          }\n        }\n      });\n    },\n    setAddRoom: function setAddRoom(_ref5) {\n      var _ref5$eventLabel = _ref5.eventLabel,\n          eventLabel = _ref5$eventLabel === void 0 ? '' : _ref5$eventLabel,\n          hotelName = _ref5.hotelName,\n          hotelId = _ref5.hotelId,\n          ciDate = _ref5.ciDate,\n          coDate = _ref5.coDate,\n          adult = _ref5.adult,\n          child = _ref5.child,\n          _ref5$currencyCode = _ref5.currencyCode,\n          currencyCode = _ref5$currencyCode === void 0 ? '' : _ref5$currencyCode,\n          _ref5$addToCartData = _ref5.addToCartData,\n          addToCartData = _ref5$addToCartData === void 0 ? [] : _ref5$addToCartData;\n      TagManager.resetPrevious();\n      TagManager.dataLayer({\n        dataLayer: {\n          'eventLabel': eventLabel,\n          'eventCategory': 'Enhanced Ecommerce',\n          'eventAction': 'Add to Cart',\n          'event': 'addToCart',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'ecommerce': {\n            'ciDate': ciDate,\n            'coDate': coDate,\n            'adult': adult,\n            'child': child,\n            'currencyCode': (0, _useFunction.getCurrencyCodeToIso)(currencyCode),\n            'actionField': {\n              'step': 2,\n              'option': 'Add to Cart'\n            },\n            'add': {\n              'products': addToCartData\n            }\n          }\n        }\n      });\n    },\n    setRemoveRoom: function setRemoveRoom(_ref6) {\n      var _ref6$eventLabel = _ref6.eventLabel,\n          eventLabel = _ref6$eventLabel === void 0 ? '' : _ref6$eventLabel,\n          hotelName = _ref6.hotelName,\n          hotelId = _ref6.hotelId,\n          ciDate = _ref6.ciDate,\n          coDate = _ref6.coDate,\n          adult = _ref6.adult,\n          child = _ref6.child,\n          _ref6$currencyCode = _ref6.currencyCode,\n          currencyCode = _ref6$currencyCode === void 0 ? '' : _ref6$currencyCode,\n          _ref6$removeToCartDat = _ref6.removeToCartData,\n          removeToCartData = _ref6$removeToCartDat === void 0 ? [] : _ref6$removeToCartDat;\n      TagManager.resetPrevious();\n      TagManager.dataLayer({\n        dataLayer: {\n          'eventLabel': eventLabel,\n          'eventCategory': 'Enhanced Ecommerce',\n          'eventAction': 'Remove to Cart',\n          'event': 'removeFromCart',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'ecommerce': {\n            'ciDate': ciDate,\n            'coDate': coDate,\n            'adult': adult,\n            'child': child,\n            'currencyCode': (0, _useFunction.getCurrencyCodeToIso)(currencyCode),\n            'remove': {\n              'products': removeToCartData\n            }\n          }\n        }\n      });\n    },\n    setCheckoutRoom: function setCheckoutRoom(_ref7) {\n      var _ref7$eventLabel = _ref7.eventLabel,\n          eventLabel = _ref7$eventLabel === void 0 ? '' : _ref7$eventLabel,\n          hotelName = _ref7.hotelName,\n          hotelId = _ref7.hotelId,\n          payOption = _ref7.payOption,\n          _ref7$checkoutData = _ref7.checkoutData,\n          checkoutData = _ref7$checkoutData === void 0 ? [] : _ref7$checkoutData;\n      TagManager.resetPrevious();\n      TagManager.dataLayer({\n        dataLayer: {\n          'eventLabel': eventLabel,\n          'eventCategory': 'Enhanced Ecommerce',\n          'eventAction': 'Checkout',\n          'event': 'checkout',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'ecommerce': {\n            'checkout': {\n              'actionField': {\n                'payOption': payOption || ''\n              },\n              'products': checkoutData.map(function (checkout) {\n                return {\n                  'reservNo': checkout.reservno,\n                  'id': checkout.roomtypeid,\n                  'name': checkout.roomtypename,\n                  'price': global.helper.formatPrice(checkout.totalprice),\n                  'qty': 1,\n                  'category': 'Room'\n                };\n              })\n            }\n          }\n        }\n      });\n    },\n    setPurchaseRoom: function setPurchaseRoom(_ref8) {\n      var _ref8$eventLabel = _ref8.eventLabel,\n          eventLabel = _ref8$eventLabel === void 0 ? '' : _ref8$eventLabel,\n          _ref8$hotelName = _ref8.hotelName,\n          hotelName = _ref8$hotelName === void 0 ? '' : _ref8$hotelName,\n          _ref8$hotelId = _ref8.hotelId,\n          hotelId = _ref8$hotelId === void 0 ? '' : _ref8$hotelId,\n          _ref8$masterReservNo = _ref8.masterReservNo,\n          masterReservNo = _ref8$masterReservNo === void 0 ? '' : _ref8$masterReservNo,\n          _ref8$revenue = _ref8.revenue,\n          revenue = _ref8$revenue === void 0 ? '' : _ref8$revenue,\n          _ref8$coupon = _ref8.coupon,\n          coupon = _ref8$coupon === void 0 ? '' : _ref8$coupon,\n          _ref8$purchaseData = _ref8.purchaseData,\n          purchaseData = _ref8$purchaseData === void 0 ? [] : _ref8$purchaseData;\n      TagManager.resetPrevious();\n      TagManager.dataLayer({\n        dataLayer: {\n          'eventLabel': eventLabel,\n          'eventCategory': 'Enhanced Ecommerce',\n          'eventAction': 'Purchase',\n          'event': 'purchase',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'ecommerce': {\n            'purchase': {\n              'actionField': {\n                'id': masterReservNo,\n                'affiliation': 'Online Booking',\n                'revenue': revenue,\n                'coupon': coupon,\n                'step': 4,\n                'option': 'Purchase'\n              },\n              'products': purchaseData.map(function (purchase) {\n                return {\n                  'reservNo': purchase.reservno,\n                  'id': purchase.roomtypeid,\n                  'name': purchase.roomtypename,\n                  'price': global.helper.formatPrice(purchase.totalprice),\n                  'qty': 1,\n                  'category': 'Room'\n                };\n              })\n            }\n          }\n        }\n      });\n    }\n  }\n};\nmodule.exports = TagManager;","map":{"version":3,"sources":["/Users/mata/app-cloudweb/@webcms-globals/tag-manager/TagManager.js"],"names":["TagManager","dataScript","dataLayer","script","document","createElement","innerHTML","gtm","args","snippets","Snippets","tags","noScript","noscript","iframe","dataLayerVar","initialize","gtmId","events","dataLayerName","auth","preview","id","undefined","head","appendChild","insertBefore","childNodes","body","window","push","getActionFieldForPageView","pageStep","resetPrevious","page","setChange","hotelName","hotelId","pageTitle","pagePath","isGuest","Object","assign","booking","setRoomList","eventLabel","ciDate","coDate","adult","child","currencyCode","impressionsData","map","impression","position","totalPrice","priceList","discTotalPrice","description","global","helper","formatPrice","totalroom","orderno","useTotalPrice","setAddRoom","addToCartData","setRemoveRoom","removeToCartData","setCheckoutRoom","payOption","checkoutData","checkout","reservno","roomtypeid","roomtypename","totalprice","setPurchaseRoom","masterReservNo","revenue","coupon","purchaseData","purchase","module","exports"],"mappings":"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","sourcesContent":["import * as global from '@webcms-globals'\nimport Snippets from './Snippets'\nimport { useTotalPrice, getCurrencyCodeToIso } from 'lib/helpers/useFunction'\n\nconst TagManager = {\n    dataScript: function (dataLayer) {\n        const script = document.createElement('script')\n        script.innerHTML = dataLayer\n        return script\n    },\n    gtm: function (args) {\n        const snippets = Snippets.tags(args)\n        const noScript = () => {\n            const noscript = document.createElement('noscript')\n            noscript.innerHTML = snippets.iframe\n            return noscript\n        }\n        const script = () => {\n            const script = document.createElement('script')\n            script.innerHTML = snippets.script\n            return script\n        }\n        const dataScript = this.dataScript(snippets.dataLayerVar)\n        return {\n            noScript,\n            script,\n            dataScript\n        }\n    },\n    initialize: function ({ gtmId, events = {}, dataLayer, dataLayerName = 'dataLayer', auth = '', preview = '' }) {\n        const gtm = this.gtm({\n            id: gtmId,\n            events: events,\n            dataLayer: dataLayer || undefined,\n            dataLayerName: dataLayerName,\n            auth,\n            preview\n        })\n        if (dataLayer) document.head.appendChild(gtm.dataScript)\n        document.head.insertBefore(gtm.script(), document.head.childNodes[0])\n        document.body.insertBefore(gtm.noScript(), document.body.childNodes[0])\n    },\n    dataLayer: function ({dataLayer, dataLayerName = 'dataLayer'}) {\n        if (window[dataLayerName]) return window[dataLayerName].push(dataLayer)\n        const snippets = Snippets.dataLayer(dataLayer, dataLayerName)\n        const dataScript = this.dataScript(snippets)\n        document.head.insertBefore(dataScript, document.head.childNodes[0])\n    },\n    getActionFieldForPageView: function(pageStep) {\n        switch (pageStep) {\n            case 'Preview':\n                return {\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'ecommerce': {\n                        'actionField': { 'step': 3, 'option': 'Preview' },\n                    }\n                }\n            default:\n                return {}\n        }\n    },\n    resetPrevious: function(){\n        TagManager.dataLayer({\n            dataLayer: {\n                'eventCategory': null,\n                'ecommerce': null,\n            },\n        })\n    },\n    page: {\n        setChange: function({ hotelName, hotelId, pageTitle = '', pagePath = '', pageStep = '', isGuest = false}) {\n            TagManager.resetPrevious()\n            TagManager.dataLayer({\n                dataLayer: Object.assign({\n                    'eventLabel': 'Page View',\n                    'event': 'Pageview',\n                    'eventAction': 'Page View',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'pagePath': pagePath,\n                    'pageTitle': pageTitle,\n                    'pageStep': pageStep,\n                    'visitorType': isGuest ? 'guest' : 'visitor',\n                }, TagManager.getActionFieldForPageView(pageStep)),\n            })\n        },\n    },\n    booking: {\n        setRoomList: function({ eventLabel = '', hotelName, hotelId, ciDate, coDate, adult, child, currencyCode = '', impressionsData = [] }) {\n            TagManager.resetPrevious()\n            TagManager.dataLayer({\n                dataLayer: {\n                    'eventLabel': eventLabel,\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'eventAction': 'Product Impression',\n                    'event': 'productImpression',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'ecommerce': {\n                        'ciDate': ciDate,\n                        'coDate': coDate,\n                        'adult': adult,\n                        'child': child,\n                        'currencyCode': getCurrencyCodeToIso(currencyCode),\n                        'actionField': { 'step': 1, 'option': 'Product Impression' },\n                        'impressions': impressionsData.map((impression, position) => {\n                            const totalPrice = useTotalPrice(impression.priceList, adult).discTotalPrice || useTotalPrice(impression.priceList, adult).totalPrice || 0\n                            return {\n                                'name': impression.description,\n                                'id': impression.id,\n                                'price': global.helper.formatPrice(totalPrice),\n                                'quantity': impression.totalroom,\n                                'category': 'Room',\n                                'list': 'Search Results',\n                                'position': impression.orderno || position\n                            }\n                        })\n                    },\n                },\n            })\n        },\n        setAddRoom: function({ eventLabel = '', hotelName, hotelId, ciDate, coDate, adult, child, currencyCode = '', addToCartData = [] }){\n            TagManager.resetPrevious()\n            TagManager.dataLayer({\n                dataLayer: {\n                    'eventLabel': eventLabel,\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'eventAction': 'Add to Cart',\n                    'event': 'addToCart',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'ecommerce': {\n                        'ciDate': ciDate,\n                        'coDate': coDate,\n                        'adult': adult,\n                        'child': child,\n                        'currencyCode': getCurrencyCodeToIso(currencyCode),\n                        'actionField': { 'step': 2, 'option': 'Add to Cart' },\n                        'add': {\n                            'products': addToCartData\n                        }\n                    },\n                },\n            })\n        },\n        setRemoveRoom: function({ eventLabel = '', hotelName, hotelId, ciDate, coDate, adult, child, currencyCode = '', removeToCartData = [] }){\n            TagManager.resetPrevious()\n            TagManager.dataLayer({\n                dataLayer: {\n                    'eventLabel': eventLabel,\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'eventAction': 'Remove to Cart',\n                    'event': 'removeFromCart',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'ecommerce': {\n                        'ciDate': ciDate,\n                        'coDate': coDate,\n                        'adult': adult,\n                        'child': child,\n                        'currencyCode': getCurrencyCodeToIso(currencyCode),\n                        'remove': {\n                            'products': removeToCartData\n                        }\n                    },\n                },\n            })\n        },\n        setCheckoutRoom: function({ eventLabel = '', hotelName, hotelId, payOption, checkoutData = [] }){\n            TagManager.resetPrevious()\n            TagManager.dataLayer({\n                dataLayer: {\n                    'eventLabel': eventLabel,\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'eventAction': 'Checkout',\n                    'event': 'checkout',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'ecommerce': {\n                        'checkout': {\n                            'actionField': { 'payOption': payOption || '' },\n                            'products': checkoutData.map((checkout) => {\n                                return {\n                                    'reservNo': checkout.reservno,\n                                    'id': checkout.roomtypeid,\n                                    'name': checkout.roomtypename,\n                                    'price': global.helper.formatPrice(checkout.totalprice),\n                                    'qty': 1,\n                                    'category': 'Room'\n                                }\n                            })\n                        }\n                    }\n                },\n            })\n        },\n        setPurchaseRoom: function({ eventLabel = '', hotelName = '', hotelId = '', masterReservNo = '', revenue = '', coupon = '', purchaseData = [] }){\n            TagManager.resetPrevious()\n            TagManager.dataLayer({\n                dataLayer: {\n                    'eventLabel': eventLabel,\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'eventAction': 'Purchase',\n                    'event': 'purchase',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'ecommerce': {\n                        'purchase': {\n                            'actionField':  {\n                                'id': masterReservNo,\n                                'affiliation': 'Online Booking',\n                                'revenue': revenue,\n                                'coupon': coupon,\n                                'step': 4,\n                                'option': 'Purchase'\n                            },\n                            'products': purchaseData.map((purchase) => {\n                                return {\n                                    'reservNo': purchase.reservno,\n                                    'id': purchase.roomtypeid,\n                                    'name': purchase.roomtypename,\n                                    'price': global.helper.formatPrice(purchase.totalprice),\n                                    'qty': 1,\n                                    'category': 'Room'\n                                }\n                            })\n                        }\n                    }\n                },\n            })\n        },\n    }\n}\n\nmodule.exports = TagManager"]},"metadata":{},"sourceType":"script"}
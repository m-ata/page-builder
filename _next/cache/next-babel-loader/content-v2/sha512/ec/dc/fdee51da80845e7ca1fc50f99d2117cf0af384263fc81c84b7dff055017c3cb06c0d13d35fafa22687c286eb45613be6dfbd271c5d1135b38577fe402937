{"ast":null,"code":"import _regeneratorRuntime from \"/Users/mata/app-cloudweb/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _toConsumableArray from \"/Users/mata/app-cloudweb/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"/Users/mata/app-cloudweb/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"/Users/mata/app-cloudweb/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/mata/app-cloudweb/pages/booking/index.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useContext, useEffect, useState } from 'react';\nimport axios from 'axios';\nimport moment from 'moment';\nimport { connect, useSelector } from 'react-redux';\nimport BookingPage from 'components/booking/BookingPage';\nimport { OREST_ENDPOINT } from 'model/orest/constants';\nimport WebCmsGlobal from 'components/webcms-global';\nimport { setToState as _setToState } from 'state/actions';\nimport Backdrop from '@material-ui/core/Backdrop';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useRouter } from 'next/router';\nimport TagManager from '@webcms-globals/tag-manager';\nimport { defaultLocale } from 'lib/translations/config';\n\nvar getCacheKey = function getCacheKey(baseUrl) {\n  return axios({\n    url: baseUrl + 'api/create/cache/key',\n    method: 'post'\n  }).then(function (response) {\n    if (response.status === 200 && response.data.success) {\n      return response.data.value;\n    } else {\n      return false;\n    }\n  })[\"catch\"](function () {\n    return false;\n  });\n};\n\nvar getHotelBookInfo = function getHotelBookInfo(baseUrl, uiToken) {\n  return axios({\n    url: baseUrl + 'api/hotel/book/info/check',\n    method: 'post',\n    params: {\n      startdate: moment(moment()).locale(defaultLocale).format(OREST_ENDPOINT.DATEFORMAT),\n      uitoken: uiToken\n    }\n  }).then(function (response) {\n    if (response.status === 200 && response.data.success) {\n      return response.data.data;\n    } else {\n      return false;\n    }\n  })[\"catch\"](function () {\n    return false;\n  });\n};\n\nvar getAvailabilityRoomList = function getAvailabilityRoomList(baseUrl, uitoken, query) {\n  var useParams = {\n    uitoken: uitoken,\n    ci: moment(query.checkinDate).locale(defaultLocale).format(OREST_ENDPOINT.DATEFORMAT),\n    co: moment(query.checkoutDate).locale(defaultLocale).format(OREST_ENDPOINT.DATEFORMAT),\n    resdate: moment(moment()).locale(defaultLocale).format(OREST_ENDPOINT.DATEFORMAT),\n    adult: query.adult,\n    child: query.child,\n    totalroom: query.totalroom\n  };\n\n  if (query.clientid) {\n    useParams.clientid = query.clientid;\n  }\n\n  if (query.pricecurr) {\n    useParams.pricecurr = query.pricecurr;\n  }\n\n  if (query.refcode) {\n    useParams.refcode = query.refcode;\n  }\n\n  return axios({\n    url: baseUrl + 'api/roomtype/book/list',\n    method: 'post',\n    params: useParams\n  }).then(function (roomAvailabilityResponse) {\n    var roomAvailabilityData = roomAvailabilityResponse.data;\n\n    if (roomAvailabilityData.success === true && roomAvailabilityData.data.length > 0) {\n      return {\n        searchid: roomAvailabilityData.searchid,\n        data: roomAvailabilityData.data\n      };\n    } else {\n      return false;\n    }\n  });\n};\n\nvar getHotelPayType = function getHotelPayType(baseUrl, uiToken) {\n  return axios({\n    url: baseUrl + 'api/hotel/payment/type',\n    method: 'post',\n    params: {\n      uitoken: uiToken\n    }\n  }).then(function (response) {\n    if (response.status === 200) {\n      return response.data;\n    } else {\n      return false;\n    }\n  })[\"catch\"](function () {\n    return false;\n  });\n};\n\nvar useStyles = makeStyles(function (theme) {\n  return {\n    backdrop: {\n      zIndex: theme.zIndex.drawer + 1,\n      color: '#fff'\n    }\n  };\n});\n\nvar IndexPage = function IndexPage(props) {\n  _s();\n\n  var state = props.state,\n      setToState = props.setToState,\n      hideLayout = props.hideLayout;\n\n  var _useContext = useContext(WebCmsGlobal),\n      GENERAL_SETTINGS = _useContext.GENERAL_SETTINGS,\n      WEBCMS_DATA = _useContext.WEBCMS_DATA;\n\n  var isLogin = !!useSelector(function (state) {\n    return state.orest.currentUser && state.orest.currentUser.auth;\n  });\n  var infoLogin = useSelector(function (state) {\n    return state.orest.currentUser && state.orest.currentUser.loginfo || false;\n  });\n\n  var _useState = useState({\n    hotelUiToken: false,\n    hotelPaymentType: false\n  }),\n      initialState = _useState[0],\n      setInitialState = _useState[1];\n\n  var classes = useStyles();\n  var router = useRouter();\n  var params = {\n    ci: router.query.ci || false,\n    co: router.query.co || false,\n    adult: router.query.adult || false,\n    child: router.query.child || false,\n    chdage: router.query['chdage[]'] || false,\n    pricecurr: router.query.pricecurr || false\n  };\n  useEffect(function () {\n    var _WEBCMS_DATA$assets, _WEBCMS_DATA$assets$m;\n\n    if (WEBCMS_DATA !== null && WEBCMS_DATA !== void 0 && (_WEBCMS_DATA$assets = WEBCMS_DATA.assets) !== null && _WEBCMS_DATA$assets !== void 0 && (_WEBCMS_DATA$assets$m = _WEBCMS_DATA$assets.meta) !== null && _WEBCMS_DATA$assets$m !== void 0 && _WEBCMS_DATA$assets$m.googleTag) {\n      var _WEBCMS_DATA$assets2, _WEBCMS_DATA$assets2$;\n\n      TagManager.page.setChange({\n        hotelName: WEBCMS_DATA === null || WEBCMS_DATA === void 0 ? void 0 : (_WEBCMS_DATA$assets2 = WEBCMS_DATA.assets) === null || _WEBCMS_DATA$assets2 === void 0 ? void 0 : (_WEBCMS_DATA$assets2$ = _WEBCMS_DATA$assets2.meta) === null || _WEBCMS_DATA$assets2$ === void 0 ? void 0 : _WEBCMS_DATA$assets2$.title,\n        hotelId: GENERAL_SETTINGS.HOTELREFNO,\n        pageTitle: window.document.title,\n        pagePath: location.href,\n        pageStep: 'Room List',\n        isGuest: isLogin\n      });\n    }\n\n    loadHotelBookInfoSett();\n  }, []);\n\n  var loadHotelBookInfoSett = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _hotelPaymentType;\n\n      var hotelUiToken, hotelPaymentType, hotelBookingInfo, defaultPayType, _hotelBookingInfo, _hotelBookingInfo4, CHECKIN_DATE, CHECKOUT_DATE, _hotelBookingInfo2, _GENERAL_SETTINGS$hot, maxPax, defPax, usePax, childState, childAgesState, _hotelBookingInfo3, _GENERAL_SETTINGS$hot2, _maxPax, _defPax, _usePax, useCurrency, diffDate;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              hotelUiToken = initialState.hotelUiToken, hotelPaymentType = initialState.hotelPaymentType;\n\n              if (hotelUiToken) {\n                _context.next = 6;\n                break;\n              }\n\n              _context.next = 4;\n              return getCacheKey(GENERAL_SETTINGS.BASE_URL);\n\n            case 4:\n              hotelUiToken = _context.sent;\n              setInitialState(_objectSpread(_objectSpread({}, initialState), {}, {\n                hotelUiToken: hotelUiToken\n              }));\n\n            case 6:\n              if (hotelPaymentType) {\n                _context.next = 11;\n                break;\n              }\n\n              _context.next = 9;\n              return getHotelPayType(GENERAL_SETTINGS.BASE_URL, hotelUiToken);\n\n            case 9:\n              hotelPaymentType = _context.sent;\n              setInitialState(_objectSpread(_objectSpread({}, initialState), {}, {\n                hotelPaymentType: hotelPaymentType\n              }));\n\n            case 11:\n              hotelBookingInfo = false;\n\n              if (state.hotelBookingInfo) {\n                _context.next = 18;\n                break;\n              }\n\n              _context.next = 15;\n              return getHotelBookInfo(GENERAL_SETTINGS.BASE_URL, hotelUiToken);\n\n            case 15:\n              hotelBookingInfo = _context.sent;\n              setToState('ibe', ['hotelUiToken'], hotelUiToken);\n              setToState('ibe', ['hotelBookingInfo'], hotelBookingInfo);\n\n            case 18:\n              if (!state.hotelPaymentType && ((_hotelPaymentType = hotelPaymentType) === null || _hotelPaymentType === void 0 ? void 0 : _hotelPaymentType.paymentypes.length) > 0) {\n                setToState('ibe', ['hotelPaymentType'], hotelPaymentType);\n                defaultPayType = hotelPaymentType && hotelPaymentType.paymentypes && hotelPaymentType.paymentypes.sort(function (a, b) {\n                  return a.index - b.index;\n                }).sort(function (a, b) {\n                  return b.isdef - a.isdef;\n                })[0];\n                setToState('ibe', ['selectedPaymentType'], defaultPayType);\n                setToState('ibe', ['selectedPaymentTypeId'], Number(defaultPayType.id || false));\n              }\n\n              if (state.bookingState.stayDates[0] === null && state.bookingState.stayDates[1] === null) {\n                CHECKIN_DATE = (params === null || params === void 0 ? void 0 : params.ci) && moment(params.ci, OREST_ENDPOINT.DATEFORMAT_PARAMS) || ((_hotelBookingInfo = hotelBookingInfo) === null || _hotelBookingInfo === void 0 ? void 0 : _hotelBookingInfo.startdate) && moment(hotelBookingInfo.startdate, OREST_ENDPOINT.DATEFORMAT).isAfter(moment()) && moment(hotelBookingInfo.startdate, OREST_ENDPOINT.DATEFORMAT) || moment(), CHECKOUT_DATE = (params === null || params === void 0 ? void 0 : params.co) && moment(params.co, OREST_ENDPOINT.DATEFORMAT_PARAMS) || moment(CHECKIN_DATE).add(1, 'days');\n\n                if (params.adult || params.child) {\n                  if (hotelBookingInfo.maxpax >= params.adult) {\n                    setToState('ibe', ['bookingState', 'adult'], params.adult && Number(params.adult) || 1);\n                  } else {\n                    maxPax = ((_hotelBookingInfo2 = hotelBookingInfo) === null || _hotelBookingInfo2 === void 0 ? void 0 : _hotelBookingInfo2.maxpax) || 0;\n                    defPax = (GENERAL_SETTINGS === null || GENERAL_SETTINGS === void 0 ? void 0 : (_GENERAL_SETTINGS$hot = GENERAL_SETTINGS.hotelSettings) === null || _GENERAL_SETTINGS$hot === void 0 ? void 0 : _GENERAL_SETTINGS$hot.defpax) || 0;\n                    usePax = maxPax >= defPax ? defPax : maxPax;\n                    setToState('ibe', ['bookingState', 'adult'], usePax || maxPax);\n                  }\n\n                  childState = 0;\n                  childAgesState = [];\n                  Array.from({\n                    length: Number(params.child)\n                  }).map(function (chd, i) {\n                    if (hotelBookingInfo.maxchd >= i) {\n                      childState = i + 1;\n                      var queryChdAge = (params === null || params === void 0 ? void 0 : params.chdage[i]) && Number(params.chdage[i]) || 1;\n\n                      if (queryChdAge > hotelBookingInfo.maxchdage) {\n                        queryChdAge = hotelBookingInfo.maxchdage;\n                      }\n\n                      var newValue = {\n                        ageno: childState,\n                        age: queryChdAge,\n                        indexno: childState\n                      };\n                      childAgesState = [].concat(_toConsumableArray(childAgesState), [newValue]);\n                    }\n                  });\n                  setToState('ibe', ['bookingState', 'child'], childState);\n                  setToState('ibe', ['childAges'], childAgesState);\n                } else {\n                  _maxPax = ((_hotelBookingInfo3 = hotelBookingInfo) === null || _hotelBookingInfo3 === void 0 ? void 0 : _hotelBookingInfo3.maxpax) || 0;\n                  _defPax = (GENERAL_SETTINGS === null || GENERAL_SETTINGS === void 0 ? void 0 : (_GENERAL_SETTINGS$hot2 = GENERAL_SETTINGS.hotelSettings) === null || _GENERAL_SETTINGS$hot2 === void 0 ? void 0 : _GENERAL_SETTINGS$hot2.defpax) || 0;\n                  _usePax = _maxPax >= _defPax ? _defPax : _maxPax;\n                  setToState('ibe', ['bookingState', 'adult'], _usePax || 1);\n                }\n\n                if (params.pricecurr && hotelBookingInfo.currencycode !== params.pricecurr && (_hotelBookingInfo4 = hotelBookingInfo) !== null && _hotelBookingInfo4 !== void 0 && _hotelBookingInfo4.currencyList) {\n                  useCurrency = hotelBookingInfo.currencyList.filter(function (currency) {\n                    return currency.code === params.pricecurr;\n                  });\n\n                  if ((useCurrency === null || useCurrency === void 0 ? void 0 : useCurrency.length) > 0) {\n                    setToState('ibe', ['diffCurrency', 'use'], useCurrency[0].code);\n                    setToState('ibe', ['diffCurrency', 'value'], useCurrency[0].code);\n                  }\n                }\n\n                diffDate = CHECKOUT_DATE.diff(CHECKIN_DATE, 'days');\n                setToState('ibe', ['bookingState', 'stayDates'], [CHECKIN_DATE, CHECKOUT_DATE]);\n                setToState('ibe', ['bookingState', 'night'], diffDate);\n              }\n\n            case 20:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function loadHotelBookInfoSett() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleGetRoomList = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var _WEBCMS_DATA$assets3, _WEBCMS_DATA$assets3$, _getRoomList$data$, _window, _window2;\n\n      var useParams, getRoomList, _WEBCMS_DATA$assets4, _WEBCMS_DATA$assets4$, _state$diffCurrency, _getRoomList$data$2;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(state.selectedRooms && state.selectedRooms.length > 0 && state.diffCurrency.value !== state.diffCurrency.use)) {\n                _context2.next = 3;\n                break;\n              }\n\n              setToState('ibe', ['diffCurrency', 'isAlert'], true);\n              return _context2.abrupt(\"return\");\n\n            case 3:\n              setToState('ibe', ['bookingIsLoading'], true);\n              setToState('ibe', ['roomAvailabilityList'], []);\n              useParams = {\n                checkinDate: state.bookingState.stayDates[0],\n                checkoutDate: state.bookingState.stayDates[1],\n                adult: state.bookingState.adult,\n                child: state.bookingState.child,\n                totalroom: 1\n              };\n\n              if (infoLogin && infoLogin !== null && infoLogin !== void 0 && infoLogin.refid) {\n                useParams.clientid = infoLogin.refid;\n              }\n\n              if (state.bookingState.refcode) {\n                useParams.refcode = state.bookingState.refcode;\n              }\n\n              if (state.diffCurrency.value) {\n                useParams.pricecurr = state.diffCurrency.value;\n              }\n\n              _context2.next = 11;\n              return getAvailabilityRoomList(GENERAL_SETTINGS.BASE_URL, state.hotelUiToken, useParams);\n\n            case 11:\n              getRoomList = _context2.sent;\n\n              if (WEBCMS_DATA !== null && WEBCMS_DATA !== void 0 && (_WEBCMS_DATA$assets3 = WEBCMS_DATA.assets) !== null && _WEBCMS_DATA$assets3 !== void 0 && (_WEBCMS_DATA$assets3$ = _WEBCMS_DATA$assets3.meta) !== null && _WEBCMS_DATA$assets3$ !== void 0 && _WEBCMS_DATA$assets3$.googleTag) {\n                TagManager.booking.setRoomList({\n                  eventLabel: 'Room List',\n                  hotelName: WEBCMS_DATA === null || WEBCMS_DATA === void 0 ? void 0 : (_WEBCMS_DATA$assets4 = WEBCMS_DATA.assets) === null || _WEBCMS_DATA$assets4 === void 0 ? void 0 : (_WEBCMS_DATA$assets4$ = _WEBCMS_DATA$assets4.meta) === null || _WEBCMS_DATA$assets4$ === void 0 ? void 0 : _WEBCMS_DATA$assets4$.title,\n                  hotelId: GENERAL_SETTINGS.HOTELREFNO,\n                  ciDate: moment(useParams.checkinDate).format(OREST_ENDPOINT.DATEFORMAT),\n                  coDate: moment(useParams.checkoutDate).format(OREST_ENDPOINT.DATEFORMAT),\n                  adult: useParams.adult,\n                  child: useParams.child,\n                  currencyCode: (state === null || state === void 0 ? void 0 : (_state$diffCurrency = state.diffCurrency) === null || _state$diffCurrency === void 0 ? void 0 : _state$diffCurrency.value) || state.hotelBookingInfo.currencycode,\n                  impressionsData: getRoomList.data\n                });\n              }\n\n              if (state.diffCurrency.value && state.diffCurrency.value === (getRoomList === null || getRoomList === void 0 ? void 0 : (_getRoomList$data$ = getRoomList.data[0]) === null || _getRoomList$data$ === void 0 ? void 0 : _getRoomList$data$.pricecurr)) {\n                setToState('ibe', ['diffCurrency', 'use'], getRoomList === null || getRoomList === void 0 ? void 0 : (_getRoomList$data$2 = getRoomList.data[0]) === null || _getRoomList$data$2 === void 0 ? void 0 : _getRoomList$data$2.pricecurr);\n              } else {\n                setToState('ibe', ['diffCurrency', 'use'], false);\n              }\n\n              if (((_window = window) === null || _window === void 0 ? void 0 : _window.innerWidth) <= 959 && ((_window2 = window) === null || _window2 === void 0 ? void 0 : _window2.pageYOffset) <= 500) {\n                window.scrollTo({\n                  top: 542,\n                  behavior: \"smooth\"\n                });\n              }\n\n              setToState('ibe', ['roomAvailabilityList'], getRoomList.data);\n              setToState('ibe', ['searchid'], getRoomList.searchid);\n              setToState('ibe', ['bookingIsLoading'], false);\n              setToState('ibe', ['hotelBookingBackdrop'], false);\n              setToState('ibe', ['bookingIsChange'], false);\n\n            case 20:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleGetRoomList() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(React.Fragment, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 298,\n      columnNumber: 9\n    }\n  }, __jsx(BookingPage, {\n    callBackRoomList: function callBackRoomList() {\n      return handleGetRoomList();\n    },\n    hideLayout: hideLayout,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 299,\n      columnNumber: 13\n    }\n  }), __jsx(Backdrop, {\n    className: classes.backdrop,\n    open: state.hotelBookingBackdrop,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 300,\n      columnNumber: 13\n    }\n  }, __jsx(CircularProgress, {\n    color: \"inherit\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 301,\n      columnNumber: 17\n    }\n  })));\n};\n\n_s(IndexPage, \"OC9x4b5JTf+dpBPk3KiafYBZYk0=\", false, function () {\n  return [useSelector, useSelector, useStyles, useRouter];\n});\n\n_c = IndexPage;\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    state: state.formReducer.ibe\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    setToState: function setToState(stateType, stateName, value) {\n      return dispatch(_setToState(stateType, stateName, value));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(IndexPage);\n\nvar _c;\n\n$RefreshReg$(_c, \"IndexPage\");","map":{"version":3,"sources":["/Users/mata/app-cloudweb/pages/booking/index.js"],"names":["React","useContext","useEffect","useState","axios","moment","connect","useSelector","BookingPage","OREST_ENDPOINT","WebCmsGlobal","setToState","Backdrop","CircularProgress","makeStyles","useRouter","TagManager","defaultLocale","getCacheKey","baseUrl","url","method","then","response","status","data","success","value","getHotelBookInfo","uiToken","params","startdate","locale","format","DATEFORMAT","uitoken","getAvailabilityRoomList","query","useParams","ci","checkinDate","co","checkoutDate","resdate","adult","child","totalroom","clientid","pricecurr","refcode","roomAvailabilityResponse","roomAvailabilityData","length","searchid","getHotelPayType","useStyles","theme","backdrop","zIndex","drawer","color","IndexPage","props","state","hideLayout","GENERAL_SETTINGS","WEBCMS_DATA","isLogin","orest","currentUser","auth","infoLogin","loginfo","hotelUiToken","hotelPaymentType","initialState","setInitialState","classes","router","chdage","assets","meta","googleTag","page","setChange","hotelName","title","hotelId","HOTELREFNO","pageTitle","window","document","pagePath","location","href","pageStep","isGuest","loadHotelBookInfoSett","BASE_URL","hotelBookingInfo","paymentypes","defaultPayType","sort","a","b","index","isdef","Number","id","bookingState","stayDates","CHECKIN_DATE","DATEFORMAT_PARAMS","isAfter","CHECKOUT_DATE","add","maxpax","maxPax","defPax","hotelSettings","defpax","usePax","childState","childAgesState","Array","from","map","chd","i","maxchd","queryChdAge","maxchdage","newValue","ageno","age","indexno","currencycode","currencyList","useCurrency","filter","currency","code","diffDate","diff","handleGetRoomList","selectedRooms","diffCurrency","use","refid","getRoomList","booking","setRoomList","eventLabel","ciDate","coDate","currencyCode","impressionsData","innerWidth","pageYOffset","scrollTo","top","behavior","hotelBookingBackdrop","mapStateToProps","formReducer","ibe","mapDispatchToProps","dispatch","stateType","stateName"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from 'react'\nimport axios from 'axios'\nimport moment from 'moment'\nimport { connect, useSelector } from 'react-redux'\nimport BookingPage from 'components/booking/BookingPage'\nimport { OREST_ENDPOINT } from 'model/orest/constants'\nimport WebCmsGlobal from 'components/webcms-global'\nimport { setToState } from 'state/actions'\nimport Backdrop from '@material-ui/core/Backdrop'\nimport CircularProgress from '@material-ui/core/CircularProgress'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { useRouter } from 'next/router'\nimport TagManager from '@webcms-globals/tag-manager'\nimport { defaultLocale } from 'lib/translations/config'\n\nconst getCacheKey  = (baseUrl) => {\n    return axios({\n        url: baseUrl + 'api/create/cache/key',\n        method: 'post'\n    }).then((response) => {\n        if (response.status === 200 && response.data.success) {\n            return response.data.value\n        } else {\n            return false\n        }\n    }).catch(()=>{\n        return false\n    })\n}\n\nconst getHotelBookInfo = (baseUrl, uiToken) => {\n    return axios({\n        url: baseUrl + 'api/hotel/book/info/check',\n        method: 'post',\n        params: {\n            startdate: moment(moment()).locale(defaultLocale).format(OREST_ENDPOINT.DATEFORMAT),\n            uitoken: uiToken\n        },\n    }).then((response) => {\n        if (response.status === 200 && response.data.success) {\n            return response.data.data\n        } else {\n            return false\n        }\n    }).catch(() => {\n        return false\n    })\n}\n\nconst getAvailabilityRoomList = (baseUrl, uitoken, query) => {\n    let useParams = {\n        uitoken: uitoken,\n        ci: moment(query.checkinDate).locale(defaultLocale).format(OREST_ENDPOINT.DATEFORMAT),\n        co: moment(query.checkoutDate).locale(defaultLocale).format(OREST_ENDPOINT.DATEFORMAT),\n        resdate: moment(moment()).locale(defaultLocale).format(OREST_ENDPOINT.DATEFORMAT),\n        adult: query.adult,\n        child: query.child,\n        totalroom: query.totalroom,\n    }\n\n    if (query.clientid) {\n        useParams.clientid = query.clientid\n    }\n\n    if (query.pricecurr) {\n        useParams.pricecurr = query.pricecurr\n    }\n\n    if (query.refcode) {\n        useParams.refcode = query.refcode\n    }\n\n    return axios({\n        url: baseUrl + 'api/roomtype/book/list',\n        method: 'post',\n        params: useParams,\n    }).then((roomAvailabilityResponse) => {\n        const roomAvailabilityData = roomAvailabilityResponse.data\n        if (roomAvailabilityData.success === true && roomAvailabilityData.data.length > 0) {\n            return {\n                searchid: roomAvailabilityData.searchid,\n                data: roomAvailabilityData.data,\n            }\n        } else {\n            return false\n        }\n    })\n}\n\nconst getHotelPayType = (baseUrl, uiToken) => {\n    return axios({\n        url: baseUrl + 'api/hotel/payment/type',\n        method: 'post',\n        params: {\n            uitoken: uiToken,\n        },\n    }).then((response) => {\n        if (response.status === 200) {\n            return response.data\n        } else {\n            return false\n        }\n    }).catch(() => {\n        return false\n    })\n}\n\nconst useStyles = makeStyles((theme) => ({\n    backdrop: {\n        zIndex: theme.zIndex.drawer + 1,\n        color: '#fff',\n    },\n}))\n\nconst IndexPage = (props) => {\n    const { state, setToState, hideLayout } = props\n    const { GENERAL_SETTINGS, WEBCMS_DATA } = useContext(WebCmsGlobal)\n    const isLogin = !!useSelector((state) => state.orest.currentUser && state.orest.currentUser.auth)\n    const infoLogin = useSelector((state) => state.orest.currentUser && state.orest.currentUser.loginfo || false)\n    const [initialState, setInitialState] = useState({\n        hotelUiToken: false,\n        hotelPaymentType: false\n    })\n    const classes = useStyles()\n    const router = useRouter()\n    const params = {\n        ci: router.query.ci || false,\n        co: router.query.co || false,\n        adult: router.query.adult || false,\n        child: router.query.child || false,\n        chdage: router.query['chdage[]'] || false,\n        pricecurr: router.query.pricecurr || false\n    }\n\n    useEffect(() =>{\n        if(WEBCMS_DATA?.assets?.meta?.googleTag){\n            TagManager.page.setChange({\n                hotelName: WEBCMS_DATA?.assets?.meta?.title,\n                hotelId: GENERAL_SETTINGS.HOTELREFNO,\n                pageTitle: window.document.title,\n                pagePath: location.href,\n                pageStep: 'Room List',\n                isGuest: isLogin\n            })\n        }\n\n        loadHotelBookInfoSett()\n    } , [])\n\n    const loadHotelBookInfoSett = async () => {\n\n       let hotelUiToken = initialState.hotelUiToken,\n           hotelPaymentType = initialState.hotelPaymentType\n\n        if(!hotelUiToken){\n            hotelUiToken = await getCacheKey(GENERAL_SETTINGS.BASE_URL)\n            setInitialState({...initialState, hotelUiToken: hotelUiToken})\n        }\n\n        if(!hotelPaymentType){\n            hotelPaymentType = await getHotelPayType(GENERAL_SETTINGS.BASE_URL, hotelUiToken)\n            setInitialState({...initialState, hotelPaymentType: hotelPaymentType})\n        }\n\n        let hotelBookingInfo = false\n        if(!state.hotelBookingInfo){\n            hotelBookingInfo = await getHotelBookInfo(GENERAL_SETTINGS.BASE_URL, hotelUiToken)\n            setToState('ibe', ['hotelUiToken'], hotelUiToken)\n            setToState('ibe', ['hotelBookingInfo'], hotelBookingInfo)\n        }\n\n        if(!state.hotelPaymentType && hotelPaymentType?.paymentypes.length > 0){\n            setToState('ibe', ['hotelPaymentType'], hotelPaymentType)\n            const defaultPayType = hotelPaymentType && hotelPaymentType.paymentypes && hotelPaymentType.paymentypes.sort((a, b) => a.index - b.index).sort((a, b) => b.isdef - a.isdef)[0]\n            setToState('ibe', ['selectedPaymentType'], defaultPayType)\n            setToState('ibe', ['selectedPaymentTypeId'],  Number(defaultPayType.id || false))\n        }\n\n        if (state.bookingState.stayDates[0] === null && state.bookingState.stayDates[1] === null) {\n            let CHECKIN_DATE = params?.ci && moment(params.ci, OREST_ENDPOINT.DATEFORMAT_PARAMS) || hotelBookingInfo?.startdate && moment(hotelBookingInfo.startdate, OREST_ENDPOINT.DATEFORMAT).isAfter(moment()) && moment(hotelBookingInfo.startdate, OREST_ENDPOINT.DATEFORMAT) || moment()\n                ,CHECKOUT_DATE = params?.co && moment(params.co, OREST_ENDPOINT.DATEFORMAT_PARAMS) || moment(CHECKIN_DATE).add(1, 'days')\n\n            if (params.adult || params.child) {\n                if(hotelBookingInfo.maxpax >= params.adult){\n                    setToState('ibe', ['bookingState', 'adult'], params.adult && Number(params.adult) || 1)\n                }else{\n                    const maxPax = hotelBookingInfo?.maxpax || 0\n                    const defPax = GENERAL_SETTINGS?.hotelSettings?.defpax || 0\n                    const usePax = (maxPax >= defPax) ? defPax : maxPax\n                    setToState('ibe', ['bookingState', 'adult'], usePax || maxPax)\n                }\n\n                let childState = 0\n                let childAgesState = []\n                Array.from({ length: Number(params.child) }).map((chd, i) => {\n                    if (hotelBookingInfo.maxchd >= i) {\n                        childState = i + 1\n\n                        let queryChdAge = params?.chdage[i] && Number(params.chdage[i]) || 1\n                        if(queryChdAge > hotelBookingInfo.maxchdage){\n                            queryChdAge = hotelBookingInfo.maxchdage\n                        }\n\n                        const newValue = { ageno:  childState, age: queryChdAge, indexno: childState }\n                        childAgesState = [...childAgesState , newValue]\n                    }\n                })\n\n                setToState('ibe', ['bookingState', 'child'], childState)\n                setToState('ibe', ['childAges'], childAgesState)\n            }else{\n                const maxPax = hotelBookingInfo?.maxpax || 0\n                const defPax = GENERAL_SETTINGS?.hotelSettings?.defpax || 0\n                const usePax = (maxPax >= defPax) ? defPax : maxPax\n                setToState('ibe', ['bookingState', 'adult'], usePax || 1)\n            }\n\n            if (params.pricecurr && hotelBookingInfo.currencycode !== params.pricecurr && hotelBookingInfo?.currencyList) {\n                const useCurrency = hotelBookingInfo.currencyList.filter(currency => currency.code === params.pricecurr)\n                if (useCurrency?.length > 0) {\n                    setToState('ibe', ['diffCurrency', 'use'], useCurrency[0].code)\n                    setToState('ibe', ['diffCurrency', 'value'], useCurrency[0].code)\n                }\n            }\n\n            let diffDate = CHECKOUT_DATE.diff(CHECKIN_DATE, 'days')\n            setToState('ibe', ['bookingState', 'stayDates'], [CHECKIN_DATE, CHECKOUT_DATE])\n            setToState('ibe', ['bookingState', 'night'], diffDate)\n        }\n    }\n\n    const handleGetRoomList = async () => {\n        if((state.selectedRooms && state.selectedRooms.length > 0) && (state.diffCurrency.value !== state.diffCurrency.use)){\n            setToState('ibe', ['diffCurrency', 'isAlert'], true)\n            return;\n        }\n\n        setToState('ibe', ['bookingIsLoading'], true)\n        setToState('ibe', ['roomAvailabilityList'], [])\n\n        let useParams = {\n            checkinDate: state.bookingState.stayDates[0],\n            checkoutDate: state.bookingState.stayDates[1],\n            adult: state.bookingState.adult,\n            child: state.bookingState.child,\n            totalroom: 1\n        }\n\n        if(infoLogin && infoLogin?.refid){\n            useParams.clientid = infoLogin.refid\n        }\n\n        if(state.bookingState.refcode){\n            useParams.refcode = state.bookingState.refcode\n        }\n\n        if(state.diffCurrency.value){\n            useParams.pricecurr = state.diffCurrency.value\n        }\n\n        const getRoomList = await getAvailabilityRoomList(GENERAL_SETTINGS.BASE_URL, state.hotelUiToken, useParams)\n\n        if(WEBCMS_DATA?.assets?.meta?.googleTag){\n            TagManager.booking.setRoomList({\n                eventLabel: 'Room List',\n                hotelName: WEBCMS_DATA?.assets?.meta?.title,\n                hotelId: GENERAL_SETTINGS.HOTELREFNO,\n                ciDate: moment(useParams.checkinDate).format(OREST_ENDPOINT.DATEFORMAT),\n                coDate: moment(useParams.checkoutDate).format(OREST_ENDPOINT.DATEFORMAT),\n                adult: useParams.adult,\n                child: useParams.child,\n                currencyCode: state?.diffCurrency?.value || state.hotelBookingInfo.currencycode,\n                impressionsData: getRoomList.data\n            })\n        }\n\n        if(state.diffCurrency.value && state.diffCurrency.value === getRoomList?.data[0]?.pricecurr){\n            setToState('ibe', ['diffCurrency', 'use'], getRoomList?.data[0]?.pricecurr)\n        }else{\n            setToState('ibe', ['diffCurrency', 'use'], false)\n        }\n\n        if(window?.innerWidth <= 959 && window?.pageYOffset <= 500) {\n            window.scrollTo({\n                top: 542,\n                behavior: \"smooth\"\n            })\n        }\n\n        setToState('ibe', ['roomAvailabilityList'], getRoomList.data)\n        setToState('ibe', ['searchid'], getRoomList.searchid)\n        setToState('ibe', ['bookingIsLoading'], false)\n        setToState('ibe', ['hotelBookingBackdrop'], false)\n        setToState('ibe', ['bookingIsChange'], false)\n    }\n\n    return (\n        <React.Fragment>\n            <BookingPage callBackRoomList={() => handleGetRoomList()} hideLayout={hideLayout}/>\n            <Backdrop className={classes.backdrop} open={state.hotelBookingBackdrop}>\n                <CircularProgress color='inherit' />\n            </Backdrop>\n        </React.Fragment>\n    )\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        state: state.formReducer.ibe,\n    }\n}\n\nconst mapDispatchToProps = (dispatch) => ({\n    setToState: (stateType, stateName, value) => dispatch(setToState(stateType, stateName, value)),\n})\n\nexport default connect(mapStateToProps, mapDispatchToProps)(IndexPage)\n"]},"metadata":{},"sourceType":"module"}
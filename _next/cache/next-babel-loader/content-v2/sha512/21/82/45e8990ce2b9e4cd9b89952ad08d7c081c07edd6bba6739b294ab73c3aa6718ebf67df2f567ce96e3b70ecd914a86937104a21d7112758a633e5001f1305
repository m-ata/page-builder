{"ast":null,"code":"var _jsxFileName = \"/Users/mata/app-cloudweb/components/guest/account/Reservations/EventReservations.js\";\nvar __jsx = React.createElement;\nimport React, { useContext, useEffect, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport styles from './style/Reservations.style';\nimport stylesTabPanel from '../style/TabPanel.style';\nimport Typography from '@material-ui/core/Typography';\nimport Grid from '@material-ui/core/Grid';\nimport ExpandMore from '@material-ui/icons/ExpandMore';\nimport ExpandLess from '@material-ui/icons/ExpandLess';\nimport { ViewList, UseOrest } from '@webcms/orest';\nimport { isErrorMsg, jsonGroupBy, OREST_ENDPOINT, SUBMODULE } from 'model/orest/constants';\nimport WebCmsGlobal from 'components/webcms-global';\nimport LoadingSpinner from 'components/LoadingSpinner';\nimport Button from '@material-ui/core/Button';\nimport useNotifications from 'model/notification/useNotifications';\nimport { makeStyles } from '@material-ui/core/styles';\nimport TabHeader from '../../../layout/components/TabHeader';\nimport useTranslation from 'lib/translations/hooks/useTranslation';\nimport EventReservationCard from './EventReservationCard';\nimport ReservationCancelDialog from './ReservationCancelDialog';\nconst useStyles = makeStyles(styles);\nconst useStylesTabPanel = makeStyles(stylesTabPanel);\nexport default function EventReservation(props) {\n  const {\n    isWidget\n  } = props;\n  const classes = useStyles();\n  const classesTabPanel = useStylesTabPanel();\n  const {\n    GENERAL_SETTINGS\n  } = useContext(WebCmsGlobal);\n  const {\n    t\n  } = useTranslation(); //redux\n\n  const {\n    showError\n  } = useNotifications();\n  const token = useSelector(state => {\n    var _state$orest, _state$orest$currentU, _state$orest$currentU2;\n\n    return (state === null || state === void 0 ? void 0 : (_state$orest = state.orest) === null || _state$orest === void 0 ? void 0 : (_state$orest$currentU = _state$orest.currentUser) === null || _state$orest$currentU === void 0 ? void 0 : (_state$orest$currentU2 = _state$orest$currentU.auth) === null || _state$orest$currentU2 === void 0 ? void 0 : _state$orest$currentU2.access_token) || false;\n  });\n  const clientBase = useSelector(state => {\n    var _state$orest2, _state$orest2$state;\n\n    return (state === null || state === void 0 ? void 0 : (_state$orest2 = state.orest) === null || _state$orest2 === void 0 ? void 0 : (_state$orest2$state = _state$orest2.state) === null || _state$orest2$state === void 0 ? void 0 : _state$orest2$state.client) || false;\n  });\n  const loginBase = useSelector(state => {\n    var _state$orest3, _state$orest3$current;\n\n    return (state === null || state === void 0 ? void 0 : (_state$orest3 = state.orest) === null || _state$orest3 === void 0 ? void 0 : (_state$orest3$current = _state$orest3.currentUser) === null || _state$orest3$current === void 0 ? void 0 : _state$orest3$current.loginfo) || false;\n  }); //state\n\n  const {\n    0: moduleHashRight,\n    1: setModuleHashRight\n  } = useState(false);\n  const {\n    0: cancelReservationData,\n    1: setCancelReservationData\n  } = useState(false);\n  const {\n    0: events,\n    1: setEvents\n  } = useState([]);\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState(false);\n  const {\n    0: isInitialized,\n    1: setIsInitialized\n  } = useState(false);\n  const {\n    0: isDone,\n    1: setIsDone\n  } = useState(false);\n  const {\n    0: limit,\n    1: setLimit\n  } = useState(4);\n  const {\n    0: page,\n    1: setPage\n  } = useState(0);\n\n  const getEventListData = (active, fullReload = false) => {\n    setIsLoading(true);\n\n    if (fullReload) {\n      setIsInitialized(false);\n      setEvents([]);\n    }\n\n    ViewList({\n      apiUrl: GENERAL_SETTINGS.OREST_URL,\n      endpoint: OREST_ENDPOINT.RESEVENT,\n      token,\n      params: {\n        query: `clientid:${clientBase.id}`,\n        sort: 'startdate-',\n        limit: limit,\n        start: page * limit,\n        allhotels: true\n      }\n    }).then(r => {\n      if (active) {\n        if (r.status === 200) {\n          if (fullReload) {\n            setEvents(r.data.data);\n          } else {\n            setEvents([...events, ...r.data.data]);\n          }\n\n          setIsInitialized(true);\n          setIsLoading(false);\n\n          if (r.data.count < limit) {\n            setIsDone(true);\n          }\n        } else {\n          const retErr = isErrorMsg(r);\n          showError(retErr.errorMsg);\n          setIsInitialized(true);\n          setIsLoading(false);\n        }\n      }\n    });\n  };\n\n  useEffect(() => {\n    let active = true;\n\n    if (active) {\n      UseOrest({\n        apiUrl: GENERAL_SETTINGS.OREST_URL,\n        endpoint: 'tools/user/hasright',\n        token: token,\n        params: {\n          empid: loginBase.id,\n          submoduleid: SUBMODULE.RESEVENT\n        }\n      }).then(toolsUserHasRightResponse => {\n        var _toolsUserHasRightRes;\n\n        if (toolsUserHasRightResponse.status === 200 && toolsUserHasRightResponse !== null && toolsUserHasRightResponse !== void 0 && (_toolsUserHasRightRes = toolsUserHasRightResponse.data) !== null && _toolsUserHasRightRes !== void 0 && _toolsUserHasRightRes.data) {\n          setModuleHashRight(toolsUserHasRightResponse.data.data);\n        } else {\n          setModuleHashRight(false);\n        }\n      }).catch(() => {\n        setModuleHashRight(false);\n      });\n    }\n\n    return () => {\n      active = false;\n    };\n  }, []);\n  useEffect(() => {\n    let active = true;\n\n    if (active) {\n      if (isLoading) {\n        return undefined;\n      }\n\n      if (clientBase && clientBase.id) {\n        getEventListData(true);\n      } else {\n        setIsInitialized(true);\n      }\n    }\n\n    return () => {\n      active = false;\n    };\n  }, [page]);\n\n  const handleShowMore = () => {\n    setPage(page + 1);\n    window.scrollTo({\n      bottom: 0,\n      behavior: 'smooth'\n    });\n  };\n\n  const handleLess = () => {\n    setIsDone(false);\n    setIsInitialized(false);\n    setEvents([]);\n    setPage(0);\n    setLimit(4);\n    window.scrollTo({\n      top: 0,\n      behavior: 'smooth'\n    });\n  };\n\n  return __jsx(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 9\n    }\n  }, __jsx(Grid, {\n    container: true,\n    justify: 'center',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 13\n    }\n  }, __jsx(ReservationCancelDialog, {\n    reservation: cancelReservationData,\n    type: \"event\",\n    open: Boolean(cancelReservationData),\n    onClose: status => setCancelReservationData(!status),\n    getCallbackData: () => getEventListData(true, true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 17\n    }\n  }), isInitialized ? events.length > 0 ? Object.keys(jsonGroupBy(events, 'eventtypedesc')).map((eventtype, etIndex) => {\n    return __jsx(Grid, {\n      item: true,\n      xs: 12,\n      key: etIndex,\n      style: {\n        padding: 10\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 33\n      }\n    }, __jsx(Typography, {\n      variant: \"h6\",\n      gutterBottom: true,\n      className: classes.subTitle,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 37\n      }\n    }, t(eventtype)), __jsx(Grid, {\n      container: true,\n      justify: 'center',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 37\n      }\n    }, jsonGroupBy(events, 'eventtypedesc')[eventtype].map((eventitem, i) => {\n      return __jsx(EventReservationCard, {\n        event: eventitem,\n        key: i,\n        isCancel: moduleHashRight.canx || false,\n        cancelReservation: () => setCancelReservationData(eventitem),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 53\n        }\n      });\n    })));\n  }) : __jsx(Typography, {\n    component: \"h3\",\n    className: classesTabPanel.nothingToShow,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 25\n    }\n  }, t('str_widgetReservatListNoRecordYet')) : __jsx(Grid, {\n    item: true,\n    xs: 12,\n    className: classesTabPanel.gridItem,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 21\n    }\n  }, __jsx(LoadingSpinner, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 25\n    }\n  })), events.length > 0 && __jsx(Grid, {\n    item: true,\n    xs: 12,\n    className: classesTabPanel.gridItem,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 21\n    }\n  }, isLoading ? __jsx(LoadingSpinner, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 29\n    }\n  }) : !isDone ? __jsx(Grid, {\n    container: true,\n    direction: 'row',\n    justify: 'center',\n    alignItems: 'center',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 33\n    }\n  }, __jsx(Grid, {\n    item: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 37\n    }\n  }, __jsx(Button, {\n    onClick: () => handleShowMore(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 41\n    }\n  }, __jsx(Typography, {\n    variant: \"h5\",\n    className: classesTabPanel.showMoreText,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 45\n    }\n  }, t('str_showMore')), __jsx(ExpandMore, {\n    className: classesTabPanel.showMoreIcon,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 45\n    }\n  })))) : __jsx(Grid, {\n    container: true,\n    direction: 'row',\n    justify: 'center',\n    alignItems: 'center',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 33\n    }\n  }, __jsx(Grid, {\n    item: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 37\n    }\n  }, __jsx(Button, {\n    onClick: () => handleLess(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 41\n    }\n  }, __jsx(Typography, {\n    variant: \"h5\",\n    className: classesTabPanel.showMoreText,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 45\n    }\n  }, t('str_seeLess')), __jsx(ExpandLess, {\n    className: classesTabPanel.showMoreIcon,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 45\n    }\n  })))))));\n}","map":{"version":3,"sources":["/Users/mata/app-cloudweb/components/guest/account/Reservations/EventReservations.js"],"names":["React","useContext","useEffect","useState","useSelector","styles","stylesTabPanel","Typography","Grid","ExpandMore","ExpandLess","ViewList","UseOrest","isErrorMsg","jsonGroupBy","OREST_ENDPOINT","SUBMODULE","WebCmsGlobal","LoadingSpinner","Button","useNotifications","makeStyles","TabHeader","useTranslation","EventReservationCard","ReservationCancelDialog","useStyles","useStylesTabPanel","EventReservation","props","isWidget","classes","classesTabPanel","GENERAL_SETTINGS","t","showError","token","state","orest","currentUser","auth","access_token","clientBase","client","loginBase","loginfo","moduleHashRight","setModuleHashRight","cancelReservationData","setCancelReservationData","events","setEvents","isLoading","setIsLoading","isInitialized","setIsInitialized","isDone","setIsDone","limit","setLimit","page","setPage","getEventListData","active","fullReload","apiUrl","OREST_URL","endpoint","RESEVENT","params","query","id","sort","start","allhotels","then","r","status","data","count","retErr","errorMsg","empid","submoduleid","toolsUserHasRightResponse","catch","undefined","handleShowMore","window","scrollTo","bottom","behavior","handleLess","top","Boolean","length","Object","keys","map","eventtype","etIndex","padding","subTitle","eventitem","i","canx","nothingToShow","gridItem","showMoreText","showMoreIcon"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from 'react'\nimport { useSelector } from 'react-redux'\nimport styles from './style/Reservations.style'\nimport stylesTabPanel from '../style/TabPanel.style'\nimport Typography from '@material-ui/core/Typography'\nimport Grid from '@material-ui/core/Grid'\nimport ExpandMore from '@material-ui/icons/ExpandMore'\nimport ExpandLess from '@material-ui/icons/ExpandLess'\nimport { ViewList, UseOrest } from '@webcms/orest'\nimport { isErrorMsg, jsonGroupBy, OREST_ENDPOINT, SUBMODULE } from 'model/orest/constants'\nimport WebCmsGlobal from 'components/webcms-global'\nimport LoadingSpinner from 'components/LoadingSpinner'\nimport Button from '@material-ui/core/Button'\nimport useNotifications from 'model/notification/useNotifications'\nimport { makeStyles } from '@material-ui/core/styles'\nimport TabHeader from '../../../layout/components/TabHeader'\nimport useTranslation from 'lib/translations/hooks/useTranslation'\nimport EventReservationCard from './EventReservationCard'\nimport ReservationCancelDialog from './ReservationCancelDialog'\n\nconst useStyles = makeStyles(styles)\nconst useStylesTabPanel = makeStyles(stylesTabPanel)\n\nexport default function EventReservation(props) {\n    const { isWidget } = props\n    const classes = useStyles()\n    const classesTabPanel = useStylesTabPanel()\n    const { GENERAL_SETTINGS } = useContext(WebCmsGlobal)\n    const { t } = useTranslation()\n\n    //redux\n    const { showError } = useNotifications()\n    const token = useSelector((state) => state?.orest?.currentUser?.auth?.access_token || false)\n    const clientBase = useSelector((state) => state?.orest?.state?.client || false)\n    const loginBase = useSelector((state) => state?.orest?.currentUser?.loginfo || false)\n\n    //state\n    const [moduleHashRight, setModuleHashRight] = useState(false)\n    const [cancelReservationData, setCancelReservationData] = useState(false)\n    const [events, setEvents] = useState([])\n    const [isLoading, setIsLoading] = useState(false)\n    const [isInitialized, setIsInitialized] = useState(false)\n    const [isDone, setIsDone] = useState(false)\n    const [limit, setLimit] = useState(4)\n    const [page, setPage] = useState(0)\n\n    const getEventListData = (active, fullReload = false) => {\n        setIsLoading(true)\n        if(fullReload){\n            setIsInitialized(false)\n            setEvents([])\n        }\n        ViewList({\n            apiUrl: GENERAL_SETTINGS.OREST_URL,\n            endpoint: OREST_ENDPOINT.RESEVENT,\n            token,\n            params: {\n                query: `clientid:${clientBase.id}`,\n                sort: 'startdate-',\n                limit: limit,\n                start: page * limit,\n                allhotels: true\n            },\n        }).then((r) => {\n            if (active) {\n                if (r.status === 200) {\n                    if(fullReload){\n                        setEvents(r.data.data)\n                    }else{\n                        setEvents([...events, ...r.data.data])\n                    }\n                    setIsInitialized(true)\n                    setIsLoading(false)\n                    if (r.data.count < limit) {\n                        setIsDone(true)\n                    }\n                } else {\n                    const retErr = isErrorMsg(r)\n                    showError(retErr.errorMsg)\n                    setIsInitialized(true)\n                    setIsLoading(false)\n                }\n            }\n        })\n    }\n\n    useEffect(() => {\n        let active = true\n        if (active) {\n            UseOrest({\n                apiUrl: GENERAL_SETTINGS.OREST_URL,\n                endpoint: 'tools/user/hasright',\n                token: token,\n                params: {\n                    empid: loginBase.id,\n                    submoduleid: SUBMODULE.RESEVENT,\n                },\n            }).then((toolsUserHasRightResponse) => {\n                if (toolsUserHasRightResponse.status === 200 && toolsUserHasRightResponse?.data?.data) {\n                    setModuleHashRight(toolsUserHasRightResponse.data.data)\n                }else{\n                    setModuleHashRight(false)\n                }\n            }).catch(() => {\n                setModuleHashRight(false)\n            })\n        }\n        return () => {\n            active = false\n        }\n    }, [])\n\n    useEffect(() => {\n        let active = true\n        if (active) {\n            if (isLoading) {\n                return undefined\n            }\n\n            if (clientBase && clientBase.id) {\n                getEventListData(true)\n            } else {\n                setIsInitialized(true)\n            }\n        }\n        return () => {\n            active = false\n        }\n    }, [page])\n\n    const handleShowMore = () =>{\n        setPage(page + 1)\n        window.scrollTo({ bottom: 0, behavior: 'smooth' })\n    }\n\n    const handleLess = () =>{\n        setIsDone(false)\n        setIsInitialized(false)\n        setEvents([])\n        setPage(0)\n        setLimit(4)\n        window.scrollTo({ top: 0, behavior: 'smooth' })\n    }\n\n    return (\n        <React.Fragment>\n            <Grid container justify={'center'}>\n                <ReservationCancelDialog reservation={cancelReservationData} type=\"event\" open={Boolean(cancelReservationData)} onClose={(status) => setCancelReservationData(!status)} getCallbackData={()=> getEventListData(true, true)}/>\n                {isInitialized ? (\n                    events.length > 0 ? (\n                        Object.keys(jsonGroupBy(events, 'eventtypedesc')).map((eventtype, etIndex) => {\n                            return(\n                                <Grid item xs={12} key={etIndex} style={{padding: 10}}>\n                                    <Typography variant=\"h6\" gutterBottom className={classes.subTitle}>\n                                        {t(eventtype)}\n                                    </Typography>\n                                    <Grid container justify={'center'}>\n                                        {jsonGroupBy(events, 'eventtypedesc')[eventtype].map((eventitem, i) => {\n                                            return (<EventReservationCard event={eventitem} key={i} isCancel={moduleHashRight.canx || false}  cancelReservation={()=> setCancelReservationData(eventitem)} />)\n                                        })}\n                                    </Grid>\n                                </Grid>\n                            )\n                        })\n                    ) : (\n                        <Typography component=\"h3\" className={classesTabPanel.nothingToShow}>\n                            {t('str_widgetReservatListNoRecordYet')}\n                        </Typography>\n                    )\n                ) : (\n                    <Grid item xs={12} className={classesTabPanel.gridItem}>\n                        <LoadingSpinner />\n                    </Grid>\n                )}\n\n                {events.length > 0 && (\n                    <Grid item xs={12} className={classesTabPanel.gridItem}>\n                        {isLoading ? (\n                            <LoadingSpinner />\n                        ) : (\n                            !isDone ? (\n                                <Grid container direction={'row'} justify={'center'} alignItems={'center'}>\n                                    <Grid item>\n                                        <Button onClick={()=> handleShowMore()}>\n                                            <Typography variant=\"h5\" className={classesTabPanel.showMoreText}>\n                                                {t('str_showMore')}\n                                            </Typography>\n                                            <ExpandMore className={classesTabPanel.showMoreIcon} />\n                                        </Button>\n                                    </Grid>\n                                </Grid>\n                            ) : (\n                                <Grid container direction={'row'} justify={'center'} alignItems={'center'}>\n                                    <Grid item>\n                                        <Button onClick={()=> handleLess()}>\n                                            <Typography variant=\"h5\" className={classesTabPanel.showMoreText}>\n                                                {t('str_seeLess')}\n                                            </Typography>\n                                            <ExpandLess className={classesTabPanel.showMoreIcon} />\n                                        </Button>\n                                    </Grid>\n                                </Grid>\n                            )\n                        )}\n                    </Grid>\n                )}\n            </Grid>\n        </React.Fragment>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}
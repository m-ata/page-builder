{"ast":null,"code":"var _jsxFileName = \"/Users/mata/app-cloudweb/@webcms-ui/core/select-autocomplete/index.js\";\nvar __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useContext, useEffect, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { TextField } from '@material-ui/core';\nimport Autocomplete from '@material-ui/lab/Autocomplete';\nimport LoadingSpinner from 'components/LoadingSpinner';\nimport WebCmsGlobal from 'components/webcms-global';\nimport useTranslation from 'lib/translations/hooks/useTranslation';\nimport { UseOrest } from '@webcms/orest';\n\nconst SelectAutoComplete = ({\n  trgQueryKey,\n  trgValKey,\n  trgValue,\n  optionLabel,\n  optionKey,\n  isInitialStateLoad,\n  defValKey,\n  defValue,\n  disabled,\n  id,\n  name,\n  selectApi,\n  variant,\n  label,\n  value,\n  required,\n  onChange,\n  onCallback,\n  helperText,\n  error\n}) => {\n  //context\n  const {\n    GENERAL_SETTINGS\n  } = useContext(WebCmsGlobal);\n  const {\n    t\n  } = useTranslation(); //redux\n\n  const token = useSelector(state => {\n    var _state$orest, _state$orest$currentU;\n\n    return (state === null || state === void 0 ? void 0 : (_state$orest = state.orest) === null || _state$orest === void 0 ? void 0 : (_state$orest$currentU = _state$orest.currentUser) === null || _state$orest$currentU === void 0 ? void 0 : _state$orest$currentU.auth.access_token) || false;\n  }); //state\n\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState(false);\n  const {\n    0: selectList,\n    1: setSelectList\n  } = useState([]);\n  const {\n    0: useFreeSolo,\n    1: setUseFreeSolo\n  } = useState(false);\n  const {\n    0: prevTrgVal,\n    1: setPrevTrgVal\n  } = useState(false);\n  useEffect(() => {\n    if (!isLoading && isInitialStateLoad && !selectList.length > 0 || trgValKey && trgValue && typeof trgValue === 'object' && trgValue[trgValKey] !== prevTrgVal) {\n      setIsLoading(true);\n\n      if (trgValKey && trgQueryKey) {\n        if (trgValue && typeof trgValue === 'object') {\n          trgValue = trgValue[trgValKey];\n          setPrevTrgVal(trgValue);\n        } else {\n          onCallback(defValue || value || '');\n          setSelectList([]);\n          setUseFreeSolo(true);\n          setIsLoading(false);\n          return;\n        }\n      }\n\n      UseOrest({\n        apiUrl: GENERAL_SETTINGS.OREST_URL,\n        endpoint: selectApi,\n        token,\n        params: Object.assign(trgValKey && trgValue && {\n          query: `${trgQueryKey}::${trgValue}`\n        } || {}, {\n          limit: 0,\n          allhotels: true\n        })\n      }).then(endPointResponse => {\n        var _endPointResponse$dat, _endPointResponse$dat2;\n\n        if (endPointResponse.status === 200 && endPointResponse !== null && endPointResponse !== void 0 && (_endPointResponse$dat = endPointResponse.data) !== null && _endPointResponse$dat !== void 0 && _endPointResponse$dat.data && (endPointResponse === null || endPointResponse === void 0 ? void 0 : (_endPointResponse$dat2 = endPointResponse.data) === null || _endPointResponse$dat2 === void 0 ? void 0 : _endPointResponse$dat2.data.length) > 0) {\n          var _endPointResponse$dat3;\n\n          const endPointResponseData = (endPointResponse === null || endPointResponse === void 0 ? void 0 : (_endPointResponse$dat3 = endPointResponse.data) === null || _endPointResponse$dat3 === void 0 ? void 0 : _endPointResponse$dat3.data) || false;\n          setSelectList(endPointResponseData);\n          setUseFreeSolo(false);\n          setIsLoading(false);\n        } else {\n          if (defValue && typeof defValue !== 'object') {\n            onCallback(defValue);\n          } else {\n            onCallback('');\n          }\n\n          setSelectList([]);\n          setUseFreeSolo(true);\n          setIsLoading(false);\n        }\n      });\n    }\n  }, [isInitialStateLoad, trgValue]);\n  useEffect(() => {\n    if (!isLoading && isInitialStateLoad && selectList && selectList.length > 0 && defValue && typeof defValue !== 'object') {\n      if (defValue) {\n        let newInitialValue;\n\n        if (defValKey) {\n          newInitialValue = selectList.find(item => String(item[defValKey]) === String(defValue));\n          onCallback(newInitialValue);\n        } else {\n          newInitialValue = selectList.find(item => String(item.id) === String(defValue));\n          onCallback(newInitialValue);\n        }\n      } else {\n        const getDefVal = selectList.find(item => item.isdef === true);\n\n        if (getDefVal && typeof onCallback === 'function') {\n          onCallback(getDefVal);\n        }\n      }\n    } else if (!isLoading && isInitialStateLoad && selectList && selectList.length > 0 && defValue) {\n      if (trgValKey && trgQueryKey && trgValue && typeof trgValue === 'object' && defValue) {\n        const filterList = selectList.find(item => String(item[trgQueryKey]) === String(defValue[trgQueryKey]));\n\n        if (!filterList) {\n          onCallback('');\n        }\n      } else if (trgValKey && trgQueryKey && !trgValue) {\n        setUseFreeSolo(true);\n        setSelectList([]);\n        onCallback('');\n      }\n    }\n  }, [isLoading, selectList, defValue, trgValue]);\n\n  if (useFreeSolo) {\n    return __jsx(TextField, {\n      disabled: isLoading || !isInitialStateLoad || disabled,\n      value: value,\n      required: required,\n      error: error,\n      fullWidth: true,\n      label: label || '',\n      variant: variant,\n      helperText: helperText,\n      onChange: event => onChange(event.target.value),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 13\n      }\n    });\n  }\n\n  return __jsx(Autocomplete, {\n    id: id,\n    name: name,\n    disabled: isLoading || !isInitialStateLoad || disabled,\n    loading: isLoading,\n    noOptionsText: t('str_notFound'),\n    value: value,\n    variant: variant || 'outlined',\n    onChange: (event, newValue) => onChange(newValue),\n    options: selectList,\n    getOptionSelected: optionKey ? (option, value) => option && value && option[optionKey] && option[optionKey] === value[optionKey] || \"\" : \"\",\n    getOptionLabel: option => option && optionLabel && option[optionLabel] || \"\",\n    renderInput: params => __jsx(TextField, _extends({}, params, {\n      required: required,\n      error: error,\n      fullWidth: true,\n      label: label || '',\n      InputProps: _objectSpread(_objectSpread({}, params.InputProps), {}, {\n        endAdornment: __jsx(React.Fragment, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 136,\n            columnNumber: 29\n          }\n        }, params.InputProps.endAdornment, isLoading ? __jsx(LoadingSpinner, {\n          size: 18,\n          style: {\n            marginTop: -20\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 138,\n            columnNumber: 46\n          }\n        }) : params.InputProps.endAdornment)\n      }),\n      variant: variant,\n      helperText: helperText,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 17\n      }\n    })),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 9\n    }\n  });\n};\n\nexport default SelectAutoComplete;","map":{"version":3,"sources":["/Users/mata/app-cloudweb/@webcms-ui/core/select-autocomplete/index.js"],"names":["React","useContext","useEffect","useState","useSelector","TextField","Autocomplete","LoadingSpinner","WebCmsGlobal","useTranslation","UseOrest","SelectAutoComplete","trgQueryKey","trgValKey","trgValue","optionLabel","optionKey","isInitialStateLoad","defValKey","defValue","disabled","id","name","selectApi","variant","label","value","required","onChange","onCallback","helperText","error","GENERAL_SETTINGS","t","token","state","orest","currentUser","auth","access_token","isLoading","setIsLoading","selectList","setSelectList","useFreeSolo","setUseFreeSolo","prevTrgVal","setPrevTrgVal","length","apiUrl","OREST_URL","endpoint","params","Object","assign","query","limit","allhotels","then","endPointResponse","status","data","endPointResponseData","newInitialValue","find","item","String","getDefVal","isdef","filterList","event","target","newValue","option","InputProps","endAdornment","marginTop"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from 'react'\nimport { useSelector } from 'react-redux'\nimport { TextField } from '@material-ui/core'\nimport Autocomplete from '@material-ui/lab/Autocomplete'\nimport LoadingSpinner from 'components/LoadingSpinner'\nimport WebCmsGlobal from 'components/webcms-global'\nimport useTranslation from 'lib/translations/hooks/useTranslation'\nimport { UseOrest } from '@webcms/orest'\n\nconst SelectAutoComplete = ({ trgQueryKey, trgValKey, trgValue, optionLabel, optionKey, isInitialStateLoad, defValKey, defValue, disabled, id, name, selectApi, variant, label, value, required, onChange, onCallback, helperText, error }) => {\n\n    //context\n    const { GENERAL_SETTINGS } = useContext(WebCmsGlobal)\n    const { t } = useTranslation()\n\n    //redux\n    const token = useSelector((state) => state?.orest?.currentUser?.auth.access_token || false)\n\n    //state\n    const [isLoading, setIsLoading] = useState(false)\n    const [selectList, setSelectList] = useState([])\n    const [useFreeSolo, setUseFreeSolo] = useState(false)\n    const [prevTrgVal, setPrevTrgVal] = useState(false)\n\n    useEffect(() => {\n        if((!isLoading && isInitialStateLoad && !selectList.length > 0) || (trgValKey && trgValue && typeof trgValue === 'object' && trgValue[trgValKey] !== prevTrgVal)){\n            setIsLoading(true)\n            if(trgValKey && trgQueryKey){\n                if(trgValue && typeof trgValue === 'object'){\n                    trgValue = trgValue[trgValKey]\n                    setPrevTrgVal(trgValue)\n                }else {\n                    onCallback(defValue || value || '')\n                    setSelectList([])\n                    setUseFreeSolo(true)\n                    setIsLoading(false)\n                    return\n                }\n            }\n\n            UseOrest({\n                apiUrl: GENERAL_SETTINGS.OREST_URL,\n                endpoint: selectApi,\n                token,\n                params: Object.assign(trgValKey && trgValue && { query: `${trgQueryKey}::${trgValue}` } || {}, { limit: 0, allhotels: true }),\n            }).then(endPointResponse => {\n                if (endPointResponse.status === 200 && endPointResponse?.data?.data && endPointResponse?.data?.data.length > 0) {\n                    const endPointResponseData = endPointResponse?.data?.data || false\n                    setSelectList(endPointResponseData)\n                    setUseFreeSolo(false)\n                    setIsLoading(false)\n                } else {\n                    if(defValue && typeof defValue !== 'object'){\n                        onCallback(defValue)\n                    }else{\n                        onCallback('')\n                    }\n                    setSelectList([])\n                    setUseFreeSolo(true)\n                    setIsLoading(false)\n                }\n            })\n        }\n    }, [isInitialStateLoad, trgValue])\n\n    useEffect(() => {\n        if(!isLoading && isInitialStateLoad && selectList && selectList.length > 0 && defValue && typeof defValue !== 'object'){\n            if (defValue) {\n                let newInitialValue\n                if (defValKey) {\n                    newInitialValue = selectList.find(item => String(item[defValKey]) === String(defValue))\n                    onCallback(newInitialValue)\n                } else {\n                    newInitialValue = selectList.find(item => String(item.id) === String(defValue))\n                    onCallback(newInitialValue)\n                }\n            } else {\n                const getDefVal = selectList.find(item => item.isdef === true)\n                if (getDefVal && typeof onCallback === 'function') {\n                    onCallback(getDefVal)\n                }\n            }\n        }else if(!isLoading && isInitialStateLoad && selectList && selectList.length > 0 && defValue){\n            if(trgValKey && trgQueryKey && trgValue && typeof trgValue === 'object' && defValue){\n                const filterList = selectList.find(item => String(item[trgQueryKey]) === String(defValue[trgQueryKey]))\n                if(!filterList){\n                   onCallback('')\n                }\n            }else if(trgValKey && trgQueryKey && !trgValue){\n                setUseFreeSolo(true)\n                setSelectList([])\n                onCallback('')\n            }\n        }\n    }, [isLoading, selectList, defValue, trgValue])\n\n    if(useFreeSolo){\n        return (\n            <TextField\n                disabled={isLoading || !isInitialStateLoad || disabled}\n                value={value}\n                required={required}\n                error={error}\n                fullWidth={true}\n                label={label || ''}\n                variant={variant}\n                helperText={helperText}\n                onChange={(event) => onChange(event.target.value)}\n            />\n        )\n    }\n\n    return (\n        <Autocomplete\n            id={id}\n            name={name}\n            disabled={isLoading || !isInitialStateLoad || disabled}\n            loading={isLoading}\n            noOptionsText={t('str_notFound')}\n            value={value}\n            variant={variant || 'outlined'}\n            onChange={(event, newValue) => onChange(newValue)}\n            options={selectList}\n            getOptionSelected={optionKey ? (option, value) => option && value && option[optionKey] && option[optionKey] === value[optionKey] || \"\" : \"\"}\n            getOptionLabel={(option) => option && optionLabel && option[optionLabel] || \"\"}\n            renderInput={(params) => (\n                <TextField\n                    {...params}\n                    required={required}\n                    error={error}\n                    fullWidth={true}\n                    label={label || ''}\n                    InputProps={{\n                        ...params.InputProps,\n                        endAdornment: (\n                            <React.Fragment>\n                                {params.InputProps.endAdornment}\n                                {isLoading ? <LoadingSpinner size={18} style={{ marginTop: -20 }} /> : params.InputProps.endAdornment}\n                            </React.Fragment>\n                        ),\n                    }}\n                    variant={variant}\n                    helperText={helperText}\n                />\n            )}\n        />\n    )\n}\n\nexport default SelectAutoComplete"]},"metadata":{},"sourceType":"module"}
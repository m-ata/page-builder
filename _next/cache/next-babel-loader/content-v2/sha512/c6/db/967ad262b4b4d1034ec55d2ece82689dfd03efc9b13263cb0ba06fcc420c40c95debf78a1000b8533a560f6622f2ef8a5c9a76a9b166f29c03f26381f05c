{"ast":null,"code":"\"use strict\";\n\nvar global = _interopRequireWildcard(require(\"@webcms-globals\"));\n\nvar _Snippets = _interopRequireDefault(require(\"./Snippets\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nconst TagManager = {\n  dataScript: function (dataLayer) {\n    const script = document.createElement('script');\n    script.innerHTML = dataLayer;\n    return script;\n  },\n  gtm: function (args) {\n    const snippets = _Snippets.default.tags(args);\n\n    const noScript = () => {\n      const noscript = document.createElement('noscript');\n      noscript.innerHTML = snippets.iframe;\n      return noscript;\n    };\n\n    const script = () => {\n      const script = document.createElement('script');\n      script.innerHTML = snippets.script;\n      return script;\n    };\n\n    const dataScript = this.dataScript(snippets.dataLayerVar);\n    return {\n      noScript,\n      script,\n      dataScript\n    };\n  },\n  initialize: function ({\n    gtmId,\n    events = {},\n    dataLayer,\n    dataLayerName = 'dataLayer',\n    auth = '',\n    preview = ''\n  }) {\n    const gtm = this.gtm({\n      id: gtmId,\n      events: events,\n      dataLayer: dataLayer || undefined,\n      dataLayerName: dataLayerName,\n      auth,\n      preview\n    });\n    if (dataLayer) document.head.appendChild(gtm.dataScript);\n    document.head.insertBefore(gtm.script(), document.head.childNodes[0]);\n    document.body.insertBefore(gtm.noScript(), document.body.childNodes[0]);\n  },\n  dataLayer: function ({\n    dataLayer,\n    dataLayerName = 'dataLayer'\n  }) {\n    if (window[dataLayerName]) return window[dataLayerName].push(dataLayer);\n\n    const snippets = _Snippets.default.dataLayer(dataLayer, dataLayerName);\n\n    const dataScript = this.dataScript(snippets);\n    document.head.insertBefore(dataScript, document.head.childNodes[0]);\n  },\n  getActionFieldForPageView: function (pageStep) {\n    switch (pageStep) {\n      case 'Preview':\n        return {\n          'eventCategory': 'Enhanced Ecommerce',\n          'ecommerce': {\n            'actionField': {\n              'step': 3,\n              'option': 'Preview'\n            }\n          }\n        };\n\n      default:\n        return {};\n    }\n  },\n  resetPrevious: function () {\n    TagManager.dataLayer({\n      dataLayer: {\n        'eventCategory': null,\n        'ecommerce': null\n      }\n    });\n  },\n  page: {\n    setChange: function ({\n      hotelName,\n      hotelId,\n      pageTitle = '',\n      pagePath = '',\n      pageStep = '',\n      isGuest = false\n    }) {\n      TagManager.resetPrevious();\n      TagManager.dataLayer({\n        dataLayer: Object.assign({\n          'eventLabel': 'Page View',\n          'event': 'Pageview',\n          'eventAction': 'Page View',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'pagePath': pagePath,\n          'pageTitle': pageTitle,\n          'pageStep': pageStep,\n          'visitorType': isGuest ? 'guest' : 'visitor'\n        }, TagManager.getActionFieldForPageView(pageStep))\n      });\n    }\n  },\n  booking: {\n    setRoomList: function ({\n      eventLabel = '',\n      hotelName,\n      hotelId,\n      ciDate,\n      coDate,\n      adult,\n      child,\n      currencyCode = '',\n      impressionsData = []\n    }) {\n      TagManager.resetPrevious();\n      TagManager.dataLayer({\n        dataLayer: {\n          'eventLabel': eventLabel,\n          'eventCategory': 'Enhanced Ecommerce',\n          'eventAction': 'Product Impression',\n          'event': 'productImpression',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'ecommerce': {\n            'ciDate': ciDate,\n            'coDate': coDate,\n            'adult': adult,\n            'child': child,\n            'currencyCode': global.onlineReservation.getCurrencyCodeToIso(currencyCode),\n            'actionField': {\n              'step': 1,\n              'option': 'Product Impression'\n            },\n            'impressions': impressionsData.map((impression, position) => {\n              const useTotalPrice = global.onlineReservation.useTotalPrice(impression.priceList, adult).discTotalPrice || global.onlineReservation.useTotalPrice(impression.priceList, adult).totalPrice;\n              return {\n                'name': impression.description,\n                'id': impression.id,\n                'price': global.helper.formatPrice(useTotalPrice),\n                'quantity': impression.totalroom,\n                'category': 'Room',\n                'list': 'Search Results',\n                'position': impression.orderno || position\n              };\n            })\n          }\n        }\n      });\n    },\n    setAddRoom: function ({\n      eventLabel = '',\n      hotelName,\n      hotelId,\n      ciDate,\n      coDate,\n      adult,\n      child,\n      currencyCode = '',\n      addToCartData = []\n    }) {\n      TagManager.resetPrevious();\n      TagManager.dataLayer({\n        dataLayer: {\n          'eventLabel': eventLabel,\n          'eventCategory': 'Enhanced Ecommerce',\n          'eventAction': 'Add to Cart',\n          'event': 'addToCart',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'ecommerce': {\n            'ciDate': ciDate,\n            'coDate': coDate,\n            'adult': adult,\n            'child': child,\n            'currencyCode': global.onlineReservation.getCurrencyCodeToIso(currencyCode),\n            'actionField': {\n              'step': 2,\n              'option': 'Add to Cart'\n            },\n            'add': {\n              'products': addToCartData\n            }\n          }\n        }\n      });\n    },\n    setRemoveRoom: function ({\n      eventLabel = '',\n      hotelName,\n      hotelId,\n      ciDate,\n      coDate,\n      adult,\n      child,\n      currencyCode = '',\n      removeToCartData = []\n    }) {\n      TagManager.resetPrevious();\n      TagManager.dataLayer({\n        dataLayer: {\n          'eventLabel': eventLabel,\n          'eventCategory': 'Enhanced Ecommerce',\n          'eventAction': 'Remove to Cart',\n          'event': 'removeFromCart',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'ecommerce': {\n            'ciDate': ciDate,\n            'coDate': coDate,\n            'adult': adult,\n            'child': child,\n            'currencyCode': global.onlineReservation.getCurrencyCodeToIso(currencyCode),\n            'remove': {\n              'products': removeToCartData\n            }\n          }\n        }\n      });\n    },\n    setCheckoutRoom: function ({\n      eventLabel = '',\n      hotelName,\n      hotelId,\n      payOption,\n      checkoutData = []\n    }) {\n      TagManager.resetPrevious();\n      TagManager.dataLayer({\n        dataLayer: {\n          'eventLabel': eventLabel,\n          'eventCategory': 'Enhanced Ecommerce',\n          'eventAction': 'Checkout',\n          'event': 'checkout',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'ecommerce': {\n            'checkout': {\n              'actionField': {\n                'payOption': payOption || ''\n              },\n              'products': checkoutData.map(checkout => {\n                return {\n                  'reservNo': checkout.reservno,\n                  'id': checkout.roomtypeid,\n                  'name': checkout.roomtypename,\n                  'price': global.helper.formatPrice(checkout.totalprice),\n                  'qty': 1,\n                  'category': 'Room'\n                };\n              })\n            }\n          }\n        }\n      });\n    },\n    setPurchaseRoom: function ({\n      eventLabel = '',\n      hotelName = '',\n      hotelId = '',\n      masterReservNo = '',\n      revenue = '',\n      coupon = '',\n      purchaseData = []\n    }) {\n      TagManager.resetPrevious();\n      TagManager.dataLayer({\n        dataLayer: {\n          'eventLabel': eventLabel,\n          'eventCategory': 'Enhanced Ecommerce',\n          'eventAction': 'Purchase',\n          'event': 'purchase',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'ecommerce': {\n            'purchase': {\n              'actionField': {\n                'id': masterReservNo,\n                'affiliation': 'Online Booking',\n                'revenue': revenue,\n                'coupon': coupon,\n                'step': 4,\n                'option': 'Purchase'\n              },\n              'products': purchaseData.map(purchase => {\n                return {\n                  'reservNo': purchase.reservno,\n                  'id': purchase.roomtypeid,\n                  'name': purchase.roomtypename,\n                  'price': global.helper.formatPrice(purchase.totalprice),\n                  'qty': 1,\n                  'category': 'Room'\n                };\n              })\n            }\n          }\n        }\n      });\n    }\n  }\n};\nmodule.exports = TagManager;","map":{"version":3,"sources":["/Users/mata/app-cloudweb/@webcms-globals/tag-manager/TagManager.js"],"names":["TagManager","dataScript","dataLayer","script","document","createElement","innerHTML","gtm","args","snippets","Snippets","tags","noScript","noscript","iframe","dataLayerVar","initialize","gtmId","events","dataLayerName","auth","preview","id","undefined","head","appendChild","insertBefore","childNodes","body","window","push","getActionFieldForPageView","pageStep","resetPrevious","page","setChange","hotelName","hotelId","pageTitle","pagePath","isGuest","Object","assign","booking","setRoomList","eventLabel","ciDate","coDate","adult","child","currencyCode","impressionsData","global","onlineReservation","getCurrencyCodeToIso","map","impression","position","useTotalPrice","priceList","discTotalPrice","totalPrice","description","helper","formatPrice","totalroom","orderno","setAddRoom","addToCartData","setRemoveRoom","removeToCartData","setCheckoutRoom","payOption","checkoutData","checkout","reservno","roomtypeid","roomtypename","totalprice","setPurchaseRoom","masterReservNo","revenue","coupon","purchaseData","purchase","module","exports"],"mappings":"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","sourcesContent":["import * as global from '@webcms-globals'\nimport Snippets from './Snippets'\n\nconst TagManager = {\n    dataScript: function (dataLayer) {\n        const script = document.createElement('script')\n        script.innerHTML = dataLayer\n        return script\n    },\n    gtm: function (args) {\n        const snippets = Snippets.tags(args)\n\n        const noScript = () => {\n            const noscript = document.createElement('noscript')\n            noscript.innerHTML = snippets.iframe\n            return noscript\n        }\n\n        const script = () => {\n            const script = document.createElement('script')\n            script.innerHTML = snippets.script\n            return script\n        }\n\n        const dataScript = this.dataScript(snippets.dataLayerVar)\n\n        return {\n            noScript,\n            script,\n            dataScript\n        }\n    },\n    initialize: function ({ gtmId, events = {}, dataLayer, dataLayerName = 'dataLayer', auth = '', preview = '' }) {\n        const gtm = this.gtm({\n            id: gtmId,\n            events: events,\n            dataLayer: dataLayer || undefined,\n            dataLayerName: dataLayerName,\n            auth,\n            preview\n        })\n        if (dataLayer) document.head.appendChild(gtm.dataScript)\n        document.head.insertBefore(gtm.script(), document.head.childNodes[0])\n        document.body.insertBefore(gtm.noScript(), document.body.childNodes[0])\n    },\n    dataLayer: function ({dataLayer, dataLayerName = 'dataLayer'}) {\n        if (window[dataLayerName]) return window[dataLayerName].push(dataLayer)\n        const snippets = Snippets.dataLayer(dataLayer, dataLayerName)\n        const dataScript = this.dataScript(snippets)\n        document.head.insertBefore(dataScript, document.head.childNodes[0])\n    },\n    getActionFieldForPageView: function(pageStep) {\n        switch (pageStep) {\n            case 'Preview':\n                return {\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'ecommerce': {\n                        'actionField': { 'step': 3, 'option': 'Preview' },\n                    }\n                }\n            default:\n                return {}\n        }\n    },\n    resetPrevious: function(){\n        TagManager.dataLayer({\n            dataLayer: {\n                'eventCategory': null,\n                'ecommerce': null,\n            },\n        })\n    },\n    page: {\n        setChange: function({ hotelName, hotelId, pageTitle = '', pagePath = '', pageStep = '', isGuest = false}) {\n            TagManager.resetPrevious()\n            TagManager.dataLayer({\n                dataLayer: Object.assign({\n                    'eventLabel': 'Page View',\n                    'event': 'Pageview',\n                    'eventAction': 'Page View',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'pagePath': pagePath,\n                    'pageTitle': pageTitle,\n                    'pageStep': pageStep,\n                    'visitorType': isGuest ? 'guest' : 'visitor',\n                }, TagManager.getActionFieldForPageView(pageStep)),\n            })\n        },\n    },\n    booking: {\n        setRoomList: function({ eventLabel = '', hotelName, hotelId, ciDate, coDate, adult, child, currencyCode = '', impressionsData = [] }) {\n            TagManager.resetPrevious()\n            TagManager.dataLayer({\n                dataLayer: {\n                    'eventLabel': eventLabel,\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'eventAction': 'Product Impression',\n                    'event': 'productImpression',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'ecommerce': {\n                        'ciDate': ciDate,\n                        'coDate': coDate,\n                        'adult': adult,\n                        'child': child,\n                        'currencyCode': global.onlineReservation.getCurrencyCodeToIso(currencyCode),\n                        'actionField': { 'step': 1, 'option': 'Product Impression' },\n                        'impressions': impressionsData.map((impression, position) => {\n                            const useTotalPrice = global.onlineReservation.useTotalPrice(impression.priceList, adult).discTotalPrice || global.onlineReservation.useTotalPrice(impression.priceList, adult).totalPrice\n                            return {\n                                'name': impression.description,\n                                'id': impression.id,\n                                'price': global.helper.formatPrice(useTotalPrice),\n                                'quantity': impression.totalroom,\n                                'category': 'Room',\n                                'list': 'Search Results',\n                                'position': impression.orderno || position\n                            }\n                        })\n                    },\n                },\n            })\n        },\n        setAddRoom: function({ eventLabel = '', hotelName, hotelId, ciDate, coDate, adult, child, currencyCode = '', addToCartData = [] }){\n            TagManager.resetPrevious()\n            TagManager.dataLayer({\n                dataLayer: {\n                    'eventLabel': eventLabel,\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'eventAction': 'Add to Cart',\n                    'event': 'addToCart',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'ecommerce': {\n                        'ciDate': ciDate,\n                        'coDate': coDate,\n                        'adult': adult,\n                        'child': child,\n                        'currencyCode': global.onlineReservation.getCurrencyCodeToIso(currencyCode),\n                        'actionField': { 'step': 2, 'option': 'Add to Cart' },\n                        'add': {\n                            'products': addToCartData\n                        }\n                    },\n                },\n            })\n        },\n        setRemoveRoom: function({ eventLabel = '', hotelName, hotelId, ciDate, coDate, adult, child, currencyCode = '', removeToCartData = [] }){\n            TagManager.resetPrevious()\n            TagManager.dataLayer({\n                dataLayer: {\n                    'eventLabel': eventLabel,\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'eventAction': 'Remove to Cart',\n                    'event': 'removeFromCart',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'ecommerce': {\n                        'ciDate': ciDate,\n                        'coDate': coDate,\n                        'adult': adult,\n                        'child': child,\n                        'currencyCode': global.onlineReservation.getCurrencyCodeToIso(currencyCode),\n                        'remove': {\n                            'products': removeToCartData\n                        }\n                    },\n                },\n            })\n        },\n        setCheckoutRoom: function({ eventLabel = '', hotelName, hotelId, payOption, checkoutData = [] }){\n            TagManager.resetPrevious()\n            TagManager.dataLayer({\n                dataLayer: {\n                    'eventLabel': eventLabel,\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'eventAction': 'Checkout',\n                    'event': 'checkout',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'ecommerce': {\n                        'checkout': {\n                            'actionField': { 'payOption': payOption || '' },\n                            'products': checkoutData.map((checkout) => {\n                                return {\n                                    'reservNo': checkout.reservno,\n                                    'id': checkout.roomtypeid,\n                                    'name': checkout.roomtypename,\n                                    'price': global.helper.formatPrice(checkout.totalprice),\n                                    'qty': 1,\n                                    'category': 'Room'\n                                }\n                            })\n                        }\n                    }\n                },\n            })\n        },\n        setPurchaseRoom: function({ eventLabel = '', hotelName = '', hotelId = '', masterReservNo = '', revenue = '', coupon = '', purchaseData = [] }){\n            TagManager.resetPrevious()\n            TagManager.dataLayer({\n                dataLayer: {\n                    'eventLabel': eventLabel,\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'eventAction': 'Purchase',\n                    'event': 'purchase',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'ecommerce': {\n                        'purchase': {\n                            'actionField':  {\n                                'id': masterReservNo,\n                                'affiliation': 'Online Booking',\n                                'revenue': revenue,\n                                'coupon': coupon,\n                                'step': 4,\n                                'option': 'Purchase'\n                            },\n                            'products': purchaseData.map((purchase) => {\n                                return {\n                                    'reservNo': purchase.reservno,\n                                    'id': purchase.roomtypeid,\n                                    'name': purchase.roomtypename,\n                                    'price': global.helper.formatPrice(purchase.totalprice),\n                                    'qty': 1,\n                                    'category': 'Room'\n                                }\n                            })\n                        }\n                    }\n                },\n            })\n        },\n    }\n}\n\nmodule.exports = TagManager"]},"metadata":{},"sourceType":"script"}
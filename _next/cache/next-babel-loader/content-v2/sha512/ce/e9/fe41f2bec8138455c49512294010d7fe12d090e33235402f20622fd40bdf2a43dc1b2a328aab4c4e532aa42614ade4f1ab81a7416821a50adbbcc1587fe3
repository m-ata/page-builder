{"ast":null,"code":"const axios = require('axios');\n\nconst helpers = require('./helpers');\n\nconst orestEndpoint = require('../constants/orest-endpoints.json');\n\nconst getHotelAppLang = async (req, res, langCode) => {\n  var _res$GENERAL_SETTINGS;\n\n  if (!langCode) {\n    return [];\n  }\n\n  const hotelLanguageList = await axios({\n    url: helpers.getUrl(res, orestEndpoint.api.rafileViewList),\n    method: orestEndpoint.methods.get,\n    headers: helpers.getHeaders(req, res),\n    params: {\n      query: `langcode:${langCode},filetype:HCMLANG.TARGET`,\n      chkselfish: false\n    }\n  }).then(response => {\n    var _response$data;\n\n    if (response.status === 200 && response !== null && response !== void 0 && (_response$data = response.data) !== null && _response$data !== void 0 && _response$data.data) {\n      return response.data.data;\n    } else {\n      return false;\n    }\n  }).catch(() => {\n    return false;\n  });\n  let targetMergeData = [];\n\n  if (hotelLanguageList) {\n    hotelLanguageList.map(trgFile => {\n      const mergeData = (trgFile === null || trgFile === void 0 ? void 0 : trgFile.filedata) && JSON.parse(Buffer.from(trgFile.filedata, 'base64').toString('utf-8')) || [];\n      targetMergeData = targetMergeData.concat(...mergeData);\n    });\n  }\n\n  if (res !== null && res !== void 0 && (_res$GENERAL_SETTINGS = res.GENERAL_SETTINGS) !== null && _res$GENERAL_SETTINGS !== void 0 && _res$GENERAL_SETTINGS.useLangLongCodes) {\n    var _res$GENERAL_SETTINGS2, _res$GENERAL_SETTINGS3;\n\n    const langLongCode = (res === null || res === void 0 ? void 0 : (_res$GENERAL_SETTINGS2 = res.GENERAL_SETTINGS) === null || _res$GENERAL_SETTINGS2 === void 0 ? void 0 : (_res$GENERAL_SETTINGS3 = _res$GENERAL_SETTINGS2.useLangLongCodes.find(item => item.srtcode === langCode)) === null || _res$GENERAL_SETTINGS3 === void 0 ? void 0 : _res$GENERAL_SETTINGS3.lngcode) || false;\n\n    if (langLongCode) {\n      const hotelRaDictLanguageList = await axios({\n        url: helpers.getUrl(res, orestEndpoint.api.radictViewList),\n        method: orestEndpoint.methods.get,\n        headers: helpers.getHeaders(req, res),\n        params: {\n          query: `trglangcode:${langLongCode},hotelrefno!-1`,\n          limit: 0,\n          allhotels: true,\n          chkselfish: false\n        }\n      }).then(response => {\n        var _response$data2;\n\n        if (response.status === 200 && response !== null && response !== void 0 && (_response$data2 = response.data) !== null && _response$data2 !== void 0 && _response$data2.data) {\n          return response.data.data.map(item => ({\n            src: item.srcword,\n            trg: item.trgword,\n            lng: langCode\n          }));\n        } else {\n          return false;\n        }\n      }).catch(() => {\n        return false;\n      });\n\n      if (hotelRaDictLanguageList && hotelRaDictLanguageList.length > 0) {\n        targetMergeData = targetMergeData.concat(...hotelRaDictLanguageList);\n      }\n    }\n  }\n\n  return targetMergeData;\n};\n\nmodule.exports = getHotelAppLang;","map":{"version":3,"sources":["/Users/mata/app-cloudweb/@api/core/get-hotel-app-lang.js"],"names":["axios","require","helpers","orestEndpoint","getHotelAppLang","req","res","langCode","hotelLanguageList","url","getUrl","api","rafileViewList","method","methods","get","headers","getHeaders","params","query","chkselfish","then","response","status","data","catch","targetMergeData","map","trgFile","mergeData","filedata","JSON","parse","Buffer","from","toString","concat","GENERAL_SETTINGS","useLangLongCodes","langLongCode","find","item","srtcode","lngcode","hotelRaDictLanguageList","radictViewList","limit","allhotels","src","srcword","trg","trgword","lng","length","module","exports"],"mappings":"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","sourcesContent":["const axios = require('axios')\nconst helpers = require('./helpers')\nconst orestEndpoint = require('../constants/orest-endpoints.json')\n\nconst getHotelAppLang = async (req, res, langCode) => {\n    if (!langCode) {\n        return []\n    }\n\n    const hotelLanguageList = await axios({\n        url: helpers.getUrl(res, orestEndpoint.api.rafileViewList),\n        method: orestEndpoint.methods.get,\n        headers: helpers.getHeaders(req, res),\n        params: {\n            query: `langcode:${langCode},filetype:HCMLANG.TARGET`,\n            chkselfish: false,\n        },\n    }).then((response) => {\n        if (response.status === 200 && response?.data?.data) {\n            return response.data.data\n        } else {\n            return false\n        }\n    }).catch(() => {\n        return false\n    })\n\n    let targetMergeData = []\n    if (hotelLanguageList) {\n        hotelLanguageList.map(trgFile => {\n            const mergeData = trgFile?.filedata && JSON.parse(Buffer.from(trgFile.filedata, 'base64').toString('utf-8')) || []\n            targetMergeData = targetMergeData.concat(...mergeData)\n        })\n    }\n\n    if (res?.GENERAL_SETTINGS?.useLangLongCodes) {\n        const langLongCode = res?.GENERAL_SETTINGS?.useLangLongCodes.find(item => item.srtcode === langCode)?.lngcode || false\n        if (langLongCode) {\n            const hotelRaDictLanguageList = await axios({\n                url: helpers.getUrl(res, orestEndpoint.api.radictViewList),\n                method: orestEndpoint.methods.get,\n                headers: helpers.getHeaders(req, res),\n                params: {\n                    query: `trglangcode:${langLongCode},hotelrefno!-1`,\n                    limit: 0,\n                    allhotels: true,\n                    chkselfish: false,\n                },\n            }).then((response) => {\n                if (response.status === 200 && response?.data?.data) {\n                    return response.data.data.map(item => ({\n                        src: item.srcword,\n                        trg: item.trgword,\n                        lng: langCode,\n                    }))\n                } else {\n                    return false\n                }\n            }).catch(() => {\n                return false\n            })\n\n            if (hotelRaDictLanguageList && hotelRaDictLanguageList.length > 0) {\n                targetMergeData = targetMergeData.concat(...hotelRaDictLanguageList)\n            }\n        }\n    }\n\n    return targetMergeData\n}\n\nmodule.exports = getHotelAppLang"]},"metadata":{},"sourceType":"script"}
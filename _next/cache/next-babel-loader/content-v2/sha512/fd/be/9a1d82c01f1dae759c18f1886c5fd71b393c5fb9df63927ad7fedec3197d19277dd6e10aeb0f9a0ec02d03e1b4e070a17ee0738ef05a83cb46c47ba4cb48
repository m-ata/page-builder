{"ast":null,"code":"import _defineProperty from \"/Users/mata/app-cloudweb/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _extends from \"/Users/mata/app-cloudweb/node_modules/next/node_modules/@babel/runtime/helpers/esm/extends\";\n\nvar _jsxFileName = \"/Users/mata/app-cloudweb/components/RaTagSelect/index.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useContext, useEffect, useState } from \"react\";\nimport { useSelector } from 'react-redux';\nimport { Chip, TextField } from '@material-ui/core';\nimport Autocomplete, { createFilterOptions } from '@material-ui/lab/Autocomplete';\nimport LoadingSpinner from \"../LoadingSpinner\";\nimport WebCmsGlobal from \"../webcms-global\";\nimport useTranslation from \"../../lib/translations/hooks/useTranslation\";\nimport { UseOrest, ViewList } from '@webcms/orest';\nimport PropTypes from 'prop-types';\nimport { isErrorMsg, OREST_ENDPOINT } from \"../../model/orest/constants\";\nimport { SLASH } from \"../../model/globals\";\nimport { useSnackbar } from \"notistack\";\n\nfunction RaTagSelect(props) {\n  _s();\n\n  var _this = this;\n\n  var filter = createFilterOptions();\n\n  var _useSnackbar = useSnackbar(),\n      enqueueSnackbar = _useSnackbar.enqueueSnackbar;\n\n  var value = props.value,\n      variant = props.variant,\n      chipVariant = props.chipVariant,\n      label = props.label,\n      mid = props.mid,\n      id = props.id,\n      name = props.name,\n      onLoad = props.onLoad,\n      onChange = props.onChange,\n      disabled = props.disabled,\n      required = props.required,\n      error = props.error,\n      helperText = props.helperText,\n      tableName = props.tableName; //context\n\n  var _useContext = useContext(WebCmsGlobal),\n      GENERAL_SETTINGS = _useContext.GENERAL_SETTINGS;\n\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t; //redux\n\n\n  var token = useSelector(function (state) {\n    var _state$orest, _state$orest$currentU;\n\n    return (state === null || state === void 0 ? void 0 : (_state$orest = state.orest) === null || _state$orest === void 0 ? void 0 : (_state$orest$currentU = _state$orest.currentUser) === null || _state$orest$currentU === void 0 ? void 0 : _state$orest$currentU.auth.access_token) || false;\n  });\n  var hotelRefNo = useSelector(function (state) {\n    var _state$hotelinfo, _state$formReducer, _state$formReducer$gu;\n\n    return (state === null || state === void 0 ? void 0 : (_state$hotelinfo = state.hotelinfo) === null || _state$hotelinfo === void 0 ? void 0 : _state$hotelinfo.currentHotelRefNo) || (state === null || state === void 0 ? void 0 : (_state$formReducer = state.formReducer) === null || _state$formReducer === void 0 ? void 0 : (_state$formReducer$gu = _state$formReducer.guest) === null || _state$formReducer$gu === void 0 ? void 0 : _state$formReducer$gu.changeHotelRefno) || GENERAL_SETTINGS.HOTELREFNO;\n  });\n\n  var _useState = useState(false),\n      isTagListLoading = _useState[0],\n      setIsTaskListLoading = _useState[1];\n\n  var _useState2 = useState(false),\n      isTableTagLoading = _useState2[0],\n      setIsTableTagLoading = _useState2[1];\n\n  var _useState3 = useState([]),\n      tableTagList = _useState3[0],\n      setTableTagList = _useState3[1];\n\n  useEffect(function () {\n    if (tableName) {\n      handleGetTableTagList(tableName);\n    }\n  }, [tableName]);\n  useEffect(function () {\n    if (mid) {\n      handleGetTagList(mid);\n    }\n  }, [mid]);\n\n  var handleGetTableTagList = function handleGetTableTagList(tableName) {\n    setIsTableTagLoading(true);\n    UseOrest({\n      apiUrl: GENERAL_SETTINGS.OREST_URL,\n      endpoint: OREST_ENDPOINT.RATAG + SLASH + 'taglist',\n      token: token,\n      params: {\n        tablename: tableName.toUpperCase(),\n        hotelrefno: hotelRefNo,\n        limit: 25\n      }\n    }).then(function (res) {\n      if (res.status === 200) {\n        setTableTagList(res.data.data);\n      } else {\n        var _error = isErrorMsg(res);\n\n        enqueueSnackbar(t(_error.errMsg), {\n          variant: 'error'\n        });\n      }\n\n      setIsTableTagLoading(false);\n    });\n  };\n\n  var handleGetTagList = function handleGetTagList(mid) {\n    setIsTaskListLoading(true);\n    ViewList({\n      apiUrl: GENERAL_SETTINGS.OREST_URL,\n      endpoint: OREST_ENDPOINT.RATAG,\n      token: token,\n      params: {\n        query: \"masterid:\".concat(mid),\n        hotelrefno: hotelRefNo,\n        limit: 1\n      }\n    }).then(function (res) {\n      setIsTaskListLoading(false);\n\n      if (res.status === 200 && res.data.count > 0) {\n        var tempArray = [];\n        var array = res.data.data[0].tagstr.split(',');\n        array.map(function (item) {\n          var data = {\n            tagstr: item\n          };\n          tempArray.push(data);\n        });\n        onLoad(res.data.data[0], tempArray);\n      }\n    });\n  };\n\n  var handleOnChange = function handleOnChange(event, newValue) {\n    onChange(event, newValue);\n  };\n\n  return __jsx(Autocomplete, {\n    id: id,\n    name: name,\n    disabled: isTagListLoading || isTableTagLoading || disabled,\n    value: value,\n    onChange: function onChange(event, newValue) {\n      var tagRegex = /\"(.*)\"/;\n      var data;\n      newValue.map(function (item, i) {\n        data = tagRegex.exec(item.tagstr);\n\n        if (data) {\n          newValue[i].tagstr = data[1];\n        }\n      });\n      handleOnChange(event, newValue);\n    },\n    options: tableTagList,\n    getOptionLabel: function getOptionLabel(option) {\n      return option.tagstr;\n    },\n    filterSelectedOptions: true,\n    filterOptions: function filterOptions(options, params) {\n      var filtered = filter(options, params);\n\n      if (params.inputValue !== '') {\n        filtered.push({\n          tagstr: \"\".concat(t('str_add'), \" \\\"\").concat(params.inputValue, \"\\\"\")\n        });\n      }\n\n      return filtered;\n    },\n    renderTags: function renderTags(value, getTagProps) {\n      return value.map(function (option, index) {\n        return __jsx(Chip, _extends({\n          variant: chipVariant,\n          label: option.tagstr\n        }, getTagProps({\n          index: index\n        }), {\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 21\n          }\n        }));\n      });\n    },\n    renderInput: function renderInput(params) {\n      return __jsx(TextField, _extends({\n        required: required,\n        error: error,\n        variant: variant\n      }, params, {\n        label: label,\n        InputProps: _objectSpread(_objectSpread({}, params.InputProps), {}, {\n          endAdornment: __jsx(React.Fragment, {\n            __self: _this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 147,\n              columnNumber: 29\n            }\n          }, isTagListLoading || isTableTagLoading ? __jsx(LoadingSpinner, {\n            size: 18,\n            __self: _this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 148,\n              columnNumber: 74\n            }\n          }) : null, params.InputProps.endAdornment)\n        }),\n        helperText: helperText,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 17\n        }\n      }));\n    },\n    multiple: true,\n    freeSolo: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 9\n    }\n  });\n}\n\n_s(RaTagSelect, \"ptg47jbxITLeiFo8ohUqiOJkH78=\", false, function () {\n  return [useSnackbar, useTranslation, useSelector, useSelector];\n});\n\n_c = RaTagSelect;\nexport default RaTagSelect;\nRaTagSelect.defaultProps = {\n  variant: 'outlined',\n  chipVariant: 'outlined',\n  value: [],\n  label: '',\n  id: 'raTag',\n  name: 'raTag'\n};\nRaTagSelect.propTypes = {\n  variant: PropTypes.string\n};\n\nvar _c;\n\n$RefreshReg$(_c, \"RaTagSelect\");","map":{"version":3,"sources":["/Users/mata/app-cloudweb/components/RaTagSelect/index.js"],"names":["React","useContext","useEffect","useState","useSelector","Chip","TextField","Autocomplete","createFilterOptions","LoadingSpinner","WebCmsGlobal","useTranslation","UseOrest","ViewList","PropTypes","isErrorMsg","OREST_ENDPOINT","SLASH","useSnackbar","RaTagSelect","props","filter","enqueueSnackbar","value","variant","chipVariant","label","mid","id","name","onLoad","onChange","disabled","required","error","helperText","tableName","GENERAL_SETTINGS","t","token","state","orest","currentUser","auth","access_token","hotelRefNo","hotelinfo","currentHotelRefNo","formReducer","guest","changeHotelRefno","HOTELREFNO","isTagListLoading","setIsTaskListLoading","isTableTagLoading","setIsTableTagLoading","tableTagList","setTableTagList","handleGetTableTagList","handleGetTagList","apiUrl","OREST_URL","endpoint","RATAG","params","tablename","toUpperCase","hotelrefno","limit","then","res","status","data","errMsg","query","count","tempArray","array","tagstr","split","map","item","push","handleOnChange","event","newValue","tagRegex","i","exec","option","options","filtered","inputValue","getTagProps","index","InputProps","endAdornment","defaultProps","propTypes","string"],"mappings":";;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAeC,UAAf,EAA2BC,SAA3B,EAAsCC,QAAtC,QAAqD,OAArD;AACA,SAAQC,WAAR,QAA0B,aAA1B;AACA,SAAQC,IAAR,EAAcC,SAAd,QAA8B,mBAA9B;AACA,OAAOC,YAAP,IAAuBC,mBAAvB,QAAkD,+BAAlD;AACA,OAAOC,cAAP,MAA2B,mBAA3B;AACA,OAAOC,YAAP,MAAyB,kBAAzB;AACA,OAAOC,cAAP,MAA2B,6CAA3B;AACA,SAAQC,QAAR,EAAkBC,QAAlB,QAAiC,eAAjC;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAAQC,UAAR,EAAoBC,cAApB,QAAyC,6BAAzC;AACA,SAAQC,KAAR,QAAoB,qBAApB;AACA,SAAQC,WAAR,QAA0B,WAA1B;;AAGA,SAASC,WAAT,CAAqBC,KAArB,EAA4B;AAAA;;AAAA;;AACxB,MAAMC,MAAM,GAAGb,mBAAmB,EAAlC;;AADwB,qBAEIU,WAAW,EAFf;AAAA,MAEhBI,eAFgB,gBAEhBA,eAFgB;;AAAA,MAIhBC,KAJgB,GAI0GH,KAJ1G,CAIhBG,KAJgB;AAAA,MAITC,OAJS,GAI0GJ,KAJ1G,CAITI,OAJS;AAAA,MAIAC,WAJA,GAI0GL,KAJ1G,CAIAK,WAJA;AAAA,MAIaC,KAJb,GAI0GN,KAJ1G,CAIaM,KAJb;AAAA,MAIoBC,GAJpB,GAI0GP,KAJ1G,CAIoBO,GAJpB;AAAA,MAIyBC,EAJzB,GAI0GR,KAJ1G,CAIyBQ,EAJzB;AAAA,MAI6BC,IAJ7B,GAI0GT,KAJ1G,CAI6BS,IAJ7B;AAAA,MAImCC,MAJnC,GAI0GV,KAJ1G,CAImCU,MAJnC;AAAA,MAI2CC,QAJ3C,GAI0GX,KAJ1G,CAI2CW,QAJ3C;AAAA,MAIqDC,QAJrD,GAI0GZ,KAJ1G,CAIqDY,QAJrD;AAAA,MAI+DC,QAJ/D,GAI0Gb,KAJ1G,CAI+Da,QAJ/D;AAAA,MAIyEC,KAJzE,GAI0Gd,KAJ1G,CAIyEc,KAJzE;AAAA,MAIgFC,UAJhF,GAI0Gf,KAJ1G,CAIgFe,UAJhF;AAAA,MAI4FC,SAJ5F,GAI0GhB,KAJ1G,CAI4FgB,SAJ5F,EAMxB;;AANwB,oBAOKnC,UAAU,CAACS,YAAD,CAPf;AAAA,MAOhB2B,gBAPgB,eAOhBA,gBAPgB;;AAAA,wBAQV1B,cAAc,EARJ;AAAA,MAQhB2B,CARgB,mBAQhBA,CARgB,EAUxB;;;AACA,MAAMC,KAAK,GAAGnC,WAAW,CAAC,UAACoC,KAAD;AAAA;;AAAA,WAAW,CAAAA,KAAK,SAAL,IAAAA,KAAK,WAAL,4BAAAA,KAAK,CAAEC,KAAP,uFAAcC,WAAd,gFAA2BC,IAA3B,CAAgCC,YAAhC,KAAgD,KAA3D;AAAA,GAAD,CAAzB;AACA,MAAMC,UAAU,GAAGzC,WAAW,CAAC,UAACoC,KAAD;AAAA;;AAAA,WAAW,CAAAA,KAAK,SAAL,IAAAA,KAAK,WAAL,gCAAAA,KAAK,CAAEM,SAAP,sEAAkBC,iBAAlB,MAAuCP,KAAvC,aAAuCA,KAAvC,6CAAuCA,KAAK,CAAEQ,WAA9C,gFAAuC,mBAAoBC,KAA3D,0DAAuC,sBAA2BC,gBAAlE,KAAsFb,gBAAgB,CAACc,UAAlH;AAAA,GAAD,CAA9B;;AAZwB,kBAeyBhD,QAAQ,CAAC,KAAD,CAfjC;AAAA,MAejBiD,gBAfiB;AAAA,MAeCC,oBAfD;;AAAA,mBAgB0BlD,QAAQ,CAAC,KAAD,CAhBlC;AAAA,MAgBjBmD,iBAhBiB;AAAA,MAgBEC,oBAhBF;;AAAA,mBAiBgBpD,QAAQ,CAAC,EAAD,CAjBxB;AAAA,MAiBjBqD,YAjBiB;AAAA,MAiBHC,eAjBG;;AAmBxBvD,EAAAA,SAAS,CAAC,YAAM;AACZ,QAAGkC,SAAH,EAAc;AACVsB,MAAAA,qBAAqB,CAACtB,SAAD,CAArB;AACH;AACJ,GAJQ,EAIN,CAACA,SAAD,CAJM,CAAT;AAOAlC,EAAAA,SAAS,CAAC,YAAM;AACZ,QAAGyB,GAAH,EAAQ;AACJgC,MAAAA,gBAAgB,CAAChC,GAAD,CAAhB;AACH;AACJ,GAJQ,EAIN,CAACA,GAAD,CAJM,CAAT;;AAMA,MAAM+B,qBAAqB,GAAG,SAAxBA,qBAAwB,CAACtB,SAAD,EAAe;AACzCmB,IAAAA,oBAAoB,CAAC,IAAD,CAApB;AACA3C,IAAAA,QAAQ,CAAC;AACLgD,MAAAA,MAAM,EAAEvB,gBAAgB,CAACwB,SADpB;AAELC,MAAAA,QAAQ,EAAE9C,cAAc,CAAC+C,KAAf,GAAuB9C,KAAvB,GAA+B,SAFpC;AAGLsB,MAAAA,KAAK,EAALA,KAHK;AAILyB,MAAAA,MAAM,EAAE;AACJC,QAAAA,SAAS,EAAE7B,SAAS,CAAC8B,WAAV,EADP;AAEJC,QAAAA,UAAU,EAAEtB,UAFR;AAGJuB,QAAAA,KAAK,EAAE;AAHH;AAJH,KAAD,CAAR,CASGC,IATH,CASQ,UAAAC,GAAG,EAAI;AACX,UAAGA,GAAG,CAACC,MAAJ,KAAe,GAAlB,EAAuB;AACnBd,QAAAA,eAAe,CAACa,GAAG,CAACE,IAAJ,CAASA,IAAV,CAAf;AAEH,OAHD,MAGO;AACH,YAAMtC,MAAK,GAAGnB,UAAU,CAACuD,GAAD,CAAxB;;AACAhD,QAAAA,eAAe,CAACgB,CAAC,CAACJ,MAAK,CAACuC,MAAP,CAAF,EAAkB;AAACjD,UAAAA,OAAO,EAAE;AAAV,SAAlB,CAAf;AAEH;;AACD+B,MAAAA,oBAAoB,CAAC,KAAD,CAApB;AACH,KAnBD;AAoBH,GAtBD;;AAwBA,MAAMI,gBAAgB,GAAG,SAAnBA,gBAAmB,CAAChC,GAAD,EAAS;AAC9B0B,IAAAA,oBAAoB,CAAC,IAAD,CAApB;AACAxC,IAAAA,QAAQ,CAAC;AACL+C,MAAAA,MAAM,EAAEvB,gBAAgB,CAACwB,SADpB;AAELC,MAAAA,QAAQ,EAAE9C,cAAc,CAAC+C,KAFpB;AAGLxB,MAAAA,KAAK,EAALA,KAHK;AAILyB,MAAAA,MAAM,EAAE;AACJU,QAAAA,KAAK,qBAAc/C,GAAd,CADD;AAEJwC,QAAAA,UAAU,EAAEtB,UAFR;AAGJuB,QAAAA,KAAK,EAAE;AAHH;AAJH,KAAD,CAAR,CASGC,IATH,CASQ,UAAAC,GAAG,EAAI;AACXjB,MAAAA,oBAAoB,CAAC,KAAD,CAApB;;AACA,UAAGiB,GAAG,CAACC,MAAJ,KAAe,GAAf,IAAsBD,GAAG,CAACE,IAAJ,CAASG,KAAT,GAAiB,CAA1C,EAA6C;AACzC,YAAIC,SAAS,GAAG,EAAhB;AACA,YAAMC,KAAK,GAAGP,GAAG,CAACE,IAAJ,CAASA,IAAT,CAAc,CAAd,EAAiBM,MAAjB,CAAwBC,KAAxB,CAA8B,GAA9B,CAAd;AACAF,QAAAA,KAAK,CAACG,GAAN,CAAU,UAACC,IAAD,EAAU;AAChB,cAAMT,IAAI,GAAG;AACTM,YAAAA,MAAM,EAAEG;AADC,WAAb;AAGAL,UAAAA,SAAS,CAACM,IAAV,CAAeV,IAAf;AACH,SALD;AAMA1C,QAAAA,MAAM,CAACwC,GAAG,CAACE,IAAJ,CAASA,IAAT,CAAc,CAAd,CAAD,EAAmBI,SAAnB,CAAN;AACH;AACJ,KAtBD;AAuBH,GAzBD;;AA2BA,MAAMO,cAAc,GAAG,SAAjBA,cAAiB,CAACC,KAAD,EAAQC,QAAR,EAAqB;AACxCtD,IAAAA,QAAQ,CAACqD,KAAD,EAAQC,QAAR,CAAR;AACH,GAFD;;AAKA,SACI,MAAC,YAAD;AACI,IAAA,EAAE,EAAEzD,EADR;AAEI,IAAA,IAAI,EAAEC,IAFV;AAGI,IAAA,QAAQ,EAAEuB,gBAAgB,IAAIE,iBAApB,IAAyCtB,QAHvD;AAII,IAAA,KAAK,EAAET,KAJX;AAKI,IAAA,QAAQ,EAAE,kBAAC6D,KAAD,EAAQC,QAAR,EAAqB;AAC3B,UAAMC,QAAQ,GAAG,QAAjB;AACA,UAAId,IAAJ;AACDa,MAAAA,QAAQ,CAACL,GAAT,CAAa,UAACC,IAAD,EAAOM,CAAP,EAAa;AACtBf,QAAAA,IAAI,GAAGc,QAAQ,CAACE,IAAT,CAAcP,IAAI,CAACH,MAAnB,CAAP;;AACA,YAAGN,IAAH,EAAS;AACLa,UAAAA,QAAQ,CAACE,CAAD,CAAR,CAAYT,MAAZ,GAAqBN,IAAI,CAAC,CAAD,CAAzB;AACH;AACJ,OALD;AAMCW,MAAAA,cAAc,CAACC,KAAD,EAAQC,QAAR,CAAd;AACH,KAfL;AAgBI,IAAA,OAAO,EAAE7B,YAhBb;AAiBI,IAAA,cAAc,EAAE,wBAACiC,MAAD;AAAA,aAAYA,MAAM,CAACX,MAAnB;AAAA,KAjBpB;AAkBI,IAAA,qBAAqB,MAlBzB;AAmBI,IAAA,aAAa,EAAE,uBAACY,OAAD,EAAU1B,MAAV,EAAqB;AAChC,UAAM2B,QAAQ,GAAGtE,MAAM,CAACqE,OAAD,EAAU1B,MAAV,CAAvB;;AACA,UAAIA,MAAM,CAAC4B,UAAP,KAAsB,EAA1B,EAA8B;AAC1BD,QAAAA,QAAQ,CAACT,IAAT,CAAc;AACVJ,UAAAA,MAAM,YAAKxC,CAAC,CAAC,SAAD,CAAN,gBAAsB0B,MAAM,CAAC4B,UAA7B;AADI,SAAd;AAGH;;AACD,aAAOD,QAAP;AACH,KA3BL;AA4BI,IAAA,UAAU,EAAE,oBAACpE,KAAD,EAAQsE,WAAR;AAAA,aACRtE,KAAK,CAACyD,GAAN,CAAU,UAACS,MAAD,EAASK,KAAT;AAAA,eACN,MAAC,IAAD;AAAM,UAAA,OAAO,EAAErE,WAAf;AAA4B,UAAA,KAAK,EAAEgE,MAAM,CAACX;AAA1C,WAAsDe,WAAW,CAAC;AAAEC,UAAAA,KAAK,EAALA;AAAF,SAAD,CAAjE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WADM;AAAA,OAAV,CADQ;AAAA,KA5BhB;AAiCI,IAAA,WAAW,EAAE,qBAAC9B,MAAD;AAAA,aACT,MAAC,SAAD;AACI,QAAA,QAAQ,EAAE/B,QADd;AAEI,QAAA,KAAK,EAAEC,KAFX;AAGI,QAAA,OAAO,EAAEV;AAHb,SAIQwC,MAJR;AAKI,QAAA,KAAK,EAAEtC,KALX;AAMI,QAAA,UAAU,kCACHsC,MAAM,CAAC+B,UADJ;AAENC,UAAAA,YAAY,EACR,MAAC,KAAD,CAAO,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aACK5C,gBAAgB,IAAIE,iBAApB,GAAwC,MAAC,cAAD;AAAgB,YAAA,IAAI,EAAE,EAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAAxC,GAAsE,IAD3E,EAEKU,MAAM,CAAC+B,UAAP,CAAkBC,YAFvB;AAHE,UANd;AAeI,QAAA,UAAU,EAAE7D,UAfhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SADS;AAAA,KAjCjB;AAoDI,IAAA,QAAQ,MApDZ;AAqDI,IAAA,QAAQ,MArDZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ;AAyDH;;GAjJQhB,W;UAEuBD,W,EAMdP,c,EAGAP,W,EACKA,W;;;KAZde,W;AAmJT,eAAeA,WAAf;AAEAA,WAAW,CAAC8E,YAAZ,GAA2B;AACvBzE,EAAAA,OAAO,EAAE,UADc;AAEvBC,EAAAA,WAAW,EAAE,UAFU;AAGvBF,EAAAA,KAAK,EAAE,EAHgB;AAIvBG,EAAAA,KAAK,EAAE,EAJgB;AAKvBE,EAAAA,EAAE,EAAE,OALmB;AAMvBC,EAAAA,IAAI,EAAE;AANiB,CAA3B;AASAV,WAAW,CAAC+E,SAAZ,GAAwB;AACpB1E,EAAAA,OAAO,EAAEV,SAAS,CAACqF;AADC,CAAxB","sourcesContent":["import React, {useContext, useEffect, useState} from \"react\";\nimport {useSelector} from 'react-redux'\nimport {Chip, TextField} from '@material-ui/core'\nimport Autocomplete, { createFilterOptions } from '@material-ui/lab/Autocomplete';\nimport LoadingSpinner from \"../LoadingSpinner\";\nimport WebCmsGlobal from \"../webcms-global\";\nimport useTranslation from \"../../lib/translations/hooks/useTranslation\";\nimport {UseOrest, ViewList} from '@webcms/orest'\nimport PropTypes from 'prop-types'\nimport {isErrorMsg, OREST_ENDPOINT} from \"../../model/orest/constants\";\nimport {SLASH} from \"../../model/globals\";\nimport {useSnackbar} from \"notistack\";\n\n\nfunction RaTagSelect(props) {\n    const filter = createFilterOptions();\n    const { enqueueSnackbar } = useSnackbar()\n\n    const { value, variant, chipVariant, label, mid, id, name, onLoad, onChange, disabled, required, error, helperText, tableName } = props\n\n    //context\n    const { GENERAL_SETTINGS } = useContext(WebCmsGlobal);\n    const { t } = useTranslation();\n\n    //redux\n    const token = useSelector((state) => state?.orest?.currentUser?.auth.access_token || false);\n    const hotelRefNo = useSelector((state) => state?.hotelinfo?.currentHotelRefNo || state?.formReducer?.guest?.changeHotelRefno || GENERAL_SETTINGS.HOTELREFNO)\n\n\n    const [isTagListLoading, setIsTaskListLoading] = useState(false);\n    const [isTableTagLoading, setIsTableTagLoading] = useState(false);\n    const [tableTagList, setTableTagList] = useState([]);\n\n    useEffect(() => {\n        if(tableName) {\n            handleGetTableTagList(tableName)\n        }\n    }, [tableName])\n\n\n    useEffect(() => {\n        if(mid) {\n            handleGetTagList(mid)\n        }\n    }, [mid])\n\n    const handleGetTableTagList = (tableName) => {\n        setIsTableTagLoading(true);\n        UseOrest({\n            apiUrl: GENERAL_SETTINGS.OREST_URL,\n            endpoint: OREST_ENDPOINT.RATAG + SLASH + 'taglist',\n            token,\n            params: {\n                tablename: tableName.toUpperCase(),\n                hotelrefno: hotelRefNo,\n                limit: 25\n            }\n        }).then(res => {\n            if(res.status === 200) {\n                setTableTagList(res.data.data);\n\n            } else {\n                const error = isErrorMsg(res);\n                enqueueSnackbar(t(error.errMsg), {variant: 'error'});\n\n            }\n            setIsTableTagLoading(false);\n        })\n    }\n\n    const handleGetTagList = (mid) => {\n        setIsTaskListLoading(true);\n        ViewList({\n            apiUrl: GENERAL_SETTINGS.OREST_URL,\n            endpoint: OREST_ENDPOINT.RATAG,\n            token,\n            params: {\n                query: `masterid:${mid}`,\n                hotelrefno: hotelRefNo,\n                limit: 1\n            }\n        }).then(res => {\n            setIsTaskListLoading(false);\n            if(res.status === 200 && res.data.count > 0) {\n                let tempArray = []\n                const array = res.data.data[0].tagstr.split(',')\n                array.map((item) => {\n                    const data = {\n                        tagstr: item,\n                    }\n                    tempArray.push(data);\n                })\n                onLoad(res.data.data[0], tempArray)\n            }\n        })\n    }\n\n    const handleOnChange = (event, newValue) => {\n        onChange(event, newValue)\n    }\n\n\n    return(\n        <Autocomplete\n            id={id}\n            name={name}\n            disabled={isTagListLoading || isTableTagLoading || disabled}\n            value={value}\n            onChange={(event, newValue) => {\n                const tagRegex = /\"(.*)\"/\n                let data;\n               newValue.map((item, i) => {\n                   data = tagRegex.exec(item.tagstr);\n                   if(data) {\n                       newValue[i].tagstr = data[1]\n                   }\n               })\n                handleOnChange(event, newValue)\n            }}\n            options={tableTagList}\n            getOptionLabel={(option) => option.tagstr}\n            filterSelectedOptions\n            filterOptions={(options, params) => {\n                const filtered = filter(options, params);\n                if (params.inputValue !== '') {\n                    filtered.push({\n                        tagstr: `${t('str_add')} \"${params.inputValue}\"`,\n                    });\n                }\n                return filtered;\n            }}\n            renderTags={(value, getTagProps) =>\n                value.map((option, index) => (\n                    <Chip variant={chipVariant} label={option.tagstr} {...getTagProps({ index })} />\n                ))\n            }\n            renderInput={(params) => (\n                <TextField\n                    required={required}\n                    error={error}\n                    variant={variant}\n                    {...params}\n                    label={label}\n                    InputProps={{\n                        ...params.InputProps,\n                        endAdornment: (\n                            <React.Fragment>\n                                {isTagListLoading || isTableTagLoading ? <LoadingSpinner size={18}/> : null}\n                                {params.InputProps.endAdornment}\n                            </React.Fragment>\n                        ),\n                    }}\n                    helperText={helperText}\n                />\n            )}\n            multiple\n            freeSolo\n        />\n    );\n}\n\nexport default RaTagSelect;\n\nRaTagSelect.defaultProps = {\n    variant: 'outlined',\n    chipVariant: 'outlined',\n    value: [],\n    label: '',\n    id: 'raTag',\n    name: 'raTag'\n}\n\nRaTagSelect.propTypes = {\n    variant: PropTypes.string,\n\n}"]},"metadata":{},"sourceType":"module"}
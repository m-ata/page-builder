{"ast":null,"code":"var _jsxFileName = \"/Users/mata/app-cloudweb/components/page-builder/PageBuilderSteps/steps/website/Final.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useState, useContext, useEffect } from 'react'; //material imports\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Button from '@material-ui/core/Button';\nimport TextField from '@material-ui/core/TextField';\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Checkbox, FormControlLabel } from \"@material-ui/core\"; //redux imports\n\nimport { connect } from 'react-redux';\nimport { setToState as _setToState, updateState as _updateState } from \"../../../../../state/actions\"; // imports for toaster\n\nimport { ToastContainer, toast } from 'react-toastify'; //imports configs\n\nimport WebCmsGlobal from \"components/webcms-global\";\nimport { isErrorMsg, OREST_ENDPOINT } from \"../../../../../model/orest/constants\"; //router import\n\nimport { useRouter } from \"next/router\";\nimport { Insert, Patch, ViewList } from \"@webcms/orest\";\nimport { COLORS, SAVED_SUCCESS, UPDATE_SUCCESS } from \"../../constants\";\nimport LoadingSpinner from \"../../../../LoadingSpinner\";\nimport axios from \"axios\";\nvar useStyles = makeStyles(function (theme) {\n  return {\n    actionButton: {\n      marginLeft: theme.spacing(1),\n      borderRadius: 20\n    }\n  };\n});\n\nvar WebsiteFinal = function WebsiteFinal(props) {\n  _s();\n\n  var state = props.state,\n      dialogTitle = props.dialogTitle,\n      resetFinal = props.resetFinal,\n      updateState = props.updateState,\n      isWebsiteSelected = props.isWebsiteSelected;\n\n  var _useState = useState(true),\n      isOpen = _useState[0],\n      setOpen = _useState[1];\n\n  var _useState2 = useState(''),\n      code = _useState2[0],\n      setCode = _useState2[1];\n\n  var _useState3 = useState(''),\n      description = _useState3[0],\n      setDescription = _useState3[1];\n\n  var _useState4 = useState(''),\n      langFileGID = _useState4[0],\n      setLangFileGID = _useState4[1];\n\n  var _useState5 = useState(false),\n      isTemplate = _useState5[0],\n      setIsTemplate = _useState5[1];\n\n  var _useState6 = useState(null),\n      websiteData = _useState6[0],\n      setWebsiteData = _useState6[1];\n\n  var _useState7 = useState(''),\n      url = _useState7[0],\n      setUrl = _useState7[1];\n\n  var emptyWebsite = {\n    header: {},\n    pages: [],\n    footer: {}\n  };\n\n  var _useState8 = useState(true),\n      isLoaded = _useState8[0],\n      setIsLoaded = _useState8[1];\n\n  var classes = useStyles();\n\n  var _useContext = useContext(WebCmsGlobal),\n      GENERAL_SETTINGS = _useContext.GENERAL_SETTINGS,\n      token = _useContext.token;\n\n  var router = useRouter();\n  var companyId = router.query.companyID;\n  var authToken = token || router.query.authToken;\n  useEffect(function () {\n    //setting url\n    if (window && window.location && window.location.port) {\n      setUrl(\"\".concat(window.location.protocol, \"//\").concat(window.location.hostname, \":\").concat(window.location.port));\n    } else {\n      setUrl(\"\".concat(window.location.protocol, \"//\").concat(window.location.hostname));\n    }\n  }, []);\n  useEffect(function () {\n    if (isWebsiteSelected) {\n      setIsLoaded(false);\n      ViewList({\n        apiUrl: GENERAL_SETTINGS.OREST_URL,\n        endpoint: OREST_ENDPOINT.RAFILE,\n        token: authToken,\n        params: {\n          query: \"code:\".concat(state.code, \",filetype::WEBSITE\"),\n          hotelrefno: Number(companyId)\n        }\n      }).then(function (res) {\n        var _res$data, _res$data$data;\n\n        if (res.status === 200 && (res === null || res === void 0 ? void 0 : (_res$data = res.data) === null || _res$data === void 0 ? void 0 : (_res$data$data = _res$data.data) === null || _res$data$data === void 0 ? void 0 : _res$data$data.length) > 0) {\n          setIsLoaded(true);\n          setWebsiteData(res.data.data[0]);\n\n          if (!res.data.data[0].istemplate) {\n            setIsTemplate(res.data.data[0].istemplate);\n            setCode(res.data.data[0].code);\n            setDescription(res.data.data[0].description);\n          }\n\n          ViewList({\n            apiUrl: GENERAL_SETTINGS.OREST_URL,\n            endpoint: OREST_ENDPOINT.RAFILE,\n            token: authToken,\n            params: {\n              query: \"code:\".concat(state.code, \",filetype::LANG.WEBSITE,masterid::\").concat(res.data.data[0].mid),\n              hotelrefno: Number(companyId)\n            }\n          }).then(function (res1) {\n            if (res1.status === 200 && res1.data && res1.data.data.length > 0) {\n              setLangFileGID(res1.data.data[0].gid);\n            }\n          });\n        } else {\n          setIsLoaded(true);\n        }\n      });\n    }\n  }, [isWebsiteSelected]);\n\n  var handleSave = function handleSave() {\n    //saving website into rafile\n    if (isWebsiteSelected) {\n      if (websiteData && websiteData.istemplate) {\n        insertRafile();\n      } else {\n        patchRafile();\n      }\n    } else {\n      insertRafile();\n    }\n  };\n\n  var insertRafile = function insertRafile() {\n    setIsLoaded(false);\n    Insert({\n      // insert website to rafile\n      apiUrl: GENERAL_SETTINGS.OREST_URL,\n      endpoint: OREST_ENDPOINT.RAFILE,\n      token: authToken,\n      data: {\n        code: code,\n        description: description,\n        filetype: 'WEBSITE',\n        filedata: Buffer.from(JSON.stringify(state.website)).toString(\"base64\"),\n        istemplate: isTemplate,\n        hotelrefno: Number(companyId)\n      }\n    }).then(function (res) {\n      var _res$data2;\n\n      if (res.status === 200 && res !== null && res !== void 0 && (_res$data2 = res.data) !== null && _res$data2 !== void 0 && _res$data2.data) {\n        Insert({\n          // insert language file for web page into rafile\n          apiUrl: GENERAL_SETTINGS.OREST_URL,\n          endpoint: OREST_ENDPOINT.RAFILE,\n          token: authToken,\n          data: {\n            code: code,\n            description: description,\n            contentype: '0000530',\n            filetype: 'LANG.WEBSITE',\n            filedata: Buffer.from(JSON.stringify(state.langsFile)).toString('base64'),\n            masterid: res.data.data.mid,\n            hotelrefno: Number(companyId)\n          }\n        }).then(function (res1) {\n          var _res1$data;\n\n          if (res1.status === 200 && res1 !== null && res1 !== void 0 && (_res1$data = res1.data) !== null && _res1$data !== void 0 && _res1$data.data) {\n            axios.get(url + '/?clearall=true').then(function (res3) {\n              setIsLoaded(true);\n\n              if (res3.status === 200) {\n                updateState('pageBuilder', 'pageStep', 0);\n                updateState('pageBuilder', 'isTemplate', false);\n                updateState('pageBuilder', 'previousStep', 0);\n                updateState('pageBuilder', 'website', emptyWebsite);\n                updateState('pageBuilder', 'langsFile', {});\n                toast.success(SAVED_SUCCESS, {\n                  position: toast.POSITION.TOP_RIGHT\n                });\n                toast.success('Cache cleared automatically', {\n                  position: toast.POSITION.TOP_RIGHT\n                });\n                handleReset();\n              } else {\n                var retErr = isErrorMsg(res3);\n                toast.error(retErr.errorMsg, {\n                  position: toast.POSITION.TOP_RIGHT\n                });\n              }\n            });\n          } else {\n            setIsLoaded(true);\n            var retErr = isErrorMsg(res);\n            toast.error(retErr.errorMsg, {\n              position: toast.POSITION.TOP_RIGHT\n            });\n          }\n        });\n      } else {\n        setIsLoaded(true);\n\n        if (res.data.message) {\n          toast.error(res.data.message, {\n            position: toast.POSITION.TOP_RIGHT\n          });\n        }\n      }\n    });\n  };\n\n  var patchRafile = function patchRafile() {\n    setIsLoaded(false);\n    Patch({\n      // update website into rafile\n      apiUrl: GENERAL_SETTINGS.OREST_URL,\n      endpoint: OREST_ENDPOINT.RAFILE,\n      token: authToken,\n      gid: websiteData.gid,\n      params: {\n        hotelrefno: Number(companyId)\n      },\n      data: {\n        code: code,\n        description: description,\n        filetype: 'WEBSITE',\n        filedata: Buffer.from(JSON.stringify(state.website)).toString(\"base64\"),\n        istemplate: isTemplate,\n        hotelrefno: Number(companyId)\n      }\n    }).then(function (res1) {\n      var _res1$data2;\n\n      if (res1.status === 200 && res1 !== null && res1 !== void 0 && (_res1$data2 = res1.data) !== null && _res1$data2 !== void 0 && _res1$data2.data) {\n        Patch({\n          // update lang file for web page to rafile\n          apiUrl: GENERAL_SETTINGS.OREST_URL,\n          endpoint: OREST_ENDPOINT.RAFILE,\n          token: authToken,\n          gid: langFileGID,\n          params: {\n            hotelrefno: Number(companyId)\n          },\n          data: {\n            code: code,\n            description: description,\n            contentype: '0000530',\n            filetype: 'LANG.WEBSITE',\n            filedata: Buffer.from(JSON.stringify(state.langsFile)).toString('base64'),\n            masterid: res1.data.data.mid,\n            hotelrefno: Number(companyId)\n          }\n        }).then(function (res2) {\n          var _res2$data;\n\n          if (res2.status === 200 && res2 !== null && res2 !== void 0 && (_res2$data = res2.data) !== null && _res2$data !== void 0 && _res2$data.data) {\n            axios.get(url + '/?clearall=true').then(function (res3) {\n              setIsLoaded(true);\n\n              if (res3.status === 200) {\n                updateState('pageBuilder', 'pageStep', 0);\n                updateState('pageBuilder', 'isTemplate', false);\n                updateState('pageBuilder', 'previousStep', 0);\n                updateState('pageBuilder', 'website', emptyWebsite);\n                updateState('pageBuilder', 'langsFile', {});\n                toast.success(UPDATE_SUCCESS, {\n                  position: toast.POSITION.TOP_RIGHT\n                });\n                handleReset();\n                toast.success('Cache cleared automatically', {\n                  position: toast.POSITION.TOP_RIGHT\n                });\n              } else {\n                setIsLoaded(true);\n                var retErr = isErrorMsg(res3);\n                toast.error(retErr.errorMsg, {\n                  position: toast.POSITION.TOP_RIGHT\n                });\n              }\n            });\n          } else {\n            setIsLoaded(true);\n            var retErr = isErrorMsg(res1);\n            toast.error(retErr.errorMsg, {\n              position: toast.POSITION.TOP_RIGHT\n            });\n          }\n        });\n      } else {\n        setIsLoaded(true);\n\n        if (res1.data.message) {\n          toast.error(res1.data.message, {\n            position: toast.POSITION.TOP_RIGHT\n          });\n        }\n      }\n    });\n  };\n\n  var handleReset = function handleReset() {\n    setCode('');\n    setDescription('');\n    setOpen(false);\n    resetFinal('');\n  };\n\n  return __jsx(React.Fragment, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 9\n    }\n  }, __jsx(Dialog, {\n    disableBackdropClick: true,\n    disableEnforceFocus: true,\n    fullWidth: true,\n    maxWidth: \"md\",\n    open: isOpen,\n    onClose: handleReset,\n    \"aria-labelledby\": \"form-dialog-title\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 13\n    }\n  }, __jsx(DialogTitle, {\n    color: \"secondary\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 17\n    }\n  }, \" \", dialogTitle, \" \", __jsx(\"hr\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 64\n    }\n  }), \" \"), __jsx(DialogContent, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 292,\n      columnNumber: 17\n    }\n  }, !isLoaded ? __jsx(LoadingSpinner, {\n    style: {\n      color: COLORS.secondary\n    },\n    size: 40,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 294,\n      columnNumber: 37\n    }\n  }) : __jsx(React.Fragment, null, __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 296,\n      columnNumber: 33\n    }\n  }, __jsx(TextField, {\n    label: \"Code\",\n    placeholder: \"Please enter code here ...\",\n    value: code,\n    style: {\n      minWidth: 500\n    },\n    onChange: function onChange(e) {\n      return setCode(e.target.value);\n    },\n    variant: \"outlined\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 297,\n      columnNumber: 37\n    }\n  })), __jsx(\"div\", {\n    style: {\n      marginTop: 30\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 33\n    }\n  }, __jsx(TextField, {\n    label: \"Description\",\n    placeholder: \"Please enter description here ...\",\n    value: description,\n    onChange: function onChange(e) {\n      return setDescription(e.target.value);\n    },\n    multiline: true,\n    style: {\n      minWidth: 500\n    },\n    rows: 1,\n    rowsMax: 4,\n    variant: \"outlined\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 308,\n      columnNumber: 37\n    }\n  })), __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 320,\n      columnNumber: 33\n    }\n  }, __jsx(FormControlLabel, {\n    control: __jsx(Checkbox, {\n      checked: isTemplate,\n      onChange: function onChange() {\n        return setIsTemplate(!isTemplate);\n      },\n      name: \"istemplate\",\n      color: \"primary\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 45\n      }\n    }),\n    label: \"Save as Template\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 321,\n      columnNumber: 37\n    }\n  })))), __jsx(DialogActions, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 17\n    }\n  }, __jsx(Button, {\n    onClick: handleReset,\n    variant: \"contained\",\n    size: \"small\",\n    \"aria-label\": \"add\",\n    className: classes.actionButton,\n    disabled: !isLoaded,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 21\n    }\n  }, \"Cancel\"), __jsx(Button, {\n    onClick: handleSave,\n    className: classes.actionButton,\n    variant: \"contained\",\n    size: \"small\",\n    \"aria-label\": \"add\",\n    color: \"primary\",\n    disabled: !(description && code) || !isLoaded,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 348,\n      columnNumber: 21\n    }\n  }, \"APPLY\"))), __jsx(ToastContainer, {\n    autoClose: 8000,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 13\n    }\n  }));\n};\n\n_s(WebsiteFinal, \"G3G8V3Ik1OH4FI4jN+9ZR53ppb8=\", false, function () {\n  return [useStyles, useRouter];\n});\n\n_c = WebsiteFinal;\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    state: state.formReducer.pageBuilder\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    updateState: function updateState(stateType, stateName, value) {\n      return dispatch(_updateState(stateType, stateName, value));\n    },\n    setToState: function setToState(stateType, stateName, value) {\n      return dispatch(_setToState(stateType, stateName, value));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(WebsiteFinal);\n\nvar _c;\n\n$RefreshReg$(_c, \"WebsiteFinal\");","map":{"version":3,"sources":["/Users/mata/app-cloudweb/components/page-builder/PageBuilderSteps/steps/website/Final.js"],"names":["React","useState","useContext","useEffect","Dialog","DialogActions","DialogContent","DialogTitle","Button","TextField","makeStyles","Checkbox","FormControlLabel","connect","setToState","updateState","ToastContainer","toast","WebCmsGlobal","isErrorMsg","OREST_ENDPOINT","useRouter","Insert","Patch","ViewList","COLORS","SAVED_SUCCESS","UPDATE_SUCCESS","LoadingSpinner","axios","useStyles","theme","actionButton","marginLeft","spacing","borderRadius","WebsiteFinal","props","state","dialogTitle","resetFinal","isWebsiteSelected","isOpen","setOpen","code","setCode","description","setDescription","langFileGID","setLangFileGID","isTemplate","setIsTemplate","websiteData","setWebsiteData","url","setUrl","emptyWebsite","header","pages","footer","isLoaded","setIsLoaded","classes","GENERAL_SETTINGS","token","router","companyId","query","companyID","authToken","window","location","port","protocol","hostname","apiUrl","OREST_URL","endpoint","RAFILE","params","hotelrefno","Number","then","res","status","data","length","istemplate","mid","res1","gid","handleSave","insertRafile","patchRafile","filetype","filedata","Buffer","from","JSON","stringify","website","toString","contentype","langsFile","masterid","get","res3","success","position","POSITION","TOP_RIGHT","handleReset","retErr","error","errorMsg","message","res2","color","secondary","minWidth","e","target","value","marginTop","mapStateToProps","formReducer","pageBuilder","mapDispatchToProps","dispatch","stateType","stateName"],"mappings":"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","sourcesContent":["import React, {useState, useContext, useEffect} from 'react';\n//material imports\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Button from '@material-ui/core/Button';\nimport TextField from '@material-ui/core/TextField';\nimport {makeStyles} from \"@material-ui/core/styles\";\nimport {Checkbox, FormControlLabel} from \"@material-ui/core\";\n//redux imports\nimport { connect } from 'react-redux';\nimport {setToState, updateState} from \"../../../../../state/actions\";\n// imports for toaster\nimport { ToastContainer, toast } from 'react-toastify';\n//imports configs\nimport WebCmsGlobal from \"components/webcms-global\";\nimport {isErrorMsg, OREST_ENDPOINT} from \"../../../../../model/orest/constants\";\n//router import\nimport { useRouter } from \"next/router\";\n\nimport {Insert, Patch, ViewList} from \"@webcms/orest\";\nimport {COLORS, SAVED_SUCCESS, UPDATE_SUCCESS} from \"../../constants\";\nimport LoadingSpinner from \"../../../../LoadingSpinner\";\nimport axios from \"axios\";\n\nconst useStyles = makeStyles(theme => ({\n    actionButton: {\n        marginLeft: theme.spacing(1),\n        borderRadius: 20,\n    }\n}));\n\nconst WebsiteFinal = (props) => {\n\n    const { state,\n        dialogTitle,\n        resetFinal,\n        updateState,\n        isWebsiteSelected\n    } = props;\n\n    const [isOpen, setOpen] = useState(true);\n    const [code, setCode] = useState('');\n    const [description, setDescription] = useState('');\n    const [langFileGID, setLangFileGID] = useState('');\n    const [isTemplate, setIsTemplate] = useState(false);\n    const [websiteData, setWebsiteData] = useState(null);\n    const [url, setUrl] = useState('');\n    const emptyWebsite = {\n        header: {},\n        pages: [],\n        footer: {}\n    };\n    const [isLoaded, setIsLoaded] = useState(true);\n\n    const classes = useStyles();\n\n    const { GENERAL_SETTINGS, token } = useContext(WebCmsGlobal);\n\n    const router = useRouter();\n    const companyId = router.query.companyID;\n    const authToken = token || router.query.authToken;\n\n    useEffect(() => { //setting url\n        if (window && window.location && window.location.port) {\n            setUrl(`${window.location.protocol}//${window.location.hostname}:${window.location.port}`);\n        } else {\n            setUrl(`${window.location.protocol}//${window.location.hostname}`);\n        }\n    }, []);\n\n    useEffect(() => {\n        if (isWebsiteSelected) {\n            setIsLoaded(false);\n            ViewList({\n                apiUrl: GENERAL_SETTINGS.OREST_URL,\n                endpoint: OREST_ENDPOINT.RAFILE,\n                token: authToken,\n                params: {\n                    query: `code:${state.code},filetype::WEBSITE`,\n                    hotelrefno:  Number(companyId)\n                }\n            }).then(res => {\n                if (res.status === 200 && res?.data?.data?.length > 0) {\n                    setIsLoaded(true);\n                    setWebsiteData(res.data.data[0]);\n                    if (!res.data.data[0].istemplate) {\n                        setIsTemplate(res.data.data[0].istemplate);\n                        setCode(res.data.data[0].code);\n                        setDescription(res.data.data[0].description);\n                    }\n                    ViewList({\n                        apiUrl: GENERAL_SETTINGS.OREST_URL,\n                        endpoint: OREST_ENDPOINT.RAFILE,\n                        token: authToken,\n                        params: {\n                            query: `code:${state.code},filetype::LANG.WEBSITE,masterid::${res.data.data[0].mid}`,\n                            hotelrefno: Number(companyId),\n                        },\n                    }).then(res1 => {\n                        if (res1.status === 200 && res1.data && res1.data.data.length > 0) {\n                            setLangFileGID(res1.data.data[0].gid);\n                        }\n                    })\n                } else {\n                    setIsLoaded(true);\n                }\n            })\n        }\n    }, [isWebsiteSelected]);\n\n    const handleSave = () => { //saving website into rafile\n\n        if (isWebsiteSelected) {\n            if (websiteData && websiteData.istemplate) {\n                insertRafile();\n            } else {\n                patchRafile();\n            }\n        } else {\n            insertRafile();\n        }\n    };\n\n    const insertRafile = () => {\n        setIsLoaded(false);\n        Insert({ // insert website to rafile\n            apiUrl: GENERAL_SETTINGS.OREST_URL,\n            endpoint: OREST_ENDPOINT.RAFILE,\n            token: authToken,\n            data: {\n                code: code,\n                description: description,\n                filetype: 'WEBSITE',\n                filedata: Buffer.from(JSON.stringify(state.website)).toString(\"base64\"),\n                istemplate: isTemplate,\n                hotelrefno: Number(companyId)\n            },\n        }).then(res => {\n            if (res.status === 200 && res?.data?.data) {\n                Insert({\n                    // insert language file for web page into rafile\n                    apiUrl: GENERAL_SETTINGS.OREST_URL,\n                    endpoint: OREST_ENDPOINT.RAFILE,\n                    token: authToken,\n                    data: {\n                        code: code,\n                        description: description,\n                        contentype: '0000530',\n                        filetype: 'LANG.WEBSITE',\n                        filedata: Buffer.from(JSON.stringify(state.langsFile)).toString('base64'),\n                        masterid: res.data.data.mid,\n                        hotelrefno: Number(companyId),\n                    },\n                }).then(res1 => {\n                    if (res1.status === 200 && res1?.data?.data) {\n                        axios.get(url + '/?clearall=true').then(res3 => {\n                            setIsLoaded(true);\n                            if (res3.status === 200) {\n                                updateState('pageBuilder', 'pageStep', 0);\n                                updateState('pageBuilder', 'isTemplate', false);\n                                updateState('pageBuilder', 'previousStep', 0);\n                                updateState('pageBuilder', 'website', emptyWebsite);\n                                updateState('pageBuilder', 'langsFile', {});\n                                toast.success(SAVED_SUCCESS, {\n                                    position: toast.POSITION.TOP_RIGHT\n                                });\n                                toast.success('Cache cleared automatically', {\n                                    position: toast.POSITION.TOP_RIGHT\n                                });\n                                handleReset();\n                            } else {\n                                const retErr = isErrorMsg(res3);\n                                toast.error(retErr.errorMsg, {\n                                    position: toast.POSITION.TOP_RIGHT,\n                                })\n                            }\n                        })\n                    } else {\n                        setIsLoaded(true);\n                        const retErr = isErrorMsg(res);\n                        toast.error(retErr.errorMsg, {\n                            position: toast.POSITION.TOP_RIGHT,\n                        })\n                    }\n                })\n            } else {\n                setIsLoaded(true);\n                if (res.data.message) {\n                    toast.error(res.data.message, {\n                        position: toast.POSITION.TOP_RIGHT\n                    });\n                }\n            }\n        })\n    }\n\n    const patchRafile = () => {\n        setIsLoaded(false);\n        Patch({ // update website into rafile\n            apiUrl: GENERAL_SETTINGS.OREST_URL,\n            endpoint: OREST_ENDPOINT.RAFILE,\n            token: authToken,\n            gid: websiteData.gid,\n            params: {\n                hotelrefno: Number(companyId)\n            },\n            data: {\n                code: code,\n                description: description,\n                filetype: 'WEBSITE',\n                filedata: Buffer.from(JSON.stringify(state.website)).toString(\"base64\"),\n                istemplate: isTemplate,\n                hotelrefno: Number(companyId)\n            },\n        }).then(res1 => {\n            if (res1.status === 200 && res1?.data?.data) {\n                Patch({\n                    // update lang file for web page to rafile\n                    apiUrl: GENERAL_SETTINGS.OREST_URL,\n                    endpoint: OREST_ENDPOINT.RAFILE,\n                    token: authToken,\n                    gid: langFileGID,\n                    params: {\n                        hotelrefno: Number(companyId)\n                    },\n                    data: {\n                        code: code,\n                        description: description,\n                        contentype: '0000530',\n                        filetype: 'LANG.WEBSITE',\n                        filedata: Buffer.from(JSON.stringify(state.langsFile)).toString('base64'),\n                        masterid: res1.data.data.mid,\n                        hotelrefno: Number(companyId),\n                    },\n                }).then(res2 => {\n                    if (res2.status === 200 && res2?.data?.data) {\n                        axios.get(url + '/?clearall=true').then(res3 => {\n                            setIsLoaded(true);\n                            if (res3.status === 200) {\n                                updateState('pageBuilder', 'pageStep', 0);\n                                updateState('pageBuilder', 'isTemplate', false);\n                                updateState('pageBuilder', 'previousStep', 0);\n                                updateState('pageBuilder', 'website', emptyWebsite);\n                                updateState('pageBuilder', 'langsFile', {});\n                                toast.success(UPDATE_SUCCESS, {\n                                    position: toast.POSITION.TOP_RIGHT\n                                });\n                                handleReset();\n                                toast.success('Cache cleared automatically', {\n                                    position: toast.POSITION.TOP_RIGHT\n                                });\n                            } else {\n                                setIsLoaded(true);\n                                const retErr = isErrorMsg(res3);\n                                toast.error(retErr.errorMsg, {\n                                    position: toast.POSITION.TOP_RIGHT,\n                                })\n                            }\n                        })\n                    } else {\n                        setIsLoaded(true);\n                        const retErr = isErrorMsg(res1);\n                        toast.error(retErr.errorMsg, {\n                            position: toast.POSITION.TOP_RIGHT,\n                        })\n                    }\n                })\n            } else {\n                setIsLoaded(true);\n                if (res1.data.message) {\n                    toast.error(res1.data.message, {\n                        position: toast.POSITION.TOP_RIGHT\n                    });\n                }\n            }\n        })\n    }\n\n    const handleReset = () => {\n        setCode('');\n        setDescription('');\n        setOpen(false);\n        resetFinal('');\n    }\n\n    return (\n        <React.Fragment>\n            <Dialog disableBackdropClick disableEnforceFocus fullWidth={true} maxWidth=\"md\" open={isOpen} onClose={handleReset} aria-labelledby=\"form-dialog-title\">\n                <DialogTitle color=\"secondary\" > {dialogTitle} <hr /> </DialogTitle>\n                <DialogContent>\n                    {\n                        !isLoaded ? <LoadingSpinner style={{color: COLORS.secondary}} size={40} /> :\n                            <>\n                                <div>\n                                    <TextField\n                                        label='Code'\n                                        placeholder=\"Please enter code here ...\"\n                                        value={code}\n                                        style={{minWidth: 500}}\n                                        onChange={(e) => setCode(e.target.value)}\n                                        variant=\"outlined\"\n                                    >\n                                    </TextField>\n                                </div>\n                                <div style={{marginTop: 30}}>\n                                    <TextField\n                                        label='Description'\n                                        placeholder=\"Please enter description here ...\"\n                                        value={description}\n                                        onChange={(e) => setDescription(e.target.value)}\n                                        multiline\n                                        style={{minWidth: 500}}\n                                        rows={1}\n                                        rowsMax={4}\n                                        variant=\"outlined\"\n                                    />\n                                </div>\n                                <div>\n                                    <FormControlLabel\n                                        control={\n                                            <Checkbox\n                                                checked={isTemplate}\n                                                onChange={() => setIsTemplate(!isTemplate)}\n                                                name=\"istemplate\"\n                                                color=\"primary\"\n                                            />\n                                        }\n                                        label=\"Save as Template\"\n                                    />\n                                </div>\n                            </>\n                    }\n                </DialogContent>\n                <DialogActions>\n                    <Button\n                        onClick={handleReset}\n                        variant=\"contained\"\n                        size=\"small\"\n                        aria-label=\"add\"\n                        className={classes.actionButton}\n                        disabled={!isLoaded}\n                    >\n                        Cancel\n                    </Button>\n\n                    <Button\n                        onClick={handleSave}\n                        className={classes.actionButton}\n                        variant=\"contained\"\n                        size=\"small\"\n                        aria-label=\"add\"\n                        color=\"primary\"\n                        disabled={!(description && code) || !isLoaded}\n                    >\n                        APPLY\n                    </Button>\n                </DialogActions>\n            </Dialog>\n\n\n\n            <ToastContainer autoClose={8000} />\n        </React.Fragment>\n    )\n}\n\nconst mapStateToProps = state => {\n    return {\n        state: state.formReducer.pageBuilder\n    }\n};\n\nconst mapDispatchToProps = dispatch => ({\n    updateState: (stateType, stateName, value) => dispatch(updateState(stateType, stateName, value)),\n    setToState: (stateType, stateName, value) => dispatch(setToState(stateType, stateName, value)),\n});\n\nexport default connect(\n    mapStateToProps,\n    mapDispatchToProps\n)(WebsiteFinal);\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"var _jsxFileName = \"/Users/mata/app-cloudweb/components/guest/account/Details/CheckInConfirmation/index.js\";\nvar __jsx = React.createElement;\nimport React, { useContext, useEffect, useState } from 'react';\nimport { UseOrest, Patch } from '@webcms/orest';\nimport { connect, useSelector } from 'react-redux';\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Alert from '@material-ui/lab/Alert';\nimport WebCmsGlobal from 'components/webcms-global';\nimport useTranslation from 'lib/translations/hooks/useTranslation';\nimport { useSnackbar } from 'notistack';\nimport { OREST_ENDPOINT, REQUEST_METHOD_CONST } from 'model/orest/constants';\nimport { updateState } from 'state/actions';\nimport LoadingSpinner from 'components/LoadingSpinner';\nimport TabHeader from 'components/layout/components/TabHeader';\nimport CheckInReservationCard from '../../Details/CheckInConfirmation/CheckInReservationCard';\nimport PrimaryGuestCard from '../../Details/CheckInConfirmation/PrimaryGuestCard';\nimport { sendCheckInNotificationForHotelAndClient } from '../../Base/helper';\n\nconst CheckInConfirmation = ({\n  open,\n  onClose,\n  updateState,\n  useClientOrestState,\n  useClientReservation,\n  confirmClassName\n}) => {\n  const {\n    t\n  } = useTranslation();\n  const {\n    GENERAL_SETTINGS,\n    locale\n  } = useContext(WebCmsGlobal);\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState(false);\n  const {\n    0: useReservation,\n    1: setUseReservation\n  } = useState(false);\n  const {\n    0: isCheckinLoading,\n    1: setIsCheckinLoading\n  } = useState(false);\n  const useToken = useSelector(state => {\n    var _state$orest, _state$orest$currentU, _state$orest$currentU2;\n\n    return (state === null || state === void 0 ? void 0 : (_state$orest = state.orest) === null || _state$orest === void 0 ? void 0 : (_state$orest$currentU = _state$orest.currentUser) === null || _state$orest$currentU === void 0 ? void 0 : (_state$orest$currentU2 = _state$orest$currentU.auth) === null || _state$orest$currentU2 === void 0 ? void 0 : _state$orest$currentU2.access_token) || false;\n  });\n  useEffect(() => {\n    let isEffect = true;\n\n    if (isEffect && open && useClientReservation) {\n      getReservation(useClientReservation.gid, useClientReservation.hotelrefno);\n    }\n\n    return () => {\n      isEffect = false;\n    };\n  }, [open]);\n\n  const getReservation = async (gid, hotelrefno) => {\n    setIsLoading(true);\n    return UseOrest({\n      apiUrl: GENERAL_SETTINGS.OREST_URL,\n      endpoint: 'reservat/view/get',\n      token: useToken,\n      params: {\n        gid: gid,\n        hotelrefno: hotelrefno\n      }\n    }).then(reservatViewGetResponse => {\n      var _reservatViewGetRespo;\n\n      if (reservatViewGetResponse.status === 200 && reservatViewGetResponse !== null && reservatViewGetResponse !== void 0 && (_reservatViewGetRespo = reservatViewGetResponse.data) !== null && _reservatViewGetRespo !== void 0 && _reservatViewGetRespo.data) {\n        setUseReservation(reservatViewGetResponse.data.data);\n        setIsLoading(false);\n        return true;\n      } else {\n        setIsLoading(false);\n        return false;\n      }\n    }).catch(() => {\n      setIsLoading(false);\n      return false;\n    });\n  };\n\n  const handleReservatDoci = reservno => {\n    return UseOrest({\n      apiUrl: GENERAL_SETTINGS.OREST_URL,\n      endpoint: 'reservat/doci',\n      token: useToken,\n      method: REQUEST_METHOD_CONST.PUT,\n      params: {\n        reservno: reservno\n      }\n    }).then(reservatDociResponse => {\n      return !!reservatDociResponse.data.data.res;\n    }).catch(() => {\n      return false;\n    });\n  };\n\n  const setTemporaryRoomNoForReservation = (gid, hotelrefno) => {\n    return Patch({\n      apiUrl: GENERAL_SETTINGS.OREST_URL,\n      endpoint: OREST_ENDPOINT.RESERVAT,\n      token: useToken,\n      gid: gid,\n      params: {\n        hotelrefno: hotelrefno\n      },\n      data: {\n        roomno: 'T'\n      }\n    }).then(reservatPatchResponse => {\n      return !!reservatPatchResponse.data.data;\n    }).catch(() => {\n      return false;\n    });\n  };\n\n  const getClientReservno = clientid => {\n    updateState('guest', 'clientReservIsLoading', true);\n    return UseOrest({\n      apiUrl: GENERAL_SETTINGS.OREST_URL,\n      endpoint: 'client/reservno',\n      token: useToken,\n      method: REQUEST_METHOD_CONST.GET,\n      params: {\n        clientid: clientid,\n        isgapp: true\n      }\n    }).then(clientReservnoResponse => {\n      if (clientReservnoResponse.status === 200 && clientReservnoResponse.data.count > 0) {\n        updateState('guest', 'changeHotelRefno', clientReservnoResponse.data.data.hotelrefno);\n        updateState('guest', 'changeHotelName', clientReservnoResponse.data.data.hotelname);\n        updateState('guest', 'clientReservation', clientReservnoResponse.data.data);\n        updateState('guest', 'clientReservIsLoading', false);\n        return true;\n      } else {\n        updateState('guest', 'clientReservation', null);\n        updateState('guest', 'clientReservIsLoading', false);\n        return false;\n      }\n    });\n  };\n\n  const handleOnCheckin = async () => {\n    setIsCheckinLoading(true);\n\n    if (!GENERAL_SETTINGS.hotelSettings.roomno && !useReservation.roomno) {\n      await setTemporaryRoomNoForReservation(useReservation.gid, useReservation.hotelrefno);\n    }\n\n    const isCheckin = await handleReservatDoci(useReservation.reservno);\n\n    if (isCheckin) {\n      await sendCheckInNotificationForHotelAndClient(useReservation.gid, useReservation.reservno, useReservation.clientname, useReservation.email, locale, useReservation.hotelrefno);\n      await getClientReservno(useReservation.clientid);\n      enqueueSnackbar(t('str_checkInProccessSuccessful'), {\n        variant: 'success'\n      });\n      setIsCheckinLoading(false);\n    } else {\n      enqueueSnackbar(t('str_unexpectedProblem'), {\n        variant: 'warning'\n      });\n      setIsCheckinLoading(false);\n    }\n  };\n\n  return __jsx(Dialog, {\n    fullWidth: true,\n    maxWidth: \"md\",\n    open: open,\n    onClose: () => onClose(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 9\n    }\n  }, __jsx(DialogTitle, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 13\n    }\n  }, t('str_checkInConfirm')), __jsx(DialogContent, {\n    dividers: true,\n    style: {\n      overflowX: 'hidden',\n      overflowY: 'scroll'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 13\n    }\n  }, isLoading ? __jsx(LoadingSpinner, {\n    size: 40,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 21\n    }\n  }) : !isLoading && !useReservation ? __jsx(Alert, {\n    severity: \"warning\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 21\n    }\n  }, t('str_widgetReservatListNoRecordYet')) : __jsx(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 21\n    }\n  }, __jsx(TabHeader, {\n    title: t('str_checkInSummary'),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 25\n    }\n  }), __jsx(CheckInReservationCard, {\n    useReservation: useReservation,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 25\n    }\n  }), __jsx(TabHeader, {\n    title: t('str_guest1'),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 25\n    }\n  }), __jsx(PrimaryGuestCard, {\n    useClientOrestState: useClientOrestState,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 25\n    }\n  }))), __jsx(DialogActions, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 13\n    }\n  }, __jsx(Button, {\n    disabled: isCheckinLoading,\n    onClick: () => onClose(),\n    color: \"primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 17\n    }\n  }, t('str_close')), __jsx(Button, {\n    disabled: isCheckinLoading,\n    startIcon: isCheckinLoading ? __jsx(LoadingSpinner, {\n      size: 16,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 51\n      }\n    }) : null,\n    className: confirmClassName,\n    onClick: () => handleOnCheckin(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 17\n    }\n  }, t('str_confirm'))));\n};\n\nconst mapStateToProps = state => {\n  return {\n    state: state.formReducer.guest\n  };\n};\n\nconst mapDispatchToProps = dispatch => ({\n  updateState: (stateType, stateName, value) => dispatch(updateState(stateType, stateName, value))\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CheckInConfirmation);","map":{"version":3,"sources":["/Users/mata/app-cloudweb/components/guest/account/Details/CheckInConfirmation/index.js"],"names":["React","useContext","useEffect","useState","UseOrest","Patch","connect","useSelector","Button","Dialog","DialogActions","DialogContent","DialogTitle","Alert","WebCmsGlobal","useTranslation","useSnackbar","OREST_ENDPOINT","REQUEST_METHOD_CONST","updateState","LoadingSpinner","TabHeader","CheckInReservationCard","PrimaryGuestCard","sendCheckInNotificationForHotelAndClient","CheckInConfirmation","open","onClose","useClientOrestState","useClientReservation","confirmClassName","t","GENERAL_SETTINGS","locale","enqueueSnackbar","isLoading","setIsLoading","useReservation","setUseReservation","isCheckinLoading","setIsCheckinLoading","useToken","state","orest","currentUser","auth","access_token","isEffect","getReservation","gid","hotelrefno","apiUrl","OREST_URL","endpoint","token","params","then","reservatViewGetResponse","status","data","catch","handleReservatDoci","reservno","method","PUT","reservatDociResponse","res","setTemporaryRoomNoForReservation","RESERVAT","roomno","reservatPatchResponse","getClientReservno","clientid","GET","isgapp","clientReservnoResponse","count","hotelname","handleOnCheckin","hotelSettings","isCheckin","clientname","email","variant","overflowX","overflowY","mapStateToProps","formReducer","guest","mapDispatchToProps","dispatch","stateType","stateName","value"],"mappings":";;AAAA,OAAOA,KAAP,IAAgBC,UAAhB,EAA4BC,SAA5B,EAAuCC,QAAvC,QAAuD,OAAvD;AACA,SAASC,QAAT,EAAmBC,KAAnB,QAAgC,eAAhC;AACA,SAASC,OAAT,EAAkBC,WAAlB,QAAqC,aAArC;AACA,OAAOC,MAAP,MAAmB,0BAAnB;AACA,OAAOC,MAAP,MAAmB,0BAAnB;AACA,OAAOC,aAAP,MAA0B,iCAA1B;AACA,OAAOC,aAAP,MAA0B,iCAA1B;AACA,OAAOC,WAAP,MAAwB,+BAAxB;AACA,OAAOC,KAAP,MAAkB,wBAAlB;AACA,OAAOC,YAAP,MAAyB,0BAAzB;AACA,OAAOC,cAAP,MAA2B,uCAA3B;AACA,SAASC,WAAT,QAA4B,WAA5B;AACA,SAASC,cAAT,EAAyBC,oBAAzB,QAAqD,uBAArD;AACA,SAASC,WAAT,QAA4B,eAA5B;AACA,OAAOC,cAAP,MAA2B,2BAA3B;AACA,OAAOC,SAAP,MAAsB,wCAAtB;AACA,OAAOC,sBAAP,MAAmC,0DAAnC;AACA,OAAOC,gBAAP,MAA6B,oDAA7B;AACA,SAASC,wCAAT,QAAyD,mBAAzD;;AAEA,MAAMC,mBAAmB,GAAG,CAAC;AAAEC,EAAAA,IAAF;AAAQC,EAAAA,OAAR;AAAiBR,EAAAA,WAAjB;AAA8BS,EAAAA,mBAA9B;AAAmDC,EAAAA,oBAAnD;AAAyEC,EAAAA;AAAzE,CAAD,KAAiG;AACzH,QAAM;AAAEC,IAAAA;AAAF,MAAQhB,cAAc,EAA5B;AACA,QAAM;AAAEiB,IAAAA,gBAAF;AAAoBC,IAAAA;AAApB,MAA+BhC,UAAU,CAACa,YAAD,CAA/C;AACA,QAAM;AAAEoB,IAAAA;AAAF,MAAsBlB,WAAW,EAAvC;AACA,QAAM;AAAA,OAACmB,SAAD;AAAA,OAAYC;AAAZ,MAA4BjC,QAAQ,CAAC,KAAD,CAA1C;AACA,QAAM;AAAA,OAACkC,cAAD;AAAA,OAAiBC;AAAjB,MAAsCnC,QAAQ,CAAC,KAAD,CAApD;AACA,QAAM;AAAA,OAACoC,gBAAD;AAAA,OAAmBC;AAAnB,MAA0CrC,QAAQ,CAAC,KAAD,CAAxD;AACA,QAAMsC,QAAQ,GAAGlC,WAAW,CAAEmC,KAAD;AAAA;;AAAA,WAAW,CAAAA,KAAK,SAAL,IAAAA,KAAK,WAAL,4BAAAA,KAAK,CAAEC,KAAP,uFAAcC,WAAd,0GAA2BC,IAA3B,kFAAiCC,YAAjC,KAAiD,KAA5D;AAAA,GAAD,CAA5B;AAEA5C,EAAAA,SAAS,CAAC,MAAM;AACZ,QAAI6C,QAAQ,GAAG,IAAf;;AAEA,QAAIA,QAAQ,IAAIrB,IAAZ,IAAoBG,oBAAxB,EAA8C;AAC1CmB,MAAAA,cAAc,CAACnB,oBAAoB,CAACoB,GAAtB,EAA2BpB,oBAAoB,CAACqB,UAAhD,CAAd;AACH;;AAED,WAAO,MAAM;AACTH,MAAAA,QAAQ,GAAG,KAAX;AACH,KAFD;AAGH,GAVQ,EAUN,CAACrB,IAAD,CAVM,CAAT;;AAYA,QAAMsB,cAAc,GAAG,OAAOC,GAAP,EAAYC,UAAZ,KAA2B;AAC9Cd,IAAAA,YAAY,CAAC,IAAD,CAAZ;AACA,WAAOhC,QAAQ,CAAC;AACZ+C,MAAAA,MAAM,EAAEnB,gBAAgB,CAACoB,SADb;AAEZC,MAAAA,QAAQ,EAAE,mBAFE;AAGZC,MAAAA,KAAK,EAAEb,QAHK;AAIZc,MAAAA,MAAM,EAAE;AACJN,QAAAA,GAAG,EAAEA,GADD;AAEJC,QAAAA,UAAU,EAAEA;AAFR;AAJI,KAAD,CAAR,CAQJM,IARI,CAQEC,uBAAD,IAA6B;AAAA;;AACjC,UAAIA,uBAAuB,CAACC,MAAxB,KAAmC,GAAnC,IAA0CD,uBAA1C,aAA0CA,uBAA1C,wCAA0CA,uBAAuB,CAAEE,IAAnE,kDAA0C,sBAA+BA,IAA7E,EAAmF;AAC/ErB,QAAAA,iBAAiB,CAACmB,uBAAuB,CAACE,IAAxB,CAA6BA,IAA9B,CAAjB;AACAvB,QAAAA,YAAY,CAAC,KAAD,CAAZ;AACA,eAAO,IAAP;AACH,OAJD,MAIO;AACHA,QAAAA,YAAY,CAAC,KAAD,CAAZ;AACA,eAAO,KAAP;AACH;AACJ,KAjBM,EAiBJwB,KAjBI,CAiBE,MAAK;AACVxB,MAAAA,YAAY,CAAC,KAAD,CAAZ;AACA,aAAO,KAAP;AACH,KApBM,CAAP;AAqBH,GAvBD;;AAyBA,QAAMyB,kBAAkB,GAAIC,QAAD,IAAc;AACrC,WAAO1D,QAAQ,CAAC;AACZ+C,MAAAA,MAAM,EAAEnB,gBAAgB,CAACoB,SADb;AAEZC,MAAAA,QAAQ,EAAE,eAFE;AAGZC,MAAAA,KAAK,EAAEb,QAHK;AAIZsB,MAAAA,MAAM,EAAE7C,oBAAoB,CAAC8C,GAJjB;AAKZT,MAAAA,MAAM,EAAE;AACJO,QAAAA,QAAQ,EAAEA;AADN;AALI,KAAD,CAAR,CAQJN,IARI,CAQGS,oBAAD,IAA0B;AAC/B,aAAO,CAAC,CAACA,oBAAoB,CAACN,IAArB,CAA0BA,IAA1B,CAA+BO,GAAxC;AACH,KAVM,EAUJN,KAVI,CAUE,MAAK;AACX,aAAO,KAAP;AACF,KAZM,CAAP;AAaH,GAdD;;AAgBA,QAAMO,gCAAgC,GAAG,CAAClB,GAAD,EAAMC,UAAN,KAAqB;AAC1D,WAAO7C,KAAK,CAAC;AACT8C,MAAAA,MAAM,EAAEnB,gBAAgB,CAACoB,SADhB;AAETC,MAAAA,QAAQ,EAAEpC,cAAc,CAACmD,QAFhB;AAGTd,MAAAA,KAAK,EAAEb,QAHE;AAITQ,MAAAA,GAAG,EAAEA,GAJI;AAKTM,MAAAA,MAAM,EAAE;AACJL,QAAAA,UAAU,EAAEA;AADR,OALC;AAQTS,MAAAA,IAAI,EAAE;AACFU,QAAAA,MAAM,EAAE;AADN;AARG,KAAD,CAAL,CAWJb,IAXI,CAWGc,qBAAD,IAA2B;AAChC,aAAO,CAAC,CAACA,qBAAqB,CAACX,IAAtB,CAA2BA,IAApC;AACH,KAbM,EAaJC,KAbI,CAaE,MAAK;AACV,aAAO,KAAP;AACH,KAfM,CAAP;AAgBH,GAjBD;;AAmBA,QAAMW,iBAAiB,GAAIC,QAAD,IAAc;AACpCrD,IAAAA,WAAW,CAAC,OAAD,EAAU,uBAAV,EAAmC,IAAnC,CAAX;AACA,WAAOf,QAAQ,CAAC;AACZ+C,MAAAA,MAAM,EAAEnB,gBAAgB,CAACoB,SADb;AAEZC,MAAAA,QAAQ,EAAE,iBAFE;AAGZC,MAAAA,KAAK,EAAEb,QAHK;AAIZsB,MAAAA,MAAM,EAAE7C,oBAAoB,CAACuD,GAJjB;AAKZlB,MAAAA,MAAM,EAAE;AACJiB,QAAAA,QAAQ,EAAEA,QADN;AAEJE,QAAAA,MAAM,EAAE;AAFJ;AALI,KAAD,CAAR,CASJlB,IATI,CASEmB,sBAAD,IAA4B;AAChC,UAAIA,sBAAsB,CAACjB,MAAvB,KAAkC,GAAlC,IAAyCiB,sBAAsB,CAAChB,IAAvB,CAA4BiB,KAA5B,GAAoC,CAAjF,EAAoF;AAChFzD,QAAAA,WAAW,CAAC,OAAD,EAAU,kBAAV,EAA8BwD,sBAAsB,CAAChB,IAAvB,CAA4BA,IAA5B,CAAiCT,UAA/D,CAAX;AACA/B,QAAAA,WAAW,CAAC,OAAD,EAAU,iBAAV,EAA6BwD,sBAAsB,CAAChB,IAAvB,CAA4BA,IAA5B,CAAiCkB,SAA9D,CAAX;AACA1D,QAAAA,WAAW,CAAC,OAAD,EAAU,mBAAV,EAA+BwD,sBAAsB,CAAChB,IAAvB,CAA4BA,IAA3D,CAAX;AACAxC,QAAAA,WAAW,CAAC,OAAD,EAAU,uBAAV,EAAmC,KAAnC,CAAX;AACA,eAAO,IAAP;AACH,OAND,MAMO;AACHA,QAAAA,WAAW,CAAC,OAAD,EAAU,mBAAV,EAA+B,IAA/B,CAAX;AACAA,QAAAA,WAAW,CAAC,OAAD,EAAU,uBAAV,EAAmC,KAAnC,CAAX;AACA,eAAO,KAAP;AACH;AACJ,KArBM,CAAP;AAsBH,GAxBD;;AA0BA,QAAM2D,eAAe,GAAG,YAAW;AAC/BtC,IAAAA,mBAAmB,CAAC,IAAD,CAAnB;;AACA,QAAG,CAACR,gBAAgB,CAAC+C,aAAjB,CAA+BV,MAAhC,IAA0C,CAAChC,cAAc,CAACgC,MAA7D,EAAoE;AAChE,YAAMF,gCAAgC,CAAC9B,cAAc,CAACY,GAAhB,EAAqBZ,cAAc,CAACa,UAApC,CAAtC;AACH;;AACD,UAAM8B,SAAS,GAAG,MAAMnB,kBAAkB,CAACxB,cAAc,CAACyB,QAAhB,CAA1C;;AACA,QAAGkB,SAAH,EAAa;AACT,YAAMxD,wCAAwC,CAACa,cAAc,CAACY,GAAhB,EAAqBZ,cAAc,CAACyB,QAApC,EAA8CzB,cAAc,CAAC4C,UAA7D,EAAyE5C,cAAc,CAAC6C,KAAxF,EAA+FjD,MAA/F,EAAuGI,cAAc,CAACa,UAAtH,CAA9C;AACA,YAAMqB,iBAAiB,CAAClC,cAAc,CAACmC,QAAhB,CAAvB;AACAtC,MAAAA,eAAe,CAACH,CAAC,CAAC,+BAAD,CAAF,EAAqC;AAAEoD,QAAAA,OAAO,EAAE;AAAX,OAArC,CAAf;AACA3C,MAAAA,mBAAmB,CAAC,KAAD,CAAnB;AACH,KALD,MAKK;AACDN,MAAAA,eAAe,CAACH,CAAC,CAAC,uBAAD,CAAF,EAA6B;AAAEoD,QAAAA,OAAO,EAAE;AAAX,OAA7B,CAAf;AACA3C,MAAAA,mBAAmB,CAAC,KAAD,CAAnB;AACH;AACJ,GAfD;;AAiBA,SACI,MAAC,MAAD;AAAQ,IAAA,SAAS,MAAjB;AAAkB,IAAA,QAAQ,EAAC,IAA3B;AAAgC,IAAA,IAAI,EAAEd,IAAtC;AAA4C,IAAA,OAAO,EAAE,MAAMC,OAAO,EAAlE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI,MAAC,WAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAcI,CAAC,CAAC,oBAAD,CAAf,CADJ,EAEI,MAAC,aAAD;AAAe,IAAA,QAAQ,MAAvB;AAAwB,IAAA,KAAK,EAAE;AAAEqD,MAAAA,SAAS,EAAE,QAAb;AAAuBC,MAAAA,SAAS,EAAE;AAAlC,KAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACKlD,SAAS,GACN,MAAC,cAAD;AAAgB,IAAA,IAAI,EAAE,EAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADM,GAEP,CAACA,SAAD,IAAc,CAACE,cAAf,GACC,MAAC,KAAD;AAAO,IAAA,QAAQ,EAAC,SAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA2BN,CAAC,CAAC,mCAAD,CAA5B,CADD,GAGC,MAAC,KAAD,CAAO,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI,MAAC,SAAD;AAAW,IAAA,KAAK,EAAEA,CAAC,CAAC,oBAAD,CAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,EAEI,MAAC,sBAAD;AAAwB,IAAA,cAAc,EAAEM,cAAxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFJ,EAGI,MAAC,SAAD;AAAW,IAAA,KAAK,EAAEN,CAAC,CAAC,YAAD,CAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAHJ,EAII,MAAC,gBAAD;AAAkB,IAAA,mBAAmB,EAAEH,mBAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAJJ,CANR,CAFJ,EAgBI,MAAC,aAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI,MAAC,MAAD;AACI,IAAA,QAAQ,EAAEW,gBADd;AAEI,IAAA,OAAO,EAAE,MAAMZ,OAAO,EAF1B;AAGI,IAAA,KAAK,EAAC,SAHV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAKKI,CAAC,CAAC,WAAD,CALN,CADJ,EAQI,MAAC,MAAD;AACI,IAAA,QAAQ,EAAEQ,gBADd;AAEI,IAAA,SAAS,EAAEA,gBAAgB,GAAG,MAAC,cAAD;AAAgB,MAAA,IAAI,EAAE,EAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAH,GAAiC,IAFhE;AAGI,IAAA,SAAS,EAAET,gBAHf;AAII,IAAA,OAAO,EAAE,MAAMgD,eAAe,EAJlC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAMK/C,CAAC,CAAC,aAAD,CANN,CARJ,CAhBJ,CADJ;AAoCH,CAhKD;;AAkKA,MAAMuD,eAAe,GAAI5C,KAAD,IAAW;AAC/B,SAAO;AACHA,IAAAA,KAAK,EAAEA,KAAK,CAAC6C,WAAN,CAAkBC;AADtB,GAAP;AAGH,CAJD;;AAMA,MAAMC,kBAAkB,GAAIC,QAAD,KAAe;AACtCvE,EAAAA,WAAW,EAAE,CAACwE,SAAD,EAAYC,SAAZ,EAAuBC,KAAvB,KAAiCH,QAAQ,CAACvE,WAAW,CAACwE,SAAD,EAAYC,SAAZ,EAAuBC,KAAvB,CAAZ;AADhB,CAAf,CAA3B;;AAIA,eAAevF,OAAO,CAACgF,eAAD,EAAkBG,kBAAlB,CAAP,CAA6ChE,mBAA7C,CAAf","sourcesContent":["import React, { useContext, useEffect, useState } from 'react'\nimport { UseOrest, Patch } from '@webcms/orest'\nimport { connect, useSelector } from 'react-redux'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Alert from '@material-ui/lab/Alert'\nimport WebCmsGlobal from 'components/webcms-global'\nimport useTranslation from 'lib/translations/hooks/useTranslation'\nimport { useSnackbar } from 'notistack'\nimport { OREST_ENDPOINT, REQUEST_METHOD_CONST } from 'model/orest/constants'\nimport { updateState } from 'state/actions'\nimport LoadingSpinner from 'components/LoadingSpinner'\nimport TabHeader from 'components/layout/components/TabHeader'\nimport CheckInReservationCard from '../../Details/CheckInConfirmation/CheckInReservationCard'\nimport PrimaryGuestCard from '../../Details/CheckInConfirmation/PrimaryGuestCard'\nimport { sendCheckInNotificationForHotelAndClient } from '../../Base/helper'\n\nconst CheckInConfirmation = ({ open, onClose, updateState, useClientOrestState, useClientReservation, confirmClassName }) => {\n    const { t } = useTranslation()\n    const { GENERAL_SETTINGS, locale } = useContext(WebCmsGlobal)\n    const { enqueueSnackbar } = useSnackbar()\n    const [isLoading, setIsLoading] = useState(false)\n    const [useReservation, setUseReservation] = useState(false)\n    const [isCheckinLoading, setIsCheckinLoading] = useState(false)\n    const useToken = useSelector((state) => state?.orest?.currentUser?.auth?.access_token || false)\n\n    useEffect(() => {\n        let isEffect = true\n\n        if (isEffect && open && useClientReservation) {\n            getReservation(useClientReservation.gid, useClientReservation.hotelrefno)\n        }\n\n        return () => {\n            isEffect = false\n        }\n    }, [open])\n\n    const getReservation = async (gid, hotelrefno) => {\n        setIsLoading(true)\n        return UseOrest({\n            apiUrl: GENERAL_SETTINGS.OREST_URL,\n            endpoint: 'reservat/view/get',\n            token: useToken,\n            params: {\n                gid: gid,\n                hotelrefno: hotelrefno,\n            },\n        }).then((reservatViewGetResponse) => {\n            if (reservatViewGetResponse.status === 200 && reservatViewGetResponse?.data?.data) {\n                setUseReservation(reservatViewGetResponse.data.data)\n                setIsLoading(false)\n                return true\n            } else {\n                setIsLoading(false)\n                return false\n            }\n        }).catch(()=> {\n            setIsLoading(false)\n            return false\n        })\n    }\n\n    const handleReservatDoci = (reservno) => {\n        return UseOrest({\n            apiUrl: GENERAL_SETTINGS.OREST_URL,\n            endpoint: 'reservat/doci',\n            token: useToken,\n            method: REQUEST_METHOD_CONST.PUT,\n            params: {\n                reservno: reservno,\n            },\n        }).then( (reservatDociResponse) => {\n            return !!reservatDociResponse.data.data.res\n        }).catch(()=> {\n           return false\n        })\n    }\n\n    const setTemporaryRoomNoForReservation = (gid, hotelrefno) => {\n        return Patch({\n            apiUrl: GENERAL_SETTINGS.OREST_URL,\n            endpoint: OREST_ENDPOINT.RESERVAT,\n            token: useToken,\n            gid: gid,\n            params: {\n                hotelrefno: hotelrefno\n            },\n            data: {\n                roomno: 'T'\n            }\n        }).then( (reservatPatchResponse) => {\n            return !!reservatPatchResponse.data.data\n        }).catch(()=> {\n            return false\n        })\n    }\n\n    const getClientReservno = (clientid) => {\n        updateState('guest', 'clientReservIsLoading', true)\n        return UseOrest({\n            apiUrl: GENERAL_SETTINGS.OREST_URL,\n            endpoint: 'client/reservno',\n            token: useToken,\n            method: REQUEST_METHOD_CONST.GET,\n            params: {\n                clientid: clientid,\n                isgapp: true,\n            },\n        }).then((clientReservnoResponse) => {\n            if (clientReservnoResponse.status === 200 && clientReservnoResponse.data.count > 0) {\n                updateState('guest', 'changeHotelRefno', clientReservnoResponse.data.data.hotelrefno)\n                updateState('guest', 'changeHotelName', clientReservnoResponse.data.data.hotelname)\n                updateState('guest', 'clientReservation', clientReservnoResponse.data.data)\n                updateState('guest', 'clientReservIsLoading', false)\n                return true\n            } else {\n                updateState('guest', 'clientReservation', null)\n                updateState('guest', 'clientReservIsLoading', false)\n                return false\n            }\n        })\n    }\n\n    const handleOnCheckin = async () =>{\n        setIsCheckinLoading(true)\n        if(!GENERAL_SETTINGS.hotelSettings.roomno && !useReservation.roomno){\n            await setTemporaryRoomNoForReservation(useReservation.gid, useReservation.hotelrefno)\n        }\n        const isCheckin = await handleReservatDoci(useReservation.reservno)\n        if(isCheckin){\n            await sendCheckInNotificationForHotelAndClient(useReservation.gid, useReservation.reservno, useReservation.clientname, useReservation.email, locale, useReservation.hotelrefno)\n            await getClientReservno(useReservation.clientid)\n            enqueueSnackbar(t('str_checkInProccessSuccessful'), { variant: 'success' })\n            setIsCheckinLoading(false)\n        }else{\n            enqueueSnackbar(t('str_unexpectedProblem'), { variant: 'warning' })\n            setIsCheckinLoading(false)\n        }\n    }\n\n    return (\n        <Dialog fullWidth maxWidth='md' open={open} onClose={() => onClose()}>\n            <DialogTitle>{t('str_checkInConfirm')}</DialogTitle>\n            <DialogContent dividers style={{ overflowX: 'hidden', overflowY: 'scroll' }}>\n                {isLoading ? (\n                    <LoadingSpinner size={40} />\n                ): !isLoading && !useReservation ? (\n                    <Alert severity=\"warning\">{t('str_widgetReservatListNoRecordYet')}</Alert>\n                ) : (\n                    <React.Fragment>\n                        <TabHeader title={t('str_checkInSummary')}/>\n                        <CheckInReservationCard useReservation={useReservation}/>\n                        <TabHeader title={t('str_guest1')}/>\n                        <PrimaryGuestCard useClientOrestState={useClientOrestState} />\n                    </React.Fragment>\n                )}\n            </DialogContent>\n            <DialogActions>\n                <Button\n                    disabled={isCheckinLoading}\n                    onClick={() => onClose()}\n                    color='primary'\n                >\n                    {t('str_close')}\n                </Button>\n                <Button\n                    disabled={isCheckinLoading}\n                    startIcon={isCheckinLoading ? <LoadingSpinner size={16}/> : null}\n                    className={confirmClassName}\n                    onClick={() => handleOnCheckin()}\n                >\n                    {t('str_confirm')}\n                </Button>\n            </DialogActions>\n        </Dialog>\n    )\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        state: state.formReducer.guest,\n    }\n}\n\nconst mapDispatchToProps = (dispatch) => ({\n    updateState: (stateType, stateName, value) => dispatch(updateState(stateType, stateName, value)),\n})\n\nexport default connect(mapStateToProps, mapDispatchToProps)(CheckInConfirmation)\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"var _jsxFileName = \"/Users/mata/app-cloudweb/components/guest/account/LoyaltyClub/received-gifts.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useContext, useEffect, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Grid from '@material-ui/core/Grid';\nimport { UseOrest } from '@webcms/orest';\nimport { DEFAULT_OREST_TOKEN, isErrorMsg, OREST_ENDPOINT } from 'model/orest/constants';\nimport WebCmsGlobal from 'components/webcms-global';\nimport useNotifications from 'model/notification/useNotifications';\nimport useTranslation from 'lib/translations/hooks/useTranslation';\nimport Box from '@material-ui/core/Box';\nimport Typography from '@material-ui/core/Typography';\nimport LoadingSpinner from 'components/LoadingSpinner';\nimport Button from '@material-ui/core/Button';\nimport ReceivedGiftCard from './ReceivedGiftCard';\nimport { connect } from 'react-redux';\n\nvar ReceivedGifts = function ReceivedGifts(props) {\n  _s();\n\n  var state = props.state;\n\n  var _useContext = useContext(WebCmsGlobal),\n      GENERAL_SETTINGS = _useContext.GENERAL_SETTINGS;\n\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t; //redux\n\n\n  var _useNotifications = useNotifications(),\n      showError = _useNotifications.showError;\n\n  var token = useSelector(function (state) {\n    var _state$orest, _state$orest$currentU, _state$orest$currentU2;\n\n    return (state === null || state === void 0 ? void 0 : (_state$orest = state.orest) === null || _state$orest === void 0 ? void 0 : (_state$orest$currentU = _state$orest.currentUser) === null || _state$orest$currentU === void 0 ? void 0 : (_state$orest$currentU2 = _state$orest$currentU.auth) === null || _state$orest$currentU2 === void 0 ? void 0 : _state$orest$currentU2.access_token) || false;\n  });\n  var clientBase = useSelector(function (state) {\n    var _state$orest2, _state$orest2$state;\n\n    return (state === null || state === void 0 ? void 0 : (_state$orest2 = state.orest) === null || _state$orest2 === void 0 ? void 0 : (_state$orest2$state = _state$orest2.state) === null || _state$orest2$state === void 0 ? void 0 : _state$orest2$state.client) || false;\n  });\n  var hotelRefNo = useSelector(function (state) {\n    var _state$orest3, _state$orest3$state, _state$orest3$state$f, _state$orest3$state$f2, _state$orest4, _state$orest4$state, _state$orest4$state$f, _state$orest4$state$f2, _state$orest4$state$f3;\n\n    return (state === null || state === void 0 ? void 0 : (_state$orest3 = state.orest) === null || _state$orest3 === void 0 ? void 0 : (_state$orest3$state = _state$orest3.state) === null || _state$orest3$state === void 0 ? void 0 : (_state$orest3$state$f = _state$orest3$state.formReducer) === null || _state$orest3$state$f === void 0 ? void 0 : (_state$orest3$state$f2 = _state$orest3$state$f.guest) === null || _state$orest3$state$f2 === void 0 ? void 0 : _state$orest3$state$f2.changeHotelRefno) || (state === null || state === void 0 ? void 0 : (_state$orest4 = state.orest) === null || _state$orest4 === void 0 ? void 0 : (_state$orest4$state = _state$orest4.state) === null || _state$orest4$state === void 0 ? void 0 : (_state$orest4$state$f = _state$orest4$state.formReducer) === null || _state$orest4$state$f === void 0 ? void 0 : (_state$orest4$state$f2 = _state$orest4$state$f.guest) === null || _state$orest4$state$f2 === void 0 ? void 0 : (_state$orest4$state$f3 = _state$orest4$state$f2.clientReservation) === null || _state$orest4$state$f3 === void 0 ? void 0 : _state$orest4$state$f3.hotelrefno) || GENERAL_SETTINGS.HOTELREFNO;\n  }); //state\n\n  var _useState = useState([]),\n      receivedGifts = _useState[0],\n      setReceivedGifts = _useState[1];\n\n  var _useState2 = useState(false),\n      isLoading = _useState2[0],\n      setIsLoading = _useState2[1];\n\n  var _useState3 = useState(false),\n      isInitialized = _useState3[0],\n      setIsInitialized = _useState3[1];\n\n  var _useState4 = useState(4),\n      limit = _useState4[0],\n      setLimit = _useState4[1];\n\n  var getGiftList = function getGiftList(active) {\n    var useHotelRefNo = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    setIsLoading(true);\n    UseOrest({\n      apiUrl: GENERAL_SETTINGS.OREST_URL,\n      endpoint: OREST_ENDPOINT.BONUSTRANS + '/gift/sent',\n      token: token,\n      params: {\n        accid: clientBase.id,\n        hotelrefno: useHotelRefNo || hotelRefNo\n      }\n    }).then(function (r) {\n      if (active) {\n        if (r.status === 200) {\n          setReceivedGifts(r.data.data);\n          setIsLoading(false);\n          setIsInitialized(true);\n        } else {\n          var retErr = isErrorMsg(r);\n          showError(retErr.errorMsg);\n          setIsLoading(false);\n          setIsInitialized(true);\n        }\n      }\n    });\n  };\n\n  useEffect(function () {\n    var active = true;\n\n    if (active) {\n      if (isLoading) {\n        return undefined;\n      }\n\n      if (clientBase !== null && clientBase !== void 0 && clientBase.id) {\n        getGiftList(active);\n      } else {\n        setIsLoading(false);\n        setIsInitialized(true);\n      }\n    }\n\n    return function () {\n      active = false;\n    };\n  }, []);\n  useEffect(function () {\n    var active = true;\n\n    if (active) {\n      if (isLoading) {\n        return undefined;\n      }\n\n      if (clientBase !== null && clientBase !== void 0 && clientBase.id) {\n        setIsInitialized(false);\n        setReceivedGifts([]);\n        getGiftList(active, state.changeHotelRefno);\n      } else {\n        setIsLoading(false);\n        setIsInitialized(true);\n      }\n    }\n\n    return function () {\n      active = false;\n    };\n  }, [state.changeHotelRefno]);\n  return __jsx(React.Fragment, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 9\n    }\n  }, __jsx(Grid, {\n    container: true,\n    spacing: 3,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 13\n    }\n  }, isInitialized ? receivedGifts.length > 0 ? Object(receivedGifts.slice(0, limit)).map(function (item, i) {\n    return __jsx(Grid, {\n      item: true,\n      xs: 12,\n      sm: 6,\n      key: i,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 29\n      }\n    }, __jsx(ReceivedGiftCard, {\n      isClosed: item.isclosed,\n      title: item.localtitle || item.title,\n      bonusUsed: item.pricebonus,\n      receivedDate: item.transdate,\n      giftThumbnail: item.url ? GENERAL_SETTINGS.STATIC_URL + item.url : '/imgs/not-found.png',\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 33\n      }\n    }));\n  }) : __jsx(Grid, {\n    item: true,\n    xs: 12,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 25\n    }\n  }, __jsx(Box, {\n    p: 3,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 29\n    }\n  }, __jsx(Typography, {\n    component: \"h3\",\n    align: \"center\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 33\n    }\n  }, t('str_nothingYet')))) : __jsx(Grid, {\n    item: true,\n    xs: 12,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 21\n    }\n  }, __jsx(LoadingSpinner, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 25\n    }\n  })), receivedGifts && receivedGifts.length > 0 && receivedGifts.length > limit && __jsx(Grid, {\n    item: true,\n    xs: 12,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 21\n    }\n  }, __jsx(Box, {\n    p: 3,\n    style: {\n      textAlign: 'center'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 25\n    }\n  }, __jsx(Button, {\n    variant: \"contained\",\n    color: \"primary\",\n    disableElevation: true,\n    onClick: function onClick() {\n      return setLimit(limit + 3);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 29\n    }\n  }, t('str_showMore'))))));\n};\n\n_s(ReceivedGifts, \"iMxF369KVTi6OXqdVKk2w4G/sdw=\", false, function () {\n  return [useTranslation, useNotifications, useSelector, useSelector, useSelector];\n});\n\n_c = ReceivedGifts;\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    state: state.formReducer.guest\n  };\n};\n\nexport default connect(mapStateToProps, null)(ReceivedGifts);\n\nvar _c;\n\n$RefreshReg$(_c, \"ReceivedGifts\");","map":{"version":3,"sources":["/Users/mata/app-cloudweb/components/guest/account/LoyaltyClub/received-gifts.js"],"names":["React","useContext","useEffect","useState","useSelector","makeStyles","Grid","UseOrest","DEFAULT_OREST_TOKEN","isErrorMsg","OREST_ENDPOINT","WebCmsGlobal","useNotifications","useTranslation","Box","Typography","LoadingSpinner","Button","ReceivedGiftCard","connect","ReceivedGifts","props","state","GENERAL_SETTINGS","t","showError","token","orest","currentUser","auth","access_token","clientBase","client","hotelRefNo","formReducer","guest","changeHotelRefno","clientReservation","hotelrefno","HOTELREFNO","receivedGifts","setReceivedGifts","isLoading","setIsLoading","isInitialized","setIsInitialized","limit","setLimit","getGiftList","active","useHotelRefNo","apiUrl","OREST_URL","endpoint","BONUSTRANS","params","accid","id","then","r","status","data","retErr","errorMsg","undefined","length","Object","slice","map","item","i","isclosed","localtitle","title","pricebonus","transdate","url","STATIC_URL","textAlign","mapStateToProps"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from 'react'\nimport { useSelector } from 'react-redux'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Grid from '@material-ui/core/Grid'\nimport { UseOrest } from '@webcms/orest'\nimport { DEFAULT_OREST_TOKEN, isErrorMsg, OREST_ENDPOINT } from 'model/orest/constants'\nimport WebCmsGlobal from 'components/webcms-global'\nimport useNotifications from 'model/notification/useNotifications'\nimport useTranslation from 'lib/translations/hooks/useTranslation'\nimport Box from '@material-ui/core/Box'\nimport Typography from '@material-ui/core/Typography'\nimport LoadingSpinner from 'components/LoadingSpinner'\nimport Button from '@material-ui/core/Button'\nimport ReceivedGiftCard from './ReceivedGiftCard'\nimport { connect } from 'react-redux'\n\nconst ReceivedGifts = (props) => {\n    const { state } = props\n    const { GENERAL_SETTINGS } = useContext(WebCmsGlobal)\n    const { t } = useTranslation()\n\n    //redux\n    const { showError } = useNotifications()\n    const token = useSelector((state) => state?.orest?.currentUser?.auth?.access_token || false)\n    const clientBase = useSelector((state) => state?.orest?.state?.client || false)\n    const hotelRefNo = useSelector((state) => state?.orest?.state?.formReducer?.guest?.changeHotelRefno || state?.orest?.state?.formReducer?.guest?.clientReservation?.hotelrefno || GENERAL_SETTINGS.HOTELREFNO)\n\n    //state\n    const [receivedGifts, setReceivedGifts] = useState([])\n    const [isLoading, setIsLoading] = useState(false)\n    const [isInitialized, setIsInitialized] = useState(false)\n    const [limit, setLimit] = useState(4)\n\n    const getGiftList = (active, useHotelRefNo = false) => {\n        setIsLoading(true)\n        UseOrest({\n            apiUrl: GENERAL_SETTINGS.OREST_URL,\n            endpoint: OREST_ENDPOINT.BONUSTRANS + '/gift/sent',\n            token,\n            params: {\n                accid: clientBase.id,\n                hotelrefno: useHotelRefNo || hotelRefNo\n            }\n        }).then((r) => {\n            if (active) {\n                if (r.status === 200) {\n                    setReceivedGifts(r.data.data)\n                    setIsLoading(false)\n                    setIsInitialized(true)\n                } else {\n                    const retErr = isErrorMsg(r)\n                    showError(retErr.errorMsg)\n                    setIsLoading(false)\n                    setIsInitialized(true)\n                }\n            }\n        })\n    }\n\n    useEffect(() => {\n        let active = true\n        if (active) {\n            if (isLoading) {\n                return undefined\n            }\n\n            if (clientBase?.id) {\n                getGiftList(active)\n            } else {\n                setIsLoading(false)\n                setIsInitialized(true)\n            }\n        }\n\n        return () => {\n            active = false\n        }\n    }, [])\n\n    useEffect(() => {\n        let active = true\n        if (active) {\n            if (isLoading) {\n                return undefined\n            }\n\n            if (clientBase?.id) {\n                setIsInitialized(false)\n                setReceivedGifts([])\n                getGiftList(active, state.changeHotelRefno)\n            } else {\n                setIsLoading(false)\n                setIsInitialized(true)\n            }\n        }\n\n        return () => {\n            active = false\n        }\n    }, [state.changeHotelRefno])\n\n    return (\n        <React.Fragment>\n            <Grid container spacing={3}>\n                {isInitialized ? (\n                    receivedGifts.length > 0 ? (\n                        Object(receivedGifts.slice(0, limit)).map((item, i) => (\n                            <Grid item xs={12} sm={6} key={i}>\n                                <ReceivedGiftCard\n                                    isClosed={item.isclosed}\n                                    title={item.localtitle || item.title}\n                                    bonusUsed={item.pricebonus}\n                                    receivedDate={item.transdate}\n                                    giftThumbnail={item.url ? GENERAL_SETTINGS.STATIC_URL + item.url : '/imgs/not-found.png'}\n                                />\n                            </Grid>\n                        ))\n                    ) : (\n                        <Grid item xs={12}>\n                            <Box p={3}>\n                                <Typography component=\"h3\" align=\"center\">\n                                    {t('str_nothingYet')}\n                                </Typography>\n                            </Box>\n                        </Grid>\n                    )\n                ) : (\n                    <Grid item xs={12}>\n                        <LoadingSpinner />\n                    </Grid>\n                )}\n                {receivedGifts && receivedGifts.length > 0 &&  receivedGifts.length > limit && (\n                    <Grid item xs={12}>\n                        <Box p={3} style={{\n                            textAlign: 'center'\n                        }}>\n                            <Button variant=\"contained\" color=\"primary\" disableElevation onClick={()=> setLimit(limit + 3)}>\n                                {t('str_showMore')}\n                            </Button>\n                        </Box>\n                    </Grid>\n                )}\n            </Grid>\n        </React.Fragment>\n    )\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        state: state.formReducer.guest,\n    }\n}\n\nexport default connect(mapStateToProps, null)(ReceivedGifts)\n"]},"metadata":{},"sourceType":"module"}
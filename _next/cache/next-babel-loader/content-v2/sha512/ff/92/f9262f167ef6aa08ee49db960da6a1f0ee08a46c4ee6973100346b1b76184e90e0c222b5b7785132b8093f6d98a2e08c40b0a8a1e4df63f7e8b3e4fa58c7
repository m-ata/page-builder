{"ast":null,"code":"var _jsxFileName = \"/Users/mata/app-cloudweb/components/page-builder/PageBuilderSteps/steps/webpage/Final.js\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useContext, useEffect } from 'react'; //material imports\n\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Button from '@material-ui/core/Button';\nimport TextField from '@material-ui/core/TextField'; //redux imports\n\nimport { connect } from 'react-redux'; // imports for toaster\n\nimport { ToastContainer, toast } from 'react-toastify'; //imports configs\n\nimport WebCmsGlobal from 'components/webcms-global';\nimport { isErrorMsg, OREST_ENDPOINT } from '../../../../../model/orest/constants'; //router import\n\nimport { useRouter } from 'next/router';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { setToState, updateState } from '../../../../../state/actions';\nimport { Insert, Patch, ViewList } from '@webcms/orest';\nimport { Checkbox, FormControlLabel } from '@material-ui/core';\nimport { COLORS, SAVED_SUCCESS, UPDATE_SUCCESS } from \"../../constants\";\nimport LoadingSpinner from \"../../../../LoadingSpinner\";\nconst useStyles = makeStyles(theme => ({\n  actionButton: {\n    marginLeft: theme.spacing(1),\n    borderRadius: 20\n  }\n}));\n\nconst Final = props => {\n  const {\n    state,\n    dialogTitle,\n    resetFinal,\n    isWebPageSelected,\n    updateState\n  } = props; //local state\n\n  const {\n    0: isOpen,\n    1: setOpen\n  } = useState(true);\n  const {\n    0: code,\n    1: setCode\n  } = useState('');\n  const {\n    0: description,\n    1: setDescription\n  } = useState('');\n  const {\n    0: isTemplate,\n    1: setIsTemplate\n  } = useState(false);\n  const {\n    0: webPage,\n    1: setWebPage\n  } = useState('');\n  const {\n    0: langFileGID,\n    1: setLangFileGID\n  } = useState('');\n  const {\n    0: isRequestSend,\n    1: setRequestSend\n  } = useState(false);\n  const emptyPage = {\n    id: '',\n    sections: []\n  };\n  const {\n    0: websiteData,\n    1: setWebsiteData\n  } = useState(null);\n  const {\n    0: websiteGID,\n    1: setWebsiteGID\n  } = useState(null);\n  const classes = useStyles();\n  const {\n    GENERAL_SETTINGS,\n    token\n  } = useContext(WebCmsGlobal);\n  const router = useRouter();\n  const companyId = router.query.companyID;\n  const authToken = token || router.query.authToken;\n  useEffect(() => {\n    if (isWebPageSelected && state.code) {\n      setRequestSend(true);\n      ViewList({\n        apiUrl: GENERAL_SETTINGS.OREST_URL,\n        endpoint: OREST_ENDPOINT.RAFILE,\n        token: authToken,\n        params: {\n          query: `code::${state.code},filetype::WEBPAGE`,\n          hotelrefno: Number(companyId)\n        }\n      }).then(res => {\n        if (res.status === 200 && res.data && res.data.data.length > 0) {\n          setWebPage(res.data.data[0]);\n\n          if (!res.data.data[0].istemplate) {\n            setCode(res.data.data[0].code);\n            setDescription(res.data.data[0].description);\n            setIsTemplate(res.data.data[0].istemplate);\n          }\n\n          ViewList({\n            apiUrl: GENERAL_SETTINGS.OREST_URL,\n            endpoint: OREST_ENDPOINT.RAFILE,\n            token: authToken,\n            params: {\n              query: `code::${state.code},filetype::LANG.WEBPAGE`,\n              hotelrefno: Number(companyId)\n            }\n          }).then(res1 => {\n            if (res1.status === 200 && res1.data && res1.data.data.length > 0) {\n              setLangFileGID(res1.data.data[0].gid);\n              ViewList({\n                apiUrl: GENERAL_SETTINGS.OREST_URL,\n                endpoint: OREST_ENDPOINT.RAFILE,\n                token: authToken,\n                params: {\n                  query: `code::WEBINDEX,filetype::WEBSITE`,\n                  hotelrefno: Number(companyId)\n                }\n              }).then(res2 => {\n                var _res2$data, _res2$data$data;\n\n                if ((res2 === null || res2 === void 0 ? void 0 : res2.status) === 200 && (res2 === null || res2 === void 0 ? void 0 : (_res2$data = res2.data) === null || _res2$data === void 0 ? void 0 : (_res2$data$data = _res2$data.data) === null || _res2$data$data === void 0 ? void 0 : _res2$data$data.length) > 0) {\n                  var _res2$data2, _res2$data2$data$;\n\n                  setRequestSend(false);\n                  const website = JSON.parse(Buffer.from(res2 === null || res2 === void 0 ? void 0 : (_res2$data2 = res2.data) === null || _res2$data2 === void 0 ? void 0 : (_res2$data2$data$ = _res2$data2.data[0]) === null || _res2$data2$data$ === void 0 ? void 0 : _res2$data2$data$.filedata, 'base64').toString('utf-8'));\n                  setWebsiteGID(res2.data.data[0].gid);\n                  const updatedWebsitePages = [...website.pages];\n                  const page = updatedWebsitePages === null || updatedWebsitePages === void 0 ? void 0 : updatedWebsitePages.find(x => (x === null || x === void 0 ? void 0 : x.gid) === res.data.data[0].gid);\n\n                  if (page) {\n                    const index = updatedWebsitePages.indexOf(page);\n\n                    if (page !== null && page !== void 0 && page.code) {\n                      var _page$code;\n\n                      const pageCode = page === null || page === void 0 ? void 0 : (_page$code = page.code) === null || _page$code === void 0 ? void 0 : _page$code.find(x => x === code);\n\n                      if (!pageCode) {\n                        page.code.push(code);\n                      }\n                    } else {\n                      page['code'] = [code];\n                    }\n\n                    updatedWebsitePages[index] = page;\n                    website.pages = updatedWebsitePages;\n                  }\n\n                  setWebsiteData(website);\n                } else {\n                  setRequestSend(false);\n                }\n              });\n            } else {\n              setRequestSend(false);\n              toast.error('Something went wrong while fetching language webpage file. Please check network tab.', {\n                position: toast.POSITION.TOP_RIGHT\n              });\n            }\n          });\n        } else {\n          setRequestSend(false);\n          toast.error('Something went wrong while fetching webpage file. Please check network tab.', {\n            position: toast.POSITION.TOP_RIGHT\n          });\n        }\n      });\n    }\n  }, [isWebPageSelected, state.code]);\n\n  const handleSave = () => {\n    // saving web page in rafile\n    if (isWebPageSelected) {\n      if (webPage && webPage.istemplate) {\n        rafileInsert();\n      } else {\n        rafilePatch();\n      }\n    } else {\n      rafileInsert();\n    }\n  };\n\n  const rafileInsert = () => {\n    setRequestSend(true);\n    Insert({\n      // insert web page json to rafile\n      apiUrl: GENERAL_SETTINGS.OREST_URL,\n      endpoint: OREST_ENDPOINT.RAFILE,\n      token: authToken,\n      data: {\n        code: code,\n        description: description,\n        filetype: 'WEBPAGE',\n        filedata: Buffer.from(JSON.stringify(state.page)).toString('base64'),\n        istemplate: isTemplate,\n        langid: state.langId,\n        hotelrefno: Number(companyId)\n      }\n    }).then(res => {\n      var _res$data;\n\n      if (res.status === 200 && res !== null && res !== void 0 && (_res$data = res.data) !== null && _res$data !== void 0 && _res$data.data) {\n        Insert({\n          // insert language file for web page into rafile\n          apiUrl: GENERAL_SETTINGS.OREST_URL,\n          endpoint: OREST_ENDPOINT.RAFILE,\n          token: authToken,\n          data: {\n            code: code,\n            description: description,\n            contentype: '0000530',\n            filetype: 'LANG.WEBPAGE',\n            filedata: Buffer.from(JSON.stringify(state.langsFile)).toString('base64'),\n            masterid: res.data.data.mid,\n            hotelrefno: Number(companyId)\n          }\n        }).then(res1 => {\n          var _res1$data;\n\n          if (res1.status === 200 && res1 !== null && res1 !== void 0 && (_res1$data = res1.data) !== null && _res1$data !== void 0 && _res1$data.data) {\n            setRequestSend(false);\n            handleClearData();\n            handleReset();\n            toast.success(SAVED_SUCCESS, {\n              position: toast.POSITION.TOP_RIGHT\n            });\n          } else {\n            setRequestSend(false);\n            const retErr = isErrorMsg(res);\n            toast.error(retErr.errorMsg, {\n              position: toast.POSITION.TOP_RIGHT\n            });\n          }\n        });\n      } else {\n        setRequestSend(false);\n        const retErr = isErrorMsg(res);\n        toast.error(retErr.errorMsg, {\n          position: toast.POSITION.TOP_RIGHT\n        });\n      }\n    });\n  };\n\n  const rafilePatch = () => {\n    setRequestSend(true);\n    Patch({\n      // update web page json to rafile\n      apiUrl: GENERAL_SETTINGS.OREST_URL,\n      endpoint: OREST_ENDPOINT.RAFILE,\n      token: authToken,\n      gid: webPage.gid,\n      params: {\n        hotelrefno: Number(companyId)\n      },\n      data: {\n        code: code,\n        description: description,\n        filedata: Buffer.from(JSON.stringify(state.page)).toString('base64'),\n        istemplate: isTemplate,\n        hotelrefno: Number(companyId)\n      }\n    }).then(res1 => {\n      var _res1$data2;\n\n      if (res1.status === 200 && res1 !== null && res1 !== void 0 && (_res1$data2 = res1.data) !== null && _res1$data2 !== void 0 && _res1$data2.data) {\n        Patch({\n          // update lang file for web page to rafile\n          apiUrl: GENERAL_SETTINGS.OREST_URL,\n          endpoint: OREST_ENDPOINT.RAFILE,\n          token: authToken,\n          gid: langFileGID,\n          params: {\n            hotelrefno: Number(companyId)\n          },\n          data: {\n            code: code,\n            description: description,\n            filedata: Buffer.from(JSON.stringify(state.langsFile)).toString('base64'),\n            masterid: res1.data.data.mid,\n            hotelrefno: Number(companyId)\n          }\n        }).then(res2 => {\n          var _res2$data3;\n\n          if (res2.status === 200 && res2 !== null && res2 !== void 0 && (_res2$data3 = res2.data) !== null && _res2$data3 !== void 0 && _res2$data3.data) {\n            const website = _objectSpread({}, websiteData);\n\n            const updatedWebsitePages = [...website.pages];\n            const page = updatedWebsitePages === null || updatedWebsitePages === void 0 ? void 0 : updatedWebsitePages.find(x => (x === null || x === void 0 ? void 0 : x.gid) === res1.data.data.gid);\n\n            if (page) {\n              const index = updatedWebsitePages.indexOf(page);\n\n              if (page !== null && page !== void 0 && page.code) {\n                var _page$code2;\n\n                const pageCode = page === null || page === void 0 ? void 0 : (_page$code2 = page.code) === null || _page$code2 === void 0 ? void 0 : _page$code2.find(x => x === code);\n\n                if (!pageCode) {\n                  page.code.push(code);\n                }\n              } else {\n                page['code'] = [code];\n              }\n\n              updatedWebsitePages[index] = page;\n              website.pages = updatedWebsitePages;\n              Patch({\n                // update website into rafile\n                apiUrl: GENERAL_SETTINGS.OREST_URL,\n                endpoint: OREST_ENDPOINT.RAFILE,\n                token: authToken,\n                gid: websiteGID,\n                params: {\n                  hotelrefno: Number(companyId)\n                },\n                data: {\n                  filedata: Buffer.from(JSON.stringify(website)).toString(\"base64\"),\n                  hotelrefno: Number(companyId)\n                }\n              }).then(res3 => {\n                var _res3$data;\n\n                if ((res3 === null || res3 === void 0 ? void 0 : res3.status) === 200 && res3 !== null && res3 !== void 0 && (_res3$data = res3.data) !== null && _res3$data !== void 0 && _res3$data.data) {\n                  setRequestSend(false);\n                  handleClearData();\n                  handleReset();\n                  toast.success(UPDATE_SUCCESS, {\n                    position: toast.POSITION.TOP_RIGHT\n                  });\n                } else {\n                  const retErr = isErrorMsg(res3);\n                  toast.error(retErr.errorMsg, {\n                    position: toast.POSITION.TOP_RIGHT\n                  });\n                }\n              });\n            } else {\n              setRequestSend(false);\n              handleClearData();\n              toast.success(UPDATE_SUCCESS, {\n                position: toast.POSITION.TOP_RIGHT\n              });\n              handleReset();\n            }\n          } else {\n            setRequestSend(false);\n            const retErr = isErrorMsg(res2);\n            toast.error(retErr.errorMsg, {\n              position: toast.POSITION.TOP_RIGHT\n            });\n          }\n        });\n      } else {\n        setRequestSend(false);\n        const retErr = isErrorMsg(res1);\n        toast.error(retErr.errorMsg, {\n          position: toast.POSITION.TOP_RIGHT\n        });\n      }\n    });\n  };\n\n  const handleClearData = () => {\n    updateState('pageBuilder', 'pageStep', 0);\n    updateState('pageBuilder', 'isTemplate', false);\n    updateState('pageBuilder', 'previousStep', 0);\n    updateState('pageBuilder', 'page', emptyPage);\n    updateState('pageBuilder', 'langsFile', {});\n  };\n\n  const handleReset = () => {\n    setCode('');\n    setDescription('');\n    setOpen(false);\n    resetFinal('');\n  };\n\n  return __jsx(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 332,\n      columnNumber: 9\n    }\n  }, __jsx(Dialog, {\n    disableBackdropClick: true,\n    disableEnforceFocus: true,\n    fullWidth: true,\n    maxWidth: \"md\",\n    open: isOpen,\n    onClose: handleReset,\n    \"aria-labelledby\": \"form-dialog-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 333,\n      columnNumber: 13\n    }\n  }, __jsx(DialogTitle, {\n    color: \"secondary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 342,\n      columnNumber: 17\n    }\n  }, ' ', dialogTitle, \" \", __jsx(\"hr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 344,\n      columnNumber: 35\n    }\n  }), ' '), __jsx(DialogContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 346,\n      columnNumber: 17\n    }\n  }, isRequestSend ? __jsx(LoadingSpinner, {\n    style: {\n      color: COLORS.secondary\n    },\n    size: 40,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 348,\n      columnNumber: 41\n    }\n  }) : __jsx(React.Fragment, null, __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 33\n    }\n  }, __jsx(TextField, {\n    label: \"Code\",\n    placeholder: \"Please enter code here ...\",\n    value: code,\n    style: {\n      minWidth: 500\n    },\n    onChange: e => setCode(e.target.value),\n    variant: \"outlined\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 351,\n      columnNumber: 37\n    }\n  })), __jsx(\"div\", {\n    style: {\n      marginTop: 30\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 360,\n      columnNumber: 33\n    }\n  }, __jsx(TextField, {\n    label: \"Description\",\n    placeholder: \"Please enter description here ...\",\n    value: description,\n    onChange: e => setDescription(e.target.value),\n    multiline: true,\n    style: {\n      minWidth: 500\n    },\n    rows: 1,\n    rowsMax: 4,\n    variant: \"outlined\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 361,\n      columnNumber: 37\n    }\n  })), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 373,\n      columnNumber: 33\n    }\n  }, __jsx(FormControlLabel, {\n    control: __jsx(Checkbox, {\n      checked: isTemplate,\n      onChange: () => setIsTemplate(!isTemplate),\n      name: \"istemplate\",\n      color: \"primary\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 376,\n        columnNumber: 45\n      }\n    }),\n    label: \"Save as Template\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 374,\n      columnNumber: 37\n    }\n  })))), __jsx(DialogActions, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 389,\n      columnNumber: 17\n    }\n  }, __jsx(Button, {\n    onClick: handleReset,\n    variant: \"contained\",\n    size: \"small\",\n    \"aria-label\": \"add\",\n    className: classes.actionButton,\n    disabled: isRequestSend,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 390,\n      columnNumber: 21\n    }\n  }, \"Cancel\"), __jsx(Button, {\n    onClick: handleSave,\n    className: classes.actionButton,\n    variant: \"contained\",\n    size: \"small\",\n    \"aria-label\": \"add\",\n    color: \"primary\",\n    disabled: !(description && code) || isRequestSend,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 21\n    }\n  }, \"APPLY\"))), __jsx(ToastContainer, {\n    autoClose: 8000,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 415,\n      columnNumber: 13\n    }\n  }));\n};\n\nconst mapStateToProps = state => {\n  return {\n    state: state.formReducer.pageBuilder\n  };\n};\n\nconst mapDispatchToProps = dispatch => ({\n  updateState: (stateType, stateName, value) => dispatch(updateState(stateType, stateName, value)),\n  setToState: (stateType, stateName, value) => dispatch(setToState(stateType, stateName, value))\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Final);","map":{"version":3,"sources":["/Users/mata/app-cloudweb/components/page-builder/PageBuilderSteps/steps/webpage/Final.js"],"names":["React","useState","useContext","useEffect","Dialog","DialogActions","DialogContent","DialogTitle","Button","TextField","connect","ToastContainer","toast","WebCmsGlobal","isErrorMsg","OREST_ENDPOINT","useRouter","makeStyles","setToState","updateState","Insert","Patch","ViewList","Checkbox","FormControlLabel","COLORS","SAVED_SUCCESS","UPDATE_SUCCESS","LoadingSpinner","useStyles","theme","actionButton","marginLeft","spacing","borderRadius","Final","props","state","dialogTitle","resetFinal","isWebPageSelected","isOpen","setOpen","code","setCode","description","setDescription","isTemplate","setIsTemplate","webPage","setWebPage","langFileGID","setLangFileGID","isRequestSend","setRequestSend","emptyPage","id","sections","websiteData","setWebsiteData","websiteGID","setWebsiteGID","classes","GENERAL_SETTINGS","token","router","companyId","query","companyID","authToken","apiUrl","OREST_URL","endpoint","RAFILE","params","hotelrefno","Number","then","res","status","data","length","istemplate","res1","gid","res2","website","JSON","parse","Buffer","from","filedata","toString","updatedWebsitePages","pages","page","find","x","index","indexOf","pageCode","push","error","position","POSITION","TOP_RIGHT","handleSave","rafileInsert","rafilePatch","filetype","stringify","langid","langId","contentype","langsFile","masterid","mid","handleClearData","handleReset","success","retErr","errorMsg","res3","color","secondary","minWidth","e","target","value","marginTop","mapStateToProps","formReducer","pageBuilder","mapDispatchToProps","dispatch","stateType","stateName"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from 'react'\n//material imports\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Button from '@material-ui/core/Button'\nimport TextField from '@material-ui/core/TextField'\n//redux imports\nimport { connect } from 'react-redux'\n// imports for toaster\nimport { ToastContainer, toast } from 'react-toastify'\n//imports configs\nimport WebCmsGlobal from 'components/webcms-global'\nimport { isErrorMsg, OREST_ENDPOINT } from '../../../../../model/orest/constants'\n//router import\nimport { useRouter } from 'next/router'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { setToState, updateState } from '../../../../../state/actions'\nimport { Insert, Patch, ViewList } from '@webcms/orest'\nimport { Checkbox, FormControlLabel } from '@material-ui/core'\nimport {COLORS, SAVED_SUCCESS, UPDATE_SUCCESS} from \"../../constants\";\nimport LoadingSpinner from \"../../../../LoadingSpinner\";\n\nconst useStyles = makeStyles((theme) => ({\n    actionButton: {\n        marginLeft: theme.spacing(1),\n        borderRadius: 20,\n    },\n}))\n\nconst Final = (props) => {\n    const { state, dialogTitle, resetFinal, isWebPageSelected, updateState } = props\n\n    //local state\n    const [isOpen, setOpen] = useState(true)\n    const [code, setCode] = useState('')\n    const [description, setDescription] = useState('')\n    const [isTemplate, setIsTemplate] = useState(false)\n    const [webPage, setWebPage] = useState('');\n    const [langFileGID, setLangFileGID] = useState('');\n    const [isRequestSend, setRequestSend] = useState(false);\n    const emptyPage = {\n        id: '',\n        sections: [],\n    };\n    const [websiteData, setWebsiteData] = useState(null);\n    const [websiteGID, setWebsiteGID] = useState(null);\n\n    const classes = useStyles();\n\n    const { GENERAL_SETTINGS, token } = useContext(WebCmsGlobal);\n\n    const router = useRouter();\n    const companyId = router.query.companyID;\n    const authToken = token || router.query.authToken;\n\n    useEffect(() => {\n        if (isWebPageSelected && state.code) {\n            setRequestSend(true);\n            ViewList({\n                apiUrl: GENERAL_SETTINGS.OREST_URL,\n                endpoint: OREST_ENDPOINT.RAFILE,\n                token: authToken,\n                params: {\n                    query: `code::${state.code},filetype::WEBPAGE`,\n                    hotelrefno: Number(companyId),\n                },\n            }).then((res) => {\n                if (res.status === 200 && res.data && res.data.data.length > 0) {\n                    setWebPage(res.data.data[0])\n                    if (!res.data.data[0].istemplate) {\n                        setCode(res.data.data[0].code)\n                        setDescription(res.data.data[0].description);\n                        setIsTemplate(res.data.data[0].istemplate)\n                    }\n                    ViewList({\n                        apiUrl: GENERAL_SETTINGS.OREST_URL,\n                        endpoint: OREST_ENDPOINT.RAFILE,\n                        token: authToken,\n                        params: {\n                            query: `code::${state.code},filetype::LANG.WEBPAGE`,\n                            hotelrefno: Number(companyId),\n                        },\n                    }).then(res1 => {\n                        if (res1.status === 200 && res1.data && res1.data.data.length > 0) {\n                            setLangFileGID(res1.data.data[0].gid);\n                            ViewList({\n                                apiUrl: GENERAL_SETTINGS.OREST_URL,\n                                endpoint: OREST_ENDPOINT.RAFILE,\n                                token: authToken,\n                                params: {\n                                    query: `code::WEBINDEX,filetype::WEBSITE`,\n                                    hotelrefno: Number(companyId),\n                                },\n                            }).then(res2 => {\n                                if (res2?.status === 200 && res2?.data?.data?.length > 0) {\n                                    setRequestSend(false);\n                                    const website = JSON.parse(Buffer.from(res2?.data?.data[0]?.filedata, 'base64').toString('utf-8'));\n                                    setWebsiteGID(res2.data.data[0].gid);\n                                    const updatedWebsitePages = [...website.pages];\n                                    const page = updatedWebsitePages?.find(x => x?.gid === res.data.data[0].gid);\n                                    if (page) {\n                                        const index = updatedWebsitePages.indexOf(page);\n                                        if (page?.code) {\n                                            const pageCode = page?.code?.find(x => x === code);\n                                            if (!pageCode) {\n                                                page.code.push(code);\n                                            }\n                                        } else {\n                                            page['code'] = [code];\n                                        }\n                                        updatedWebsitePages[index] = page;\n                                        website.pages = updatedWebsitePages;\n                                    }\n                                    setWebsiteData(website);\n                                } else {\n                                    setRequestSend(false);\n                                }\n                            })\n                        } else {\n                            setRequestSend(false);\n                            toast.error('Something went wrong while fetching language webpage file. Please check network tab.', {\n                                position: toast.POSITION.TOP_RIGHT,\n                            })\n                        }\n                    })\n                } else {\n                    setRequestSend(false);\n                    toast.error('Something went wrong while fetching webpage file. Please check network tab.', {\n                        position: toast.POSITION.TOP_RIGHT,\n                    })\n                }\n            })\n        }\n    }, [isWebPageSelected, state.code])\n\n    const handleSave = () => {\n        // saving web page in rafile\n        if (isWebPageSelected) {\n            if (webPage && webPage.istemplate) {\n                rafileInsert();\n            } else {\n                rafilePatch();\n            }\n        } else {\n            rafileInsert()\n        }\n    }\n\n    const rafileInsert = () => {\n        setRequestSend(true);\n        Insert({\n            // insert web page json to rafile\n            apiUrl: GENERAL_SETTINGS.OREST_URL,\n            endpoint: OREST_ENDPOINT.RAFILE,\n            token: authToken,\n            data: {\n                code: code,\n                description: description,\n                filetype: 'WEBPAGE',\n                filedata: Buffer.from(JSON.stringify(state.page)).toString('base64'),\n                istemplate: isTemplate,\n                langid: state.langId,\n                hotelrefno: Number(companyId),\n            },\n        }).then((res) => {\n            if (res.status === 200 && res?.data?.data) {\n                Insert({\n                    // insert language file for web page into rafile\n                    apiUrl: GENERAL_SETTINGS.OREST_URL,\n                    endpoint: OREST_ENDPOINT.RAFILE,\n                    token: authToken,\n                    data: {\n                        code: code,\n                        description: description,\n                        contentype: '0000530',\n                        filetype: 'LANG.WEBPAGE',\n                        filedata: Buffer.from(JSON.stringify(state.langsFile)).toString('base64'),\n                        masterid: res.data.data.mid,\n                        hotelrefno: Number(companyId),\n                    },\n                }).then(res1 => {\n                    if (res1.status === 200 && res1?.data?.data) {\n                        setRequestSend(false);\n                        handleClearData();\n                        handleReset();\n                        toast.success(SAVED_SUCCESS, {\n                            position: toast.POSITION.TOP_RIGHT,\n                        });\n                    } else {\n                        setRequestSend(false);\n                        const retErr = isErrorMsg(res);\n                        toast.error(retErr.errorMsg, {\n                            position: toast.POSITION.TOP_RIGHT,\n                        })\n                    }\n                })\n            } else {\n                setRequestSend(false);\n                const retErr = isErrorMsg(res);\n                toast.error(retErr.errorMsg, {\n                    position: toast.POSITION.TOP_RIGHT,\n                })\n            }\n        })\n    }\n\n    const rafilePatch = () => {\n        setRequestSend(true);\n        Patch({\n            // update web page json to rafile\n            apiUrl: GENERAL_SETTINGS.OREST_URL,\n            endpoint: OREST_ENDPOINT.RAFILE,\n            token: authToken,\n            gid: webPage.gid,\n            params: {\n                hotelrefno: Number(companyId)\n            },\n            data: {\n                code: code,\n                description: description,\n                filedata: Buffer.from(JSON.stringify(state.page)).toString('base64'),\n                istemplate: isTemplate,\n                hotelrefno: Number(companyId),\n            },\n        }).then((res1) => {\n            if (res1.status === 200 && res1?.data?.data) {\n                Patch({\n                    // update lang file for web page to rafile\n                    apiUrl: GENERAL_SETTINGS.OREST_URL,\n                    endpoint: OREST_ENDPOINT.RAFILE,\n                    token: authToken,\n                    gid: langFileGID,\n                    params: {\n                        hotelrefno: Number(companyId)\n                    },\n                    data: {\n                        code: code,\n                        description: description,\n                        filedata: Buffer.from(JSON.stringify(state.langsFile)).toString('base64'),\n                        masterid: res1.data.data.mid,\n                        hotelrefno: Number(companyId),\n                    },\n                }).then(res2 => {\n                    if (res2.status === 200 && res2?.data?.data) {\n                        const website = {...websiteData};\n                        const updatedWebsitePages = [...website.pages];\n                        const page = updatedWebsitePages?.find(x => x?.gid === res1.data.data.gid);\n                        if (page) {\n                            const index = updatedWebsitePages.indexOf(page);\n                            if (page?.code) {\n                                const pageCode = page?.code?.find(x => x === code);\n                                if (!pageCode) {\n                                    page.code.push(code);\n                                }\n                            } else {\n                                page['code'] = [code];\n                            }\n                            updatedWebsitePages[index] = page;\n                            website.pages = updatedWebsitePages;\n                            Patch({ // update website into rafile\n                                apiUrl: GENERAL_SETTINGS.OREST_URL,\n                                endpoint: OREST_ENDPOINT.RAFILE,\n                                token: authToken,\n                                gid: websiteGID,\n                                params: {\n                                    hotelrefno: Number(companyId)\n                                },\n                                data: {\n                                    filedata: Buffer.from(JSON.stringify(website)).toString(\"base64\"),\n                                    hotelrefno: Number(companyId)\n                                },\n                            }).then(res3 => {\n                                if (res3?.status === 200 && res3?.data?.data) {\n                                    setRequestSend(false);\n                                    handleClearData();\n                                    handleReset();\n                                    toast.success(UPDATE_SUCCESS, {\n                                        position: toast.POSITION.TOP_RIGHT,\n                                    });\n\n                                } else {\n                                    const retErr = isErrorMsg(res3);\n                                    toast.error(retErr.errorMsg, {\n                                        position: toast.POSITION.TOP_RIGHT,\n                                    })\n                                }\n                            })\n                        } else {\n                            setRequestSend(false);\n                            handleClearData();\n                            toast.success(UPDATE_SUCCESS, {\n                                position: toast.POSITION.TOP_RIGHT,\n                            });\n                            handleReset();\n                        }\n                    } else {\n                        setRequestSend(false);\n                        const retErr = isErrorMsg(res2);\n                        toast.error(retErr.errorMsg, {\n                            position: toast.POSITION.TOP_RIGHT,\n                        })\n                    }\n                })\n            } else {\n                setRequestSend(false);\n                const retErr = isErrorMsg(res1);\n                toast.error(retErr.errorMsg, {\n                    position: toast.POSITION.TOP_RIGHT,\n                })\n            }\n        })\n    }\n\n    const handleClearData = () => {\n        updateState('pageBuilder', 'pageStep', 0);\n        updateState('pageBuilder', 'isTemplate', false);\n        updateState('pageBuilder', 'previousStep', 0);\n        updateState('pageBuilder', 'page', emptyPage);\n        updateState('pageBuilder', 'langsFile', {});\n    }\n\n    const handleReset = () => {\n        setCode('')\n        setDescription('')\n        setOpen(false)\n        resetFinal('')\n    }\n\n    return (\n        <React.Fragment>\n            <Dialog\n                disableBackdropClick\n                disableEnforceFocus\n                fullWidth={true}\n                maxWidth=\"md\"\n                open={isOpen}\n                onClose={handleReset}\n                aria-labelledby=\"form-dialog-title\"\n            >\n                <DialogTitle color=\"secondary\">\n                    {' '}\n                    {dialogTitle} <hr />{' '}\n                </DialogTitle>\n                <DialogContent>\n                    {\n                        isRequestSend ? <LoadingSpinner style={{color: COLORS.secondary}} size={40} /> :\n                            <>\n                                <div>\n                                    <TextField\n                                        label=\"Code\"\n                                        placeholder=\"Please enter code here ...\"\n                                        value={code}\n                                        style={{minWidth: 500}}\n                                        onChange={(e) => setCode(e.target.value)}\n                                        variant=\"outlined\"\n                                    />\n                                </div>\n                                <div style={{marginTop: 30}}>\n                                    <TextField\n                                        label=\"Description\"\n                                        placeholder=\"Please enter description here ...\"\n                                        value={description}\n                                        onChange={(e) => setDescription(e.target.value)}\n                                        multiline\n                                        style={{minWidth: 500}}\n                                        rows={1}\n                                        rowsMax={4}\n                                        variant=\"outlined\"\n                                    />\n                                </div>\n                                <div>\n                                    <FormControlLabel\n                                        control={\n                                            <Checkbox\n                                                checked={isTemplate}\n                                                onChange={() => setIsTemplate(!isTemplate)}\n                                                name=\"istemplate\"\n                                                color=\"primary\"\n                                            />\n                                        }\n                                        label=\"Save as Template\"\n                                    />\n                                </div>\n                            </>\n                    }\n                </DialogContent>\n                <DialogActions>\n                    <Button\n                        onClick={handleReset}\n                        variant=\"contained\"\n                        size=\"small\"\n                        aria-label=\"add\"\n                        className={classes.actionButton}\n                        disabled={isRequestSend}\n                    >\n                        Cancel\n                    </Button>\n\n                    <Button\n                        onClick={handleSave}\n                        className={classes.actionButton}\n                        variant=\"contained\"\n                        size=\"small\"\n                        aria-label=\"add\"\n                        color=\"primary\"\n                        disabled={!(description && code) || isRequestSend}\n                    >\n                        APPLY\n                    </Button>\n                </DialogActions>\n            </Dialog>\n\n            <ToastContainer autoClose={8000} />\n        </React.Fragment>\n    )\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        state: state.formReducer.pageBuilder,\n    }\n}\n\nconst mapDispatchToProps = (dispatch) => ({\n    updateState: (stateType, stateName, value) => dispatch(updateState(stateType, stateName, value)),\n    setToState: (stateType, stateName, value) => dispatch(setToState(stateType, stateName, value)),\n})\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Final)\n"]},"metadata":{},"sourceType":"module"}
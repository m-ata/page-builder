{"ast":null,"code":"var _jsxFileName = \"/Users/mata/app-cloudweb/components/guest/account/Reservations/ReservationCancelDialog.js\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, useContext } from 'react';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Button from '@material-ui/core/Button';\nimport { connect, useSelector } from 'react-redux';\nimport { setToState } from 'state/actions';\nimport useTranslation from 'lib/translations/hooks/useTranslation';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nimport Grid from '@material-ui/core/Grid';\nimport Container from '@material-ui/core/Container';\nimport Box from '@material-ui/core/Box';\nimport TextField from '@material-ui/core/TextField';\nimport { List, Insert, Patch, UseOrest, ViewList } from '@webcms/orest';\nimport { DEFAULT_OREST_TOKEN, OREST_ENDPOINT, REQUEST_METHOD_CONST } from 'model/orest/constants';\nimport WebCmsGlobal from 'components/webcms-global';\nimport { useSnackbar } from 'notistack';\nimport { sendGuestChangeNotifyMail } from '../Base/helper';\nimport { CustomToolTip } from \"../../../user-portal/components/CustomToolTip/CustomToolTip\";\nimport Typography from \"@material-ui/core/Typography\";\n\nconst ReservationCancelDialog = props => {\n  const {\n    GENERAL_SETTINGS\n  } = useContext(WebCmsGlobal);\n  const {\n    state,\n    reservation,\n    open,\n    onClose,\n    getCallbackData,\n    type,\n    isOnlyUpdate\n  } = props;\n  const token = useSelector(state => state.orest.currentUser !== null ? state.orest.currentUser.auth.access_token : DEFAULT_OREST_TOKEN);\n  const hotelRefNo = useSelector(state => {\n    var _state$formReducer, _state$formReducer$gu, _state$hotelinfo;\n\n    return (state === null || state === void 0 ? void 0 : (_state$formReducer = state.formReducer) === null || _state$formReducer === void 0 ? void 0 : (_state$formReducer$gu = _state$formReducer.guest) === null || _state$formReducer$gu === void 0 ? void 0 : _state$formReducer$gu.changeHotelRefno) || (state === null || state === void 0 ? void 0 : (_state$hotelinfo = state.hotelinfo) === null || _state$hotelinfo === void 0 ? void 0 : _state$hotelinfo.currentHotelRefNo) || GENERAL_SETTINGS.HOTELREFNO;\n  });\n  const clientBase = useSelector(state => {\n    var _state$orest, _state$orest$state;\n\n    return (state === null || state === void 0 ? void 0 : (_state$orest = state.orest) === null || _state$orest === void 0 ? void 0 : (_state$orest$state = _state$orest.state) === null || _state$orest$state === void 0 ? void 0 : _state$orest$state.client) || false;\n  });\n  const reservBase = state.clientReservation || false;\n  const {\n    t\n  } = useTranslation();\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState(false);\n  const {\n    0: resxreasonID,\n    1: setResxreasonID\n  } = useState(false);\n  const {\n    0: resxReasonList,\n    1: setResxReasonList\n  } = useState(false);\n  const {\n    0: resxReasonUpdateList,\n    1: setResxReasonUpdateList\n  } = useState(false);\n  const {\n    0: resxreasonNote,\n    1: setResxreasonNote\n  } = useState(\"\");\n  const {\n    0: renderList,\n    1: setRenderList\n  } = useState([]);\n  const {\n    0: openToolTip,\n    1: setOpenToolTip\n  } = useState(false);\n  useEffect(() => {\n    let active = true;\n\n    if (active) {\n      const array = [{\n        title: 'cancelList',\n        params: type === 'room' && {\n          query: 'isactive:true,isresa:true,isgapp:true',\n          hotelrefno: hotelRefNo\n        }\n      }, {\n        title: 'updateList',\n        params: type === 'room' && {\n          query: 'isactive:true,isresa:true,isupd:true,isgapp:true',\n          hotelrefno: hotelRefNo\n        }\n      }];\n      array.map((item, index) => {\n        ViewList({\n          apiUrl: GENERAL_SETTINGS.OREST_URL,\n          endpoint: OREST_ENDPOINT.RESXREASON,\n          token: token,\n          params: item === null || item === void 0 ? void 0 : item.params\n        }).then(response => {\n          if (response.status === 200 && response.data.count > 0) {\n            const responseData = response.data.data;\n            setRenderList(responseData);\n\n            if (item.title === 'cancelList') {\n              setResxReasonList(responseData);\n            } else if (item.title === 'updateList') {\n              setResxReasonUpdateList(responseData);\n            }\n          } else {\n            setResxReasonList(false);\n            setResxReasonUpdateList(false);\n          }\n        }).catch(() => {\n          setResxReasonList(false);\n        });\n      });\n    }\n\n    return () => {\n      setIsLoading(false);\n      active = false;\n    };\n  }, []);\n  useEffect(() => {\n    if (isOnlyUpdate) {\n      setRenderList(resxReasonUpdateList);\n    } else {\n      setRenderList(resxReasonList);\n    }\n  }, [isOnlyUpdate]);\n\n  const cancelEventReservation = () => {\n    const reasonForCancel = resxReasonList.find(item => Number(item.id) === Number(resxreasonID));\n    const notifyValues = {\n      roomno: (reservBase === null || reservBase === void 0 ? void 0 : reservBase.roomno) || \"-\",\n      clientname: (clientBase === null || clientBase === void 0 ? void 0 : clientBase.clientname) || \"-\",\n      details: JSON.stringify({\n        description: reasonForCancel.description,\n        note: resxreasonNote ? resxreasonNote : \"-\",\n        loc: reservation.description,\n        date: reservation.startdate,\n        time: reservation.starttime,\n        totalpax: reservation.totalpax,\n        totalchd: reservation.totalchd\n      })\n    };\n    Insert({\n      apiUrl: GENERAL_SETTINGS.OREST_URL,\n      endpoint: OREST_ENDPOINT.RESXREASONLIST,\n      token: token,\n      data: {\n        resxreasonid: resxreasonID,\n        note: resxreasonNote,\n        reservno: reservation.reservno,\n        hotelrefno: reservation.hotelrefno\n      }\n    }).then(response => {\n      if (response.status === 200) {\n        Patch({\n          apiUrl: GENERAL_SETTINGS.OREST_URL,\n          endpoint: OREST_ENDPOINT.RESEVENT,\n          token: token,\n          gid: reservation.gid,\n          params: {\n            hotelrefno: reservation.hotelrefno\n          },\n          data: {\n            status: 'X'\n          }\n        }).then(async response => {\n          if (response.status === 200) {\n            getCallbackData();\n            enqueueSnackbar(t('str_updatedSuccessfully'), {\n              variant: 'success'\n            });\n            onClose(true);\n            setResxreasonID(false);\n            setResxreasonNote(\"\");\n            setIsLoading(false);\n            await sendGuestChangeNotifyMail(reservBase !== null && reservBase !== void 0 && reservBase.gid ? false : true, 'resevent', 'cnl', clientBase.id, reservBase !== null && reservBase !== void 0 && reservBase.gid ? reservBase.gid : clientBase.gid, notifyValues, (reservBase === null || reservBase === void 0 ? void 0 : reservBase.hotelrefno) || GENERAL_SETTINGS.HOTELREFNO);\n          } else {\n            enqueueSnackbar(t('str_unexpectedProblem'), {\n              variant: 'warning'\n            });\n            onClose(true);\n            setIsLoading(false);\n          }\n        }).catch(() => {\n          enqueueSnackbar(t('str_unexpectedProblem'), {\n            variant: 'warning'\n          });\n          onClose(true);\n          setIsLoading(false);\n        });\n      } else {\n        enqueueSnackbar(t('str_unexpectedProblem'), {\n          variant: 'warning'\n        });\n        onClose(true);\n        setIsLoading(false);\n      }\n    }).catch(() => {\n      enqueueSnackbar(t('str_unexpectedProblem'), {\n        variant: 'warning'\n      });\n      onClose(true);\n      setIsLoading(false);\n    });\n  };\n\n  const cancelRoomReservation = () => {\n    const reasonForCancel = resxReasonList.find(item => Number(item.id) === Number(resxreasonID));\n    const notifyValues = {\n      roomno: (reservBase === null || reservBase === void 0 ? void 0 : reservBase.roomno) || \"-\",\n      clientname: (clientBase === null || clientBase === void 0 ? void 0 : clientBase.clientname) || \"-\",\n      details: JSON.stringify({\n        description: reasonForCancel.description,\n        note: resxreasonNote ? resxreasonNote : \"-\",\n        roomtype: (reservation === null || reservation === void 0 ? void 0 : reservation.roomtypedesc) || \"-\",\n        resdate: (reservation === null || reservation === void 0 ? void 0 : reservation.resdate) || \"-\",\n        cidate: (reservation === null || reservation === void 0 ? void 0 : reservation.checkin) || \"-\",\n        codate: (reservation === null || reservation === void 0 ? void 0 : reservation.checkout) || \"-\",\n        totalpax: (reservation === null || reservation === void 0 ? void 0 : reservation.totalpax) || \"-\",\n        totalchd: (reservation === null || reservation === void 0 ? void 0 : reservation.totalchd) || \"-\"\n      })\n    };\n    Insert({\n      apiUrl: GENERAL_SETTINGS.OREST_URL,\n      endpoint: OREST_ENDPOINT.RESXREASONLIST,\n      token: token,\n      data: {\n        resxreasonid: resxreasonID,\n        note: resxreasonNote,\n        reservno: reservation.reservno,\n        hotelrefno: reservation.hotelrefno\n      }\n    }).then(response => {\n      if (response.status === 200) {\n        if (isOnlyUpdate) {\n          getCallbackData();\n          enqueueSnackbar(t('str_updatedSuccessfully'), {\n            variant: 'success'\n          });\n          onClose(true);\n          setResxreasonID(false);\n          setResxreasonNote(\"\");\n          setIsLoading(false);\n        } else {\n          UseOrest({\n            apiUrl: GENERAL_SETTINGS.OREST_URL,\n            endpoint: OREST_ENDPOINT.RESERVAT_DOX,\n            method: REQUEST_METHOD_CONST.PUT,\n            token: token,\n            params: {\n              reservno: reservation.reservno,\n              hotelrefno: reservation.hotelrefno\n            }\n          }).then(async response => {\n            if (response.status === 200) {\n              getCallbackData();\n              enqueueSnackbar(t('str_updatedSuccessfully'), {\n                variant: 'success'\n              });\n              onClose(true);\n              setResxreasonID(false);\n              setResxreasonNote(\"\");\n              setIsLoading(false);\n              await sendGuestChangeNotifyMail(reservBase !== null && reservBase !== void 0 && reservBase.gid ? false : true, 'reservat', 'cnl', clientBase.id, reservBase !== null && reservBase !== void 0 && reservBase.gid ? reservBase.gid : clientBase.gid, notifyValues, (reservBase === null || reservBase === void 0 ? void 0 : reservBase.hotelrefno) || GENERAL_SETTINGS.HOTELREFNO);\n            } else {\n              enqueueSnackbar(t('str_unexpectedProblem'), {\n                variant: 'warning'\n              });\n              onClose(true);\n              setIsLoading(false);\n            }\n          }).catch(() => {\n            enqueueSnackbar(t('str_unexpectedProblem'), {\n              variant: 'warning'\n            });\n            onClose(true);\n            setIsLoading(false);\n          });\n        }\n      } else {\n        enqueueSnackbar(t('str_unexpectedProblem'), {\n          variant: 'warning'\n        });\n        onClose(true);\n        setIsLoading(false);\n      }\n    }).catch(() => {\n      enqueueSnackbar(t('str_unexpectedProblem'), {\n        variant: 'warning'\n      });\n      onClose(true);\n      setIsLoading(false);\n    });\n  };\n\n  const handleCancelReservation = () => {\n    if (!resxreasonID) {\n      enqueueSnackbar(t('str_pleaseSelectCancellationReason'), {\n        variant: 'warning'\n      });\n    } else {\n      setIsLoading(true);\n\n      if (type === \"event\") {\n        cancelEventReservation();\n      } else if (type === \"room\") {\n        cancelRoomReservation();\n      }\n    }\n  };\n\n  const handleCloseDialog = prop => {\n    typeof onClose === 'function' && onClose(prop);\n    handleReset();\n  };\n\n  const handleReset = () => {\n    setResxreasonID(false);\n    setResxreasonNote('');\n  };\n\n  return __jsx(Dialog, {\n    maxWidth: \"sm\",\n    fullWidth: true,\n    open: open,\n    onClose: () => onClose(true),\n    \"aria-labelledby\": \"cancellation-reason-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 275,\n      columnNumber: 9\n    }\n  }, __jsx(DialogTitle, {\n    id: \"cancellation-reason-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 282,\n      columnNumber: 13\n    }\n  }, isOnlyUpdate ? t('str_changeReason') : t('str_cancellationReason')), __jsx(DialogContent, {\n    dividers: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 13\n    }\n  }, __jsx(Box, {\n    p: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 17\n    }\n  }, __jsx(Container, {\n    maxWidth: \"sm\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 21\n    }\n  }, __jsx(Grid, {\n    container: true,\n    spacing: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 25\n    }\n  }, __jsx(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 287,\n      columnNumber: 29\n    }\n  }, __jsx(FormControl, {\n    variant: \"outlined\",\n    fullWidth: true,\n    required: true,\n    disabled: isLoading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 33\n    }\n  }, __jsx(InputLabel, {\n    htmlFor: \"resxreasonid-select\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 37\n    }\n  }, isOnlyUpdate ? t('str_changeReason') : t('str_cancellationReason')), __jsx(Select, {\n    native: true,\n    value: resxreasonID,\n    onChange: e => setResxreasonID(e.target.value),\n    label: isOnlyUpdate ? t('str_changeReason') : t('str_cancellationReason'),\n    inputProps: {\n      name: 'resxreasonid',\n      id: 'resxreasonid-select'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 37\n    }\n  }, __jsx(\"option\", {\n    \"aria-label\": \"None\",\n    value: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 297,\n      columnNumber: 41\n    }\n  }), renderList && renderList.length > 0 && renderList.map((item, i) => {\n    return __jsx(\"option\", {\n      key: i,\n      value: item.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 49\n      }\n    }, item.description);\n  })))), __jsx(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 29\n    }\n  }, __jsx(TextField, {\n    disabled: isLoading,\n    fullWidth: true,\n    id: \"resxreason-description\",\n    label: t('str_note'),\n    multiline: true,\n    rows: 4,\n    variant: \"outlined\",\n    value: resxreasonNote,\n    onChange: e => setResxreasonNote(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 33\n    }\n  })))))), __jsx(DialogActions, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 323,\n      columnNumber: 13\n    }\n  }, __jsx(Button, {\n    onClick: () => handleCloseDialog(true),\n    color: \"primary\",\n    variant: 'outlined',\n    disabled: isLoading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 324,\n      columnNumber: 17\n    }\n  }, t('str_close')), __jsx(CustomToolTip, {\n    open: openToolTip,\n    onOpen: () => setOpenToolTip(!resxreasonID),\n    onClose: () => setOpenToolTip(false),\n    title: __jsx(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 328,\n        columnNumber: 21\n      }\n    }, !resxreasonID ? __jsx(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 331,\n        columnNumber: 33\n      }\n    }, __jsx(Typography, {\n      style: {\n        fontWeight: '600',\n        fontSize: 'inherit'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 332,\n        columnNumber: 37\n      }\n    }, t('str_invalidFields')), __jsx(Typography, {\n      style: {\n        fontSize: 'inherit'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 333,\n        columnNumber: 37\n      }\n    }, isOnlyUpdate ? t('str_changeReason') : t('str_cancellationReason'))) : ''),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 327,\n      columnNumber: 17\n    }\n  }, __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 341,\n      columnNumber: 21\n    }\n  }, __jsx(Button, {\n    onClick: () => resxreasonID ? handleCancelReservation() : {},\n    color: \"primary\",\n    variant: 'contained',\n    disabled: isLoading || !resxreasonID,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 342,\n      columnNumber: 26\n    }\n  }, t('str_save'))))));\n};\n\nconst mapStateToProps = state => {\n  return {\n    state: state.formReducer.guest\n  };\n};\n\nconst mapDispatchToProps = dispatch => ({\n  setToState: (stateType, stateName, value) => dispatch(setToState(stateType, stateName, value))\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ReservationCancelDialog);","map":{"version":3,"sources":["/Users/mata/app-cloudweb/components/guest/account/Reservations/ReservationCancelDialog.js"],"names":["React","useState","useEffect","useContext","Dialog","DialogActions","DialogContent","DialogTitle","Button","connect","useSelector","setToState","useTranslation","InputLabel","FormControl","Select","Grid","Container","Box","TextField","List","Insert","Patch","UseOrest","ViewList","DEFAULT_OREST_TOKEN","OREST_ENDPOINT","REQUEST_METHOD_CONST","WebCmsGlobal","useSnackbar","sendGuestChangeNotifyMail","CustomToolTip","Typography","ReservationCancelDialog","props","GENERAL_SETTINGS","state","reservation","open","onClose","getCallbackData","type","isOnlyUpdate","token","orest","currentUser","auth","access_token","hotelRefNo","formReducer","guest","changeHotelRefno","hotelinfo","currentHotelRefNo","HOTELREFNO","clientBase","client","reservBase","clientReservation","t","enqueueSnackbar","isLoading","setIsLoading","resxreasonID","setResxreasonID","resxReasonList","setResxReasonList","resxReasonUpdateList","setResxReasonUpdateList","resxreasonNote","setResxreasonNote","renderList","setRenderList","openToolTip","setOpenToolTip","active","array","title","params","query","hotelrefno","map","item","index","apiUrl","OREST_URL","endpoint","RESXREASON","then","response","status","data","count","responseData","catch","cancelEventReservation","reasonForCancel","find","Number","id","notifyValues","roomno","clientname","details","JSON","stringify","description","note","loc","date","startdate","time","starttime","totalpax","totalchd","RESXREASONLIST","resxreasonid","reservno","RESEVENT","gid","variant","cancelRoomReservation","roomtype","roomtypedesc","resdate","cidate","checkin","codate","checkout","RESERVAT_DOX","method","PUT","handleCancelReservation","handleCloseDialog","prop","handleReset","e","target","value","name","length","i","fontWeight","fontSize","mapStateToProps","mapDispatchToProps","dispatch","stateType","stateName"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from 'react'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Button from '@material-ui/core/Button'\nimport { connect, useSelector } from 'react-redux'\nimport { setToState } from 'state/actions'\nimport useTranslation from 'lib/translations/hooks/useTranslation'\nimport InputLabel from '@material-ui/core/InputLabel'\nimport FormControl from '@material-ui/core/FormControl'\nimport Select from '@material-ui/core/Select'\nimport Grid from '@material-ui/core/Grid'\nimport Container from '@material-ui/core/Container'\nimport Box from '@material-ui/core/Box'\nimport TextField from '@material-ui/core/TextField'\nimport {List, Insert, Patch, UseOrest, ViewList} from '@webcms/orest'\nimport { DEFAULT_OREST_TOKEN, OREST_ENDPOINT, REQUEST_METHOD_CONST } from 'model/orest/constants'\nimport WebCmsGlobal from 'components/webcms-global'\nimport { useSnackbar } from 'notistack'\nimport { sendGuestChangeNotifyMail } from '../Base/helper'\nimport {CustomToolTip} from \"../../../user-portal/components/CustomToolTip/CustomToolTip\";\nimport Typography from \"@material-ui/core/Typography\";\n\nconst ReservationCancelDialog = (props) =>{\n    const { GENERAL_SETTINGS } = useContext(WebCmsGlobal)\n    const { state, reservation, open, onClose, getCallbackData, type, isOnlyUpdate } = props\n    const token = useSelector((state) => state.orest.currentUser !== null ? state.orest.currentUser.auth.access_token : DEFAULT_OREST_TOKEN)\n    const hotelRefNo = useSelector((state) => state?.formReducer?.guest?.changeHotelRefno || state?.hotelinfo?.currentHotelRefNo || GENERAL_SETTINGS.HOTELREFNO)\n    const clientBase = useSelector((state) => state?.orest?.state?.client || false)\n    const reservBase = state.clientReservation || false\n    const { t } = useTranslation()\n\n    const { enqueueSnackbar } = useSnackbar()\n    const [isLoading, setIsLoading] = useState(false)\n    const [resxreasonID, setResxreasonID] = useState(false)\n    const [resxReasonList, setResxReasonList] = useState(false)\n    const [resxReasonUpdateList, setResxReasonUpdateList] = useState(false)\n    const [resxreasonNote, setResxreasonNote] = useState(\"\")\n    const [renderList, setRenderList] = useState([]);\n    const [openToolTip, setOpenToolTip] = useState(false);\n\n\n    useEffect(() => {\n        let active = true\n\n        if (active) {\n\n            const array = [\n                {\n                    title: 'cancelList',\n                    params: type === 'room' && {query: 'isactive:true,isresa:true,isgapp:true', hotelrefno: hotelRefNo}\n                },\n                {\n                    title: 'updateList',\n                    params: type === 'room' && {query: 'isactive:true,isresa:true,isupd:true,isgapp:true', hotelrefno: hotelRefNo}\n                }\n            ]\n\n            array.map((item, index) => {\n                ViewList({\n                    apiUrl: GENERAL_SETTINGS.OREST_URL,\n                    endpoint: OREST_ENDPOINT.RESXREASON,\n                    token: token,\n                    params: item?.params\n                }).then((response) => {\n                        if (response.status === 200 && response.data.count > 0) {\n                            const responseData = response.data.data\n                            setRenderList(responseData)\n                            if(item.title === 'cancelList') {\n                                setResxReasonList(responseData)\n                            } else if(item.title === 'updateList') {\n                                setResxReasonUpdateList(responseData)\n                            }\n                        } else {\n                            setResxReasonList(false)\n                            setResxReasonUpdateList(false);\n                        }\n                    },\n                ).catch(() => {\n                    setResxReasonList(false)\n                })\n            })\n\n        }\n\n        return () => {\n            setIsLoading(false)\n            active = false\n        }\n\n    }, [])\n\n    useEffect(() => {\n        if(isOnlyUpdate) {\n            setRenderList(resxReasonUpdateList);\n        } else {\n            setRenderList(resxReasonList);\n        }\n\n    }, [isOnlyUpdate])\n\n    const cancelEventReservation = () => {\n        const reasonForCancel = resxReasonList.find(item => Number(item.id) === Number(resxreasonID))\n        const notifyValues = {\n            roomno: reservBase?.roomno || \"-\",\n            clientname: clientBase?.clientname || \"-\",\n            details: JSON.stringify({\n                description: reasonForCancel.description,\n                note: resxreasonNote ? resxreasonNote : \"-\",\n                loc: reservation.description,\n                date: reservation.startdate,\n                time: reservation.starttime,\n                totalpax: reservation.totalpax,\n                totalchd: reservation.totalchd\n            })\n        }\n\n        Insert({\n            apiUrl: GENERAL_SETTINGS.OREST_URL,\n            endpoint: OREST_ENDPOINT.RESXREASONLIST,\n            token: token,\n            data: {\n                resxreasonid: resxreasonID,\n                note: resxreasonNote,\n                reservno: reservation.reservno,\n                hotelrefno: reservation.hotelrefno\n            },\n        }).then((response) => {\n                if (response.status === 200) {\n                    Patch({\n                        apiUrl: GENERAL_SETTINGS.OREST_URL,\n                        endpoint: OREST_ENDPOINT.RESEVENT,\n                        token: token,\n                        gid: reservation.gid,\n                        params: {\n                            hotelrefno: reservation.hotelrefno\n                        },\n                        data: {\n                            status: 'X',\n                        },\n                    }).then(async (response) => {\n                        if (response.status === 200) {\n                            getCallbackData()\n                            enqueueSnackbar(t('str_updatedSuccessfully'), { variant: 'success' })\n                            onClose(true)\n                            setResxreasonID(false)\n                            setResxreasonNote(\"\")\n                            setIsLoading(false)\n                            await sendGuestChangeNotifyMail(reservBase?.gid ? false : true,'resevent','cnl',clientBase.id,reservBase?.gid ? reservBase.gid : clientBase.gid, notifyValues,reservBase?.hotelrefno || GENERAL_SETTINGS.HOTELREFNO)\n                        } else {\n                            enqueueSnackbar(t('str_unexpectedProblem'), { variant: 'warning' })\n                            onClose(true)\n                            setIsLoading(false)\n                        }\n                    }).catch(() => {\n                        enqueueSnackbar(t('str_unexpectedProblem'), { variant: 'warning' })\n                        onClose(true)\n                        setIsLoading(false)\n                    })\n                } else {\n                    enqueueSnackbar(t('str_unexpectedProblem'), { variant: 'warning' })\n                    onClose(true)\n                    setIsLoading(false)\n                }\n            },\n        ).catch(() => {\n            enqueueSnackbar(t('str_unexpectedProblem'), { variant: 'warning' })\n            onClose(true)\n            setIsLoading(false)\n        })\n    }\n\n    const cancelRoomReservation = () => {\n        const reasonForCancel = resxReasonList.find(item => Number(item.id) === Number(resxreasonID))\n        const notifyValues = {\n            roomno: reservBase?.roomno || \"-\",\n            clientname: clientBase?.clientname || \"-\",\n            details: JSON.stringify({\n                description: reasonForCancel.description,\n                note: resxreasonNote ? resxreasonNote : \"-\",\n                roomtype: reservation?.roomtypedesc || \"-\",\n                resdate: reservation?.resdate || \"-\",\n                cidate: reservation?.checkin || \"-\",\n                codate: reservation?.checkout || \"-\",\n                totalpax: reservation?.totalpax || \"-\",\n                totalchd: reservation?.totalchd || \"-\"\n            })\n        }\n\n        Insert({\n            apiUrl: GENERAL_SETTINGS.OREST_URL,\n            endpoint: OREST_ENDPOINT.RESXREASONLIST,\n            token: token,\n            data: {\n                resxreasonid: resxreasonID,\n                note: resxreasonNote,\n                reservno: reservation.reservno,\n                hotelrefno: reservation.hotelrefno\n            },\n        }).then((response) => {\n            if (response.status === 200) {\n                if(isOnlyUpdate) {\n                    getCallbackData()\n                    enqueueSnackbar(t('str_updatedSuccessfully'), { variant: 'success' })\n                    onClose(true)\n                    setResxreasonID(false)\n                    setResxreasonNote(\"\")\n                    setIsLoading(false)\n                } else {\n                    UseOrest({\n                        apiUrl: GENERAL_SETTINGS.OREST_URL,\n                        endpoint: OREST_ENDPOINT.RESERVAT_DOX,\n                        method: REQUEST_METHOD_CONST.PUT,\n                        token: token,\n                        params: {\n                            reservno: reservation.reservno,\n                            hotelrefno: reservation.hotelrefno\n                        },\n                    }).then(async (response) => {\n                        if (response.status === 200) {\n                            getCallbackData()\n                            enqueueSnackbar(t('str_updatedSuccessfully'), { variant: 'success' })\n                            onClose(true)\n                            setResxreasonID(false)\n                            setResxreasonNote(\"\")\n                            setIsLoading(false)\n                            await sendGuestChangeNotifyMail(reservBase?.gid ? false : true,'reservat','cnl',clientBase.id,reservBase?.gid ? reservBase.gid : clientBase.gid, notifyValues,reservBase?.hotelrefno || GENERAL_SETTINGS.HOTELREFNO)\n                        } else {\n                            enqueueSnackbar(t('str_unexpectedProblem'), { variant: 'warning' })\n                            onClose(true)\n                            setIsLoading(false)\n                        }\n                    }).catch(() => {\n                        enqueueSnackbar(t('str_unexpectedProblem'), { variant: 'warning' })\n                        onClose(true)\n                        setIsLoading(false)\n                    })\n                }\n            } else {\n                enqueueSnackbar(t('str_unexpectedProblem'), { variant: 'warning' })\n                onClose(true)\n                setIsLoading(false)\n            }}).catch(() => {\n            enqueueSnackbar(t('str_unexpectedProblem'), { variant: 'warning' })\n            onClose(true)\n            setIsLoading(false)\n        })\n    }\n\n    const handleCancelReservation = () => {\n        if(!resxreasonID){\n            enqueueSnackbar(t('str_pleaseSelectCancellationReason'), { variant: 'warning' })\n        }else{\n            setIsLoading(true)\n            if(type === \"event\"){\n                cancelEventReservation()\n            }else if(type === \"room\"){\n                cancelRoomReservation()\n            }\n        }\n    }\n\n    const handleCloseDialog = (prop) => {\n        typeof onClose === 'function' && onClose(prop)\n        handleReset()\n    }\n\n    const handleReset = () => {\n        setResxreasonID(false)\n        setResxreasonNote('')\n    }\n\n    return (\n        <Dialog\n            maxWidth=\"sm\"\n            fullWidth\n            open={open}\n            onClose={()=> onClose(true)}\n            aria-labelledby=\"cancellation-reason-title\"\n        >\n            <DialogTitle id=\"cancellation-reason-title\">{isOnlyUpdate ? t('str_changeReason') : t('str_cancellationReason')}</DialogTitle>\n            <DialogContent dividers>\n                <Box p={3}>\n                    <Container maxWidth=\"sm\">\n                        <Grid container spacing={3}>\n                            <Grid item xs={12}>\n                                <FormControl variant=\"outlined\" fullWidth required disabled={isLoading}>\n                                    <InputLabel htmlFor=\"resxreasonid-select\">{isOnlyUpdate ? t('str_changeReason') : t('str_cancellationReason')}</InputLabel>\n                                    <Select\n                                        native\n                                        value={resxreasonID}\n                                        onChange={(e) => setResxreasonID(e.target.value)}\n                                        label={isOnlyUpdate ? t('str_changeReason') : t('str_cancellationReason')}\n                                        inputProps={{ name: 'resxreasonid', id: 'resxreasonid-select' }}\n                                    >\n                                        <option aria-label=\"None\" value=\"\" />\n                                        {renderList && renderList.length > 0 && renderList.map((item, i) => {\n                                            return (\n                                                <option key={i} value={item.id}>{item.description}</option>\n                                            )\n                                        })}\n                                    </Select>\n                                </FormControl>\n                            </Grid>\n                            <Grid item xs={12}>\n                                <TextField\n                                    disabled={isLoading}\n                                    fullWidth\n                                    id=\"resxreason-description\"\n                                    label={t('str_note')}\n                                    multiline\n                                    rows={4}\n                                    variant=\"outlined\"\n                                    value={resxreasonNote}\n                                    onChange={(e)=> setResxreasonNote(e.target.value)}\n                                />\n                            </Grid>\n                        </Grid>\n                    </Container>\n                </Box>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={()=> handleCloseDialog(true)} color=\"primary\" variant={'outlined'} disabled={isLoading} >\n                    {t('str_close')}\n                </Button>\n                <CustomToolTip open={openToolTip} onOpen={() => setOpenToolTip(!resxreasonID)} onClose={() => setOpenToolTip(false)} title={\n                    <div>\n                        {\n                            !resxreasonID ? (\n                                <React.Fragment>\n                                    <Typography style={{fontWeight: '600', fontSize: 'inherit'}}>{t('str_invalidFields')}</Typography>\n                                    <Typography style={{fontSize: 'inherit'}}>\n                                        {isOnlyUpdate ? t('str_changeReason') : t('str_cancellationReason')}\n                                    </Typography>\n                                </React.Fragment>\n                            ) : ('')\n                        }\n                    </div>\n                }>\n                    <span>\n                         <Button onClick={() => resxreasonID ? handleCancelReservation() : {}} color=\"primary\" variant={'contained'} disabled={isLoading || !resxreasonID}>\n                             {t('str_save')}\n                         </Button>\n                    </span>\n                </CustomToolTip>\n\n            </DialogActions>\n        </Dialog>\n    )\n}\n\nconst mapStateToProps = (state) => {\n    return {\n        state: state.formReducer.guest,\n    }\n}\n\nconst mapDispatchToProps = (dispatch) => ({\n    setToState: (stateType, stateName, value) => dispatch(setToState(stateType, stateName, value)),\n})\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ReservationCancelDialog)\n"]},"metadata":{},"sourceType":"module"}
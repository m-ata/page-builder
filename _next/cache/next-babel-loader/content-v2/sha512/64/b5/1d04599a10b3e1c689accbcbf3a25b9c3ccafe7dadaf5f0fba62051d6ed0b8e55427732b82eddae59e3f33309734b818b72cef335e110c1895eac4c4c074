{"ast":null,"code":"\"use strict\";\n\nvar global = _interopRequireWildcard(require(\"@webcms-globals\"));\n\nvar _Snippets = _interopRequireDefault(require(\"./Snippets\"));\n\nvar _useFunction = require(\"lib/helpers/useFunction\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nconst TagManager = {\n  dataScript: function (dataLayer) {\n    const script = document.createElement('script');\n    script.innerHTML = dataLayer;\n    return script;\n  },\n  gtm: function (args) {\n    const snippets = _Snippets.default.tags(args);\n\n    const noScript = () => {\n      const noscript = document.createElement('noscript');\n      noscript.innerHTML = snippets.iframe;\n      return noscript;\n    };\n\n    const script = () => {\n      const script = document.createElement('script');\n      script.innerHTML = snippets.script;\n      return script;\n    };\n\n    const dataScript = this.dataScript(snippets.dataLayerVar);\n    return {\n      noScript,\n      script,\n      dataScript\n    };\n  },\n  initialize: function ({\n    gtmId,\n    events = {},\n    dataLayer,\n    dataLayerName = 'dataLayer',\n    auth = '',\n    preview = ''\n  }) {\n    const gtm = this.gtm({\n      id: gtmId,\n      events: events,\n      dataLayer: dataLayer || undefined,\n      dataLayerName: dataLayerName,\n      auth,\n      preview\n    });\n    if (dataLayer) document.head.appendChild(gtm.dataScript);\n    document.head.insertBefore(gtm.script(), document.head.childNodes[0]);\n    document.body.insertBefore(gtm.noScript(), document.body.childNodes[0]);\n  },\n  dataLayer: function ({\n    dataLayer,\n    dataLayerName = 'dataLayer'\n  }) {\n    if (window[dataLayerName]) return window[dataLayerName].push(dataLayer);\n\n    const snippets = _Snippets.default.dataLayer(dataLayer, dataLayerName),\n          dataScript = this.dataScript(snippets);\n\n    document.head.insertBefore(dataScript, document.head.childNodes[0]);\n  },\n  getActionFieldForPageView: function (pageStep) {\n    switch (pageStep) {\n      case 'Preview':\n        return {\n          'eventCategory': 'Enhanced Ecommerce',\n          'ecommerce': {\n            'actionField': {\n              'step': 3,\n              'option': 'Preview'\n            }\n          }\n        };\n\n      default:\n        return {};\n    }\n  },\n  resetPrevious: function () {\n    TagManager.dataLayer({\n      dataLayer: {\n        'eventCategory': null,\n        'ecommerce': null\n      }\n    });\n  },\n  page: {\n    setChange: function ({\n      hotelName,\n      hotelId,\n      pageTitle = '',\n      pagePath = '',\n      pageStep = '',\n      isGuest = false\n    }) {\n      TagManager.resetPrevious();\n      TagManager.dataLayer({\n        dataLayer: Object.assign({\n          'eventLabel': 'Page View',\n          'event': 'Pageview',\n          'eventAction': 'Page View',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'pagePath': pagePath,\n          'pageTitle': pageTitle,\n          'pageStep': pageStep,\n          'visitorType': isGuest ? 'guest' : 'visitor'\n        }, TagManager.getActionFieldForPageView(pageStep))\n      });\n    }\n  },\n  setThnAnalyticQueryAndResult: (hotelId, hotelName, ciDate, coDate, adult, child, childAges, currencyCode, langCode, promoCode, isLogin, impressionsData) => {\n    const hotelInfo = {\n      'hotelId': hotelId,\n      'hotelName': hotelName,\n      'languageCode': langCode,\n      'currencyCode': (0, _useFunction.getCurrencyCodeToIso)(currencyCode),\n      'user': {\n        'loggedIn': isLogin\n      }\n    },\n          searchInfo = {\n      'checkIn': ciDate,\n      'checkOut': coDate,\n      'promoCode': '',\n      'rooms': [{\n        'adults': adult,\n        'children': child || 0,\n        'childrenAges': child > 0 && childAges && childAges.map(childAge => Number(childAge.age)) || ''\n      }]\n    },\n          lowPrices = (0, _useFunction.getLowPrices)(impressionsData, adult);\n    TagManager.dataLayer({\n      dataLayer: {\n        'event': 'thnSearchQuery',\n        'thn': _objectSpread(_objectSpread({}, hotelInfo), {}, {\n          'search': searchInfo,\n          'results': null\n        })\n      }\n    });\n    const isRoomAvailability = lowPrices > 0 && (0, _useFunction.isAnyRoomAvailability)(impressionsData);\n    TagManager.dataLayer({\n      dataLayer: {\n        'event': 'thnSearchResults',\n        'thn': _objectSpread(_objectSpread({}, hotelInfo), {}, {\n          'search': searchInfo,\n          'results': {\n            'availability': isRoomAvailability,\n            'lowestPriceWithoutTaxes': lowPrices,\n            'lowestPriceWithTaxes': (0, _useFunction.getLowPrices)(impressionsData, adult),\n            'rooms': isRoomAvailability ? impressionsData.map(impression => {\n              return {\n                'id': impression.id,\n                'name': impression.shorttext,\n                'people': impression.totalpax + impression.totalchd,\n                'rates': impression.priceList.map(priceListItem => {\n                  const getTotalPrice = (0, _useFunction.useTotalPrice)(priceListItem.prices, adult),\n                        totalPrice = getTotalPrice.discTotalPrice || getTotalPrice.totalPrice || 0;\n                  return {\n                    name: priceListItem.description,\n                    priceWithoutTaxes: totalPrice,\n                    priceWithTaxes: totalPrice\n                  };\n                })\n              };\n            }) : null\n          }\n        })\n      }\n    });\n  },\n  setThnAnalyticConfirm: (hotelId, hotelName, masterReservNo, revenue, coupon, isLogin, langCode, currencyCode, purchaseData) => {\n    const hotelInfo = {\n      'hotelId': hotelId,\n      'hotelName': hotelName,\n      'languageCode': langCode,\n      'currencyCode': (0, _useFunction.getCurrencyCodeToIso)(currencyCode),\n      'user': {\n        'loggedIn': isLogin\n      }\n    };\n    TagManager.dataLayer({\n      dataLayer: {\n        'event': 'thnBookingConfirmation',\n        'thn': _objectSpread(_objectSpread({}, hotelInfo), {}, {\n          'booking': {\n            'id': masterReservNo,\n            'totalCost': revenue,\n            'checkIn': purchaseData[0].checkin,\n            'checkOut': purchaseData[0].checkout,\n            'promoCode': coupon || '',\n            'promoCodeType': 'generic',\n            'rooms': purchaseData.map(purchase => {\n              return {\n                'adults': purchase.totalpax,\n                'children': purchase.totalchd || 0,\n                'childrenAges': purchase.totalchd > 0 && purchase.childages && purchase.childages.map(childAge => Number(childAge.age)) || ''\n              };\n            })\n          }\n        })\n      }\n    });\n  },\n  booking: {\n    setRoomList: function ({\n      eventLabel = '',\n      hotelName,\n      hotelId,\n      ciDate,\n      coDate,\n      adult,\n      child,\n      childAges,\n      currencyCode = '',\n      langCode,\n      promoCode,\n      isLogin,\n      impressionsData = []\n    }) {\n      TagManager.resetPrevious();\n      TagManager.setThnAnalyticQueryAndResult(hotelId, hotelName, ciDate, coDate, adult, child, childAges, currencyCode, langCode, promoCode, isLogin, impressionsData);\n      TagManager.dataLayer({\n        dataLayer: {\n          'eventLabel': eventLabel,\n          'eventCategory': 'Enhanced Ecommerce',\n          'eventAction': 'Product Impression',\n          'event': 'productImpression',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'ecommerce': {\n            'ciDate': ciDate,\n            'coDate': coDate,\n            'adult': adult,\n            'child': child,\n            'currencyCode': (0, _useFunction.getCurrencyCodeToIso)(currencyCode),\n            'actionField': {\n              'step': 1,\n              'option': 'Product Impression'\n            },\n            'impressions': impressionsData.map((impression, position) => {\n              const totalPrice = (0, _useFunction.useTotalPrice)(impression.priceList, adult).discTotalPrice || (0, _useFunction.useTotalPrice)(impression.priceList, adult).totalPrice || 0;\n              return {\n                'name': impression.description,\n                'id': impression.id,\n                'price': global.helper.formatPrice(totalPrice),\n                'quantity': impression.totalroom,\n                'category': 'Room',\n                'list': 'Search Results',\n                'position': impression.orderno || position\n              };\n            })\n          }\n        }\n      });\n    },\n    setAddRoom: function ({\n      eventLabel = '',\n      hotelName,\n      hotelId,\n      ciDate,\n      coDate,\n      adult,\n      child,\n      currencyCode = '',\n      addToCartData = []\n    }) {\n      TagManager.resetPrevious();\n      TagManager.dataLayer({\n        dataLayer: {\n          'eventLabel': eventLabel,\n          'eventCategory': 'Enhanced Ecommerce',\n          'eventAction': 'Add to Cart',\n          'event': 'addToCart',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'ecommerce': {\n            'ciDate': ciDate,\n            'coDate': coDate,\n            'adult': adult,\n            'child': child,\n            'currencyCode': (0, _useFunction.getCurrencyCodeToIso)(currencyCode),\n            'actionField': {\n              'step': 2,\n              'option': 'Add to Cart'\n            },\n            'add': {\n              'products': addToCartData\n            }\n          }\n        }\n      });\n    },\n    setRemoveRoom: function ({\n      eventLabel = '',\n      hotelName,\n      hotelId,\n      ciDate,\n      coDate,\n      adult,\n      child,\n      currencyCode = '',\n      removeToCartData = []\n    }) {\n      TagManager.resetPrevious();\n      TagManager.dataLayer({\n        dataLayer: {\n          'eventLabel': eventLabel,\n          'eventCategory': 'Enhanced Ecommerce',\n          'eventAction': 'Remove to Cart',\n          'event': 'removeFromCart',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'ecommerce': {\n            'ciDate': ciDate,\n            'coDate': coDate,\n            'adult': adult,\n            'child': child,\n            'currencyCode': (0, _useFunction.getCurrencyCodeToIso)(currencyCode),\n            'remove': {\n              'products': removeToCartData\n            }\n          }\n        }\n      });\n    },\n    setCheckoutRoom: function ({\n      eventLabel = '',\n      hotelName,\n      hotelId,\n      payOption,\n      checkoutData = []\n    }) {\n      TagManager.resetPrevious();\n      TagManager.dataLayer({\n        dataLayer: {\n          'eventLabel': eventLabel,\n          'eventCategory': 'Enhanced Ecommerce',\n          'eventAction': 'Checkout',\n          'event': 'checkout',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'ecommerce': {\n            'checkout': {\n              'actionField': {\n                'payOption': payOption || ''\n              },\n              'products': checkoutData.map(checkout => {\n                return {\n                  'reservNo': checkout.reservno,\n                  'id': checkout.roomtypeid,\n                  'name': checkout.roomtypename,\n                  'price': global.helper.formatPrice(checkout.totalprice),\n                  'qty': 1,\n                  'category': 'Room'\n                };\n              })\n            }\n          }\n        }\n      });\n    },\n    setPurchaseRoom: function ({\n      eventLabel = '',\n      hotelName = '',\n      hotelId = '',\n      masterReservNo = '',\n      revenue = '',\n      coupon = '',\n      isLogin,\n      langCode,\n      currencyCode = '',\n      purchaseData = []\n    }) {\n      TagManager.resetPrevious();\n      TagManager.setThnAnalyticConfirm(hotelId, hotelName, masterReservNo, revenue, coupon, isLogin, langCode, currencyCode, purchaseData);\n      TagManager.dataLayer({\n        dataLayer: {\n          'eventLabel': eventLabel,\n          'eventCategory': 'Enhanced Ecommerce',\n          'eventAction': 'Purchase',\n          'event': 'purchase',\n          'hotelName': hotelName,\n          'hotelId': hotelId,\n          'ecommerce': {\n            'purchase': {\n              'actionField': {\n                'id': masterReservNo,\n                'affiliation': 'Online Booking',\n                'revenue': revenue,\n                'coupon': coupon,\n                'step': 4,\n                'option': 'Purchase'\n              },\n              'products': purchaseData.map(purchase => {\n                return {\n                  'reservNo': purchase.reservno,\n                  'id': purchase.roomtypeid,\n                  'name': purchase.roomtypename,\n                  'price': global.helper.formatPrice(purchase.totalprice),\n                  'qty': 1,\n                  'category': 'Room'\n                };\n              })\n            }\n          }\n        }\n      });\n    }\n  }\n};\nmodule.exports = TagManager;","map":{"version":3,"sources":["/Users/mata/app-cloudweb/@webcms-globals/tag-manager/TagManager.js"],"names":["TagManager","dataScript","dataLayer","script","document","createElement","innerHTML","gtm","args","snippets","Snippets","tags","noScript","noscript","iframe","dataLayerVar","initialize","gtmId","events","dataLayerName","auth","preview","id","undefined","head","appendChild","insertBefore","childNodes","body","window","push","getActionFieldForPageView","pageStep","resetPrevious","page","setChange","hotelName","hotelId","pageTitle","pagePath","isGuest","Object","assign","setThnAnalyticQueryAndResult","ciDate","coDate","adult","child","childAges","currencyCode","langCode","promoCode","isLogin","impressionsData","hotelInfo","searchInfo","map","childAge","Number","age","lowPrices","isRoomAvailability","impression","shorttext","totalpax","totalchd","priceList","priceListItem","getTotalPrice","prices","totalPrice","discTotalPrice","name","description","priceWithoutTaxes","priceWithTaxes","setThnAnalyticConfirm","masterReservNo","revenue","coupon","purchaseData","checkin","checkout","purchase","childages","booking","setRoomList","eventLabel","position","global","helper","formatPrice","totalroom","orderno","setAddRoom","addToCartData","setRemoveRoom","removeToCartData","setCheckoutRoom","payOption","checkoutData","reservno","roomtypeid","roomtypename","totalprice","setPurchaseRoom","module","exports"],"mappings":"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","sourcesContent":["import * as global from '@webcms-globals'\nimport Snippets from './Snippets'\nimport { useTotalPrice, getCurrencyCodeToIso, getLowPrices, isAnyRoomAvailability } from 'lib/helpers/useFunction'\n\nconst TagManager = {\n    dataScript: function (dataLayer) {\n        const script = document.createElement('script')\n        script.innerHTML = dataLayer\n        return script\n    },\n    gtm: function (args) {\n        const snippets = Snippets.tags(args)\n        const noScript = () => {\n            const noscript = document.createElement('noscript')\n            noscript.innerHTML = snippets.iframe\n            return noscript\n        }\n        const script = () => {\n            const script = document.createElement('script')\n            script.innerHTML = snippets.script\n            return script\n        }\n        const dataScript = this.dataScript(snippets.dataLayerVar)\n        return {\n            noScript,\n            script,\n            dataScript\n        }\n    },\n    initialize: function ({ gtmId, events = {}, dataLayer, dataLayerName = 'dataLayer', auth = '', preview = '' }) {\n        const gtm = this.gtm({\n            id: gtmId,\n            events: events,\n            dataLayer: dataLayer || undefined,\n            dataLayerName: dataLayerName,\n            auth,\n            preview\n        })\n        if (dataLayer) document.head.appendChild(gtm.dataScript)\n        document.head.insertBefore(gtm.script(), document.head.childNodes[0])\n        document.body.insertBefore(gtm.noScript(), document.body.childNodes[0])\n    },\n    dataLayer: function ({dataLayer, dataLayerName = 'dataLayer'}) {\n        if (window[dataLayerName]) return window[dataLayerName].push(dataLayer)\n        const snippets = Snippets.dataLayer(dataLayer, dataLayerName)\n            , dataScript = this.dataScript(snippets)\n        document.head.insertBefore(dataScript, document.head.childNodes[0])\n    },\n    getActionFieldForPageView: function(pageStep) {\n        switch (pageStep) {\n            case 'Preview':\n                return {\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'ecommerce': {\n                        'actionField': { 'step': 3, 'option': 'Preview' },\n                    }\n                }\n            default:\n                return {}\n        }\n    },\n    resetPrevious: function(){\n        TagManager.dataLayer({\n            dataLayer: {\n                'eventCategory': null,\n                'ecommerce': null,\n            },\n        })\n    },\n    page: {\n        setChange: function({ hotelName, hotelId, pageTitle = '', pagePath = '', pageStep = '', isGuest = false}) {\n            TagManager.resetPrevious()\n            TagManager.dataLayer({\n                dataLayer: Object.assign({\n                    'eventLabel': 'Page View',\n                    'event': 'Pageview',\n                    'eventAction': 'Page View',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'pagePath': pagePath,\n                    'pageTitle': pageTitle,\n                    'pageStep': pageStep,\n                    'visitorType': isGuest ? 'guest' : 'visitor',\n                }, TagManager.getActionFieldForPageView(pageStep)),\n            })\n        },\n    },\n    setThnAnalyticQueryAndResult: (hotelId, hotelName, ciDate, coDate, adult, child, childAges, currencyCode, langCode, promoCode, isLogin, impressionsData) => {\n        const hotelInfo = {\n            'hotelId': hotelId,\n            'hotelName': hotelName,\n            'languageCode': langCode,\n            'currencyCode': getCurrencyCodeToIso(currencyCode),\n            'user': {\n                'loggedIn': isLogin,\n            },\n        }\n            , searchInfo = {\n            'checkIn': ciDate,\n            'checkOut': coDate,\n            'promoCode': '',\n            'rooms': [\n                {\n                    'adults': adult,\n                    'children': child || 0,\n                    'childrenAges': child > 0 && childAges && childAges.map(childAge => Number(childAge.age)) || '',\n                },\n            ],\n        }\n        , lowPrices = getLowPrices(impressionsData, adult)\n\n        TagManager.dataLayer({\n            dataLayer: {\n                'event': 'thnSearchQuery',\n                'thn': {\n                    ...hotelInfo,\n                    'search': searchInfo,\n                    'results': null\n                }\n            }\n        })\n\n        const isRoomAvailability = lowPrices > 0 && isAnyRoomAvailability(impressionsData);\n        TagManager.dataLayer({\n            dataLayer: {\n                'event': 'thnSearchResults',\n                'thn': {\n                    ...hotelInfo,\n                    'search': searchInfo,\n                    'results': {\n                        'availability': isRoomAvailability,\n                        'lowestPriceWithoutTaxes': lowPrices,\n                        'lowestPriceWithTaxes': getLowPrices(impressionsData, adult),\n                        'rooms': isRoomAvailability ? impressionsData.map((impression) => {\n                            return {\n                                'id': impression.id,\n                                'name': impression.shorttext,\n                                'people': impression.totalpax + impression.totalchd,\n                                'rates': impression.priceList.map((priceListItem) => {\n                                    const getTotalPrice = useTotalPrice(priceListItem.prices, adult)\n                                        , totalPrice = getTotalPrice.discTotalPrice || getTotalPrice.totalPrice || 0\n                                    return {\n                                        name: priceListItem.description,\n                                        priceWithoutTaxes: totalPrice,\n                                        priceWithTaxes: totalPrice,\n                                    }\n                                })\n                            }\n                        }): null,\n                    }\n                }\n            }\n        })\n    },\n    setThnAnalyticConfirm: (hotelId, hotelName, masterReservNo, revenue, coupon, isLogin, langCode, currencyCode, purchaseData) => {\n        const hotelInfo = {\n            'hotelId': hotelId,\n            'hotelName': hotelName,\n            'languageCode': langCode,\n            'currencyCode': getCurrencyCodeToIso(currencyCode),\n            'user': {\n                'loggedIn': isLogin,\n            },\n        }\n\n        TagManager.dataLayer({\n            dataLayer: {\n                'event': 'thnBookingConfirmation',\n                'thn': {\n                    ...hotelInfo,\n                    'booking': {\n                        'id': masterReservNo,\n                        'totalCost': revenue,\n                        'checkIn': purchaseData[0].checkin,\n                        'checkOut': purchaseData[0].checkout,\n                        'promoCode': coupon || '',\n                        'promoCodeType': 'generic',\n                        'rooms': purchaseData.map((purchase) => {\n                            return {\n                                'adults': purchase.totalpax,\n                                'children': purchase.totalchd || 0,\n                                'childrenAges': purchase.totalchd > 0 && purchase.childages && purchase.childages.map(childAge => Number(childAge.age)) || '',\n                            }\n                        })\n                    },\n                }\n            }\n        })\n    },\n    booking: {\n        setRoomList: function({ eventLabel = '', hotelName, hotelId, ciDate, coDate, adult, child, childAges, currencyCode = '', langCode, promoCode, isLogin, impressionsData = [] }) {\n            TagManager.resetPrevious()\n            TagManager.setThnAnalyticQueryAndResult(hotelId, hotelName, ciDate, coDate, adult, child, childAges, currencyCode, langCode, promoCode, isLogin, impressionsData)\n            TagManager.dataLayer({\n                dataLayer: {\n                    'eventLabel': eventLabel,\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'eventAction': 'Product Impression',\n                    'event': 'productImpression',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'ecommerce': {\n                        'ciDate': ciDate,\n                        'coDate': coDate,\n                        'adult': adult,\n                        'child': child,\n                        'currencyCode': getCurrencyCodeToIso(currencyCode),\n                        'actionField': { 'step': 1, 'option': 'Product Impression' },\n                        'impressions': impressionsData.map((impression, position) => {\n                            const totalPrice = useTotalPrice(impression.priceList, adult).discTotalPrice || useTotalPrice(impression.priceList, adult).totalPrice || 0\n                            return {\n                                'name': impression.description,\n                                'id': impression.id,\n                                'price': global.helper.formatPrice(totalPrice),\n                                'quantity': impression.totalroom,\n                                'category': 'Room',\n                                'list': 'Search Results',\n                                'position': impression.orderno || position\n                            }\n                        })\n                    },\n                },\n            })\n        },\n        setAddRoom: function({ eventLabel = '', hotelName, hotelId, ciDate, coDate, adult, child, currencyCode = '', addToCartData = [] }){\n            TagManager.resetPrevious()\n            TagManager.dataLayer({\n                dataLayer: {\n                    'eventLabel': eventLabel,\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'eventAction': 'Add to Cart',\n                    'event': 'addToCart',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'ecommerce': {\n                        'ciDate': ciDate,\n                        'coDate': coDate,\n                        'adult': adult,\n                        'child': child,\n                        'currencyCode': getCurrencyCodeToIso(currencyCode),\n                        'actionField': { 'step': 2, 'option': 'Add to Cart' },\n                        'add': {\n                            'products': addToCartData\n                        }\n                    },\n                },\n            })\n        },\n        setRemoveRoom: function({ eventLabel = '', hotelName, hotelId, ciDate, coDate, adult, child, currencyCode = '', removeToCartData = [] }){\n            TagManager.resetPrevious()\n            TagManager.dataLayer({\n                dataLayer: {\n                    'eventLabel': eventLabel,\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'eventAction': 'Remove to Cart',\n                    'event': 'removeFromCart',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'ecommerce': {\n                        'ciDate': ciDate,\n                        'coDate': coDate,\n                        'adult': adult,\n                        'child': child,\n                        'currencyCode': getCurrencyCodeToIso(currencyCode),\n                        'remove': {\n                            'products': removeToCartData\n                        }\n                    },\n                },\n            })\n        },\n        setCheckoutRoom: function({ eventLabel = '', hotelName, hotelId, payOption, checkoutData = [] }){\n            TagManager.resetPrevious()\n            TagManager.dataLayer({\n                dataLayer: {\n                    'eventLabel': eventLabel,\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'eventAction': 'Checkout',\n                    'event': 'checkout',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'ecommerce': {\n                        'checkout': {\n                            'actionField': { 'payOption': payOption || '' },\n                            'products': checkoutData.map((checkout) => {\n                                return {\n                                    'reservNo': checkout.reservno,\n                                    'id': checkout.roomtypeid,\n                                    'name': checkout.roomtypename,\n                                    'price': global.helper.formatPrice(checkout.totalprice),\n                                    'qty': 1,\n                                    'category': 'Room'\n                                }\n                            })\n                        }\n                    }\n                },\n            })\n        },\n        setPurchaseRoom: function({ eventLabel = '', hotelName = '', hotelId = '', masterReservNo = '', revenue = '', coupon = '', isLogin, langCode, currencyCode = '', purchaseData = [] }){\n            TagManager.resetPrevious()\n            TagManager.setThnAnalyticConfirm(hotelId, hotelName, masterReservNo, revenue, coupon, isLogin, langCode, currencyCode, purchaseData)\n            TagManager.dataLayer({\n                dataLayer: {\n                    'eventLabel': eventLabel,\n                    'eventCategory': 'Enhanced Ecommerce',\n                    'eventAction': 'Purchase',\n                    'event': 'purchase',\n                    'hotelName': hotelName,\n                    'hotelId': hotelId,\n                    'ecommerce': {\n                        'purchase': {\n                            'actionField':  {\n                                'id': masterReservNo,\n                                'affiliation': 'Online Booking',\n                                'revenue': revenue,\n                                'coupon': coupon,\n                                'step': 4,\n                                'option': 'Purchase'\n                            },\n                            'products': purchaseData.map((purchase) => {\n                                return {\n                                    'reservNo': purchase.reservno,\n                                    'id': purchase.roomtypeid,\n                                    'name': purchase.roomtypename,\n                                    'price': global.helper.formatPrice(purchase.totalprice),\n                                    'qty': 1,\n                                    'category': 'Room'\n                                }\n                            })\n                        }\n                    }\n                },\n            })\n        },\n    }\n}\n\nmodule.exports = TagManager"]},"metadata":{},"sourceType":"script"}